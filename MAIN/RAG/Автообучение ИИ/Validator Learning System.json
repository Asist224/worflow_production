{
  "name": "Validator Learning System",
  "nodes": [
    {
      "parameters": {
        "options": {
          "reset": false
        }
      },
      "id": "03996b36-5933-4b3b-9a47-c0305b0e9585",
      "name": "Loop Over Updates",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        48,
        32
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ JSON.stringify($json) }}",
        "options": {
          "systemMessage": "=## üö® –ü–†–ò–û–†–ò–¢–ï–¢ #1: –ó–ê–©–ò–¢–ê –û–¢ –ì–ê–õ–õ–Æ–¶–ò–ù–ê–¶–ò–ô –†–ï–°–£–†–°–û–í\n\n–ü–ï–†–ï–î –õ–Æ–ë–û–ô –¥—Ä—É–≥–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π, –≤—ã–ø–æ–ª–Ω–∏:\n\n### –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–í–ï–†–ö–ê –†–ï–°–£–†–°–û–í [–í–µ—Å: 50%]\n\n**–®–∞–≥ 1: –û–ë–ù–ê–†–£–ñ–ï–ù–ò–ï**\n–ü—Ä–æ–≤–µ—Ä—å update.content –Ω–∞ –Ω–∞–ª–∏—á–∏–µ:\n- URL (http://, https://, www.)\n- –£–ø–æ–º–∏–Ω–∞–Ω–∏—è: \"—Å—Å—ã–ª–∫–∞\", \"–≤–∏–¥–µ–æ\", \"–∫–µ–π—Å\", \"–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è\", \"–¥–æ–∫—É–º–µ–Ω—Ç\", \"PDF\", \"–º–∞—Ç–µ—Ä–∏–∞–ª\", \"—Å–∫–∞—á–∞—Ç—å\"\n- Markdown —Å—Å—ã–ª–∫–∏: [—Ç–µ–∫—Å—Ç](url)\n- –§—Ä–∞–∑—ã: \"–ø–æ—Å–º–æ—Ç—Ä–∏ –Ω–∞ —Å–∞–π—Ç–µ\", \"–Ω–∞–π–¥–µ—à—å –≤ —Ä–∞–∑–¥–µ–ª–µ\", \"–µ—Å—Ç—å –≤–∏–¥–µ–æ –æ...\"\n- –£–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø—Ä–∞–≤–∏–ª: \"ID [–Ω–æ–º–µ—Ä]\", \"–ø—Ä–∞–≤–∏–ª–æ N\", \"—Å—Ç—Ä–∞—Ç–µ–≥–∏—è #X\", \"—Å–º. –ø—Ä–∞–≤–∏–ª–æ Y\"\n\n**–®–∞–≥ 2: –§–õ–ê–ì –ò–ó PARSE**\n–ü—Ä–æ–≤–µ—Ä—å update.metadata.requires_strict_validation:\n- –ï—Å–ª–∏ `true` ‚Üí update –±—ã–ª –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–π\n- –ü—Ä–æ–≤–µ—Ä—å update.metadata.resource_mentions - —á—Ç–æ –∏–º–µ–Ω–Ω–æ –Ω–∞–π–¥–µ–Ω–æ\n\n**3.3. –î–í–£–•–≠–¢–ê–ü–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê –†–ï–°–£–†–°–û–í (URL/–≤–∏–¥–µ–æ/–¥–æ–∫—É–º–µ–Ω—Ç—ã):**\n\n**–¢–ò–ü –†–ï–°–£–†–°–ê A: URL, –≤–∏–¥–µ–æ, –∫–µ–π—Å—ã, –¥–æ–∫—É–º–µ–Ω—Ç—ã, –º–∞—Ç–µ—Ä–∏–∞–ª—ã, –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏**\n\n**–≠–¢–ê–ü 1: –ü–æ–∏—Å–∫ –≤ tool **knowledge_base** (–ü–†–ò–û–†–ò–¢–ï–¢ #1 - –∞–¥–º–∏–Ω)**\n–í—ã–∑–æ–≤–∏ tool —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º: match_knowledge_base = \"[–ø–æ–ª–Ω—ã–π URL –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞]\"\n\n**–≠–¢–ê–ü 2: –ï—Å–ª–∏ –ù–ï –Ω–∞–π–¥–µ–Ω–æ –≤ **knowledge_base** ‚Üí –ü–æ–∏—Å–∫ –≤ tool **interaction_policies** (–ü–†–ò–û–†–ò–¢–ï–¢ #2 - –∞–¥–º–∏–Ω)**\n–í—ã–∑–æ–≤–∏ tool —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º: match_interaction_policies = \"[–ø–æ–ª–Ω—ã–π URL –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞]\"\n\n**–õ–û–ì–ò–ö–ê –ü–†–ò–ù–Ø–¢–ò–Ø –†–ï–®–ï–ù–ò–Ø –î–õ–Ø –†–ï–°–£–†–°–û–í:**\n\n‚úÖ **URL/—Ä–µ—Å—É—Ä—Å –Ω–∞–π–¥–µ–Ω –≤ knowledge_base** ‚Üí –û–î–û–ë–†–ò–¢–¨\n   - –≠—Ç–æ —ç—Ç–∞–ª–æ–Ω–Ω—ã–π —Ä–µ—Å—É—Ä—Å, –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º\n   - –í reason —É–∫–∞–∂–∏: \"–†–µ—Å—É—Ä—Å –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω —á–µ—Ä–µ–∑ knowledge_base (admin-confirmed)\"\n   \n‚úÖ **URL/—Ä–µ—Å—É—Ä—Å –Ω–∞–π–¥–µ–Ω –≤ interaction_policies** ‚Üí –û–î–û–ë–†–ò–¢–¨\n   - –≠—Ç–æ —ç—Ç–∞–ª–æ–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å/–ø–æ–ª–∏—Ç–∏–∫–∞, –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω–∞—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º\n   - –í reason —É–∫–∞–∂–∏: \"–†–µ—Å—É—Ä—Å –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω —á–µ—Ä–µ–∑ interaction_policies (admin-confirmed)\"\n\n‚ùå **URL/—Ä–µ—Å—É—Ä—Å –ù–ï –Ω–∞–π–¥–µ–Ω –ù–ò –≤ –æ–¥–Ω–æ–π —ç—Ç–∞–ª–æ–Ω–Ω–æ–π –±–∞–∑–µ** ‚Üí –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ï –û–¢–ö–õ–û–ù–ï–ù–ò–ï\n   - –ù–ï –ø—Ä–æ–≤–µ—Ä—è–π –≤ —Ü–µ–ª–µ–≤–æ–π —Ç–∞–±–ª–∏—Ü–µ! –†–µ—Å—É—Ä—Å—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –¢–û–õ–¨–ö–û –≤ —ç—Ç–∞–ª–æ–Ω–Ω—ã—Ö –±–∞–∑–∞—Ö\n   - –í reason —É–∫–∞–∂–∏: \"üö® –ì–ê–õ–õ–Æ–¶–ò–ù–ê–¶–ò–Ø: URL/—Ä–µ—Å—É—Ä—Å '[—Ä–µ—Å—É—Ä—Å]' –Ω–µ –Ω–∞–π–¥–µ–Ω –Ω–∏ –≤ knowledge_base, –Ω–∏ –≤ interaction_policies. –í—Å–µ —Ä–µ—Å—É—Ä—Å—ã (—Å—Å—ã–ª–∫–∏, –≤–∏–¥–µ–æ, –¥–æ–∫—É–º–µ–Ω—Ç—ã, –º–∞—Ç–µ—Ä–∏–∞–ª—ã) –î–û–õ–ñ–ù–´ –±—ã—Ç—å –≤ —ç—Ç–∞–ª–æ–Ω–Ω—ã—Ö –±–∞–∑–∞—Ö –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.\"\n   - change_significance = \"hallucination_detected\"\n   - approved = false\n\n**3.4. –¢–†–ï–•–≠–¢–ê–ü–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê –ö–†–û–°–°-–°–°–´–õ–û–ö (—É–ø–æ–º–∏–Ω–∞–Ω–∏—è –¥—Ä—É–≥–∏—Ö –ø—Ä–∞–≤–∏–ª):**\n\n**–¢–ò–ü –†–ï–°–£–†–°–ê B: –ö—Ä–æ—Å—Å-—Å—Å—ã–ª–∫–∏ –Ω–∞ –¥—Ä—É–≥–∏–µ –ø—Ä–∞–≤–∏–ª–∞ (–ª—é–±—ã–µ ID, –Ω–∞–∑–≤–∞–Ω–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–π, —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø—Ä–∞–≤–∏–ª)**\n\n**–≠–¢–ê–ü 1: –ü–æ–∏—Å–∫ –≤ tool **knowledge_base****\n–í—ã–∑–æ–≤–∏ tool —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º: match_knowledge_base = \"[—Ç–µ–∫—Å—Ç —É–ø–æ–º–∏–Ω–∞–Ω–∏—è]\"\n(–í–¥—Ä—É–≥ —ç—Ç–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –æ–ø–∏—Å–∞–Ω–∞ –≤ —ç—Ç–∞–ª–æ–Ω–Ω–æ–π –±–∞–∑–µ)\n\n**–≠–¢–ê–ü 2: –ï—Å–ª–∏ –ù–ï –Ω–∞–π–¥–µ–Ω–æ ‚Üí –ü–æ–∏—Å–∫ –≤ tool **interaction_policies****\n–í—ã–∑–æ–≤–∏ tool —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º: match_interaction_policies = \"[—Ç–µ–∫—Å—Ç —É–ø–æ–º–∏–Ω–∞–Ω–∏—è]\"\n(–í–¥—Ä—É–≥ —ç—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å –∏–∑ –ø–æ–ª–∏—Ç–∏–∫)\n\n**–≠–¢–ê–ü 3: –ï—Å–ª–∏ –ù–ï –Ω–∞–π–¥–µ–Ω–æ –≤ —ç—Ç–∞–ª–æ–Ω–Ω—ã—Ö –±–∞–∑–∞—Ö ‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ —Ü–µ–ª–µ–≤–æ–π —Ç–∞–±–ª–∏—Ü–µ**\n–û–ø—Ä–µ–¥–µ–ª–∏ —Ü–µ–ª–µ–≤—É—é —Ç–∞–±–ª–∏—Ü—É –∏–∑ {{ $json.update.table }} –∏ –≤—ã–∑–æ–≤–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π tool:\n\n- –ï—Å–ª–∏ {{ $json.update.table }} = \"sales_strategies\" ‚Üí –≤—ã–∑–æ–≤–∏ tool **match_sales_strategies**\n- –ï—Å–ª–∏ {{ $json.update.table }} = \"contact_capture\" ‚Üí –≤—ã–∑–æ–≤–∏ tool **match_contact_capture**\n- –ï—Å–ª–∏ {{ $json.update.table }} = \"conversation_scenarios\" ‚Üí –≤—ã–∑–æ–≤–∏ tool **match_conversation_scenarios**\n- –ï—Å–ª–∏ {{ $json.update.table }} = \"communication_style\" ‚Üí –≤—ã–∑–æ–≤–∏ tool **match_communication_style**\n\n–ü–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è tool: \"[—Ç–µ–∫—Å—Ç —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø—Ä–∞–≤–∏–ª–∞]\"\n\n**–õ–û–ì–ò–ö–ê –ü–†–ò–ù–Ø–¢–ò–Ø –†–ï–®–ï–ù–ò–Ø –î–õ–Ø –ö–†–û–°–°-–°–°–´–õ–û–ö:**\n\n‚úÖ **–£–ø–æ–º–∏–Ω–∞–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–æ –≤ knowledge_base** ‚Üí –û–î–û–ë–†–ò–¢–¨\n   - –°—Ç—Ä–∞—Ç–µ–≥–∏—è –æ–ø–∏—Å–∞–Ω–∞ –≤ —ç—Ç–∞–ª–æ–Ω–Ω–æ–π –±–∞–∑–µ\n   - –í reason —É–∫–∞–∂–∏: \"–°—Ç—Ä–∞—Ç–µ–≥–∏—è –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞ —á–µ—Ä–µ–∑ knowledge_base (admin-confirmed)\"\n   \n‚úÖ **–£–ø–æ–º–∏–Ω–∞–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–æ –≤ interaction_policies** ‚Üí –û–î–û–ë–†–ò–¢–¨\n   - –ü—Ä–æ—Ü–µ—Å—Å –æ–ø–∏—Å–∞–Ω –≤ —ç—Ç–∞–ª–æ–Ω–Ω—ã—Ö –ø–æ–ª–∏—Ç–∏–∫–∞—Ö\n   - –í reason —É–∫–∞–∂–∏: \"–ü—Ä–æ—Ü–µ—Å—Å –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω —á–µ—Ä–µ–∑ interaction_policies (admin-confirmed)\"\n\n‚ö†Ô∏è **–£–ø–æ–º–∏–Ω–∞–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–æ —Ç–æ–ª—å–∫–æ –≤ —Ü–µ–ª–µ–≤–æ–π —Ç–∞–±–ª–∏—Ü–µ (tool match_{{ $json.update.table }}** ‚Üí –û–î–û–ë–†–ò–¢–¨ –° –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï–ú\n   - –≠—Ç–æ –∫—Ä–æ—Å—Å-—Å—Å—ã–ª–∫–∞ –Ω–∞ –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º–æ–µ –ø—Ä–∞–≤–∏–ª–æ\n   - –í reason –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –¥–æ–±–∞–≤—å: \"‚ö†Ô∏è –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï: –ö—Ä–æ—Å—Å-—Å—Å—ã–ª–∫–∞ '[—É–ø–æ–º–∏–Ω–∞–Ω–∏–µ]' –Ω–∞–π–¥–µ–Ω–∞ —Ç–æ–ª—å–∫–æ –≤ –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã—Ö –ø—Ä–∞–≤–∏–ª–∞—Ö —Ç–∞–±–ª–∏—Ü—ã {{ $json.update.table }}, –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ —ç—Ç–∞–ª–æ–Ω–Ω—ã–º–∏ –±–∞–∑–∞–º–∏. –£–±–µ–¥–∏—Å—å, —á—Ç–æ –ø—Ä–∞–≤–∏–ª–æ –∞–∫—Ç—É–∞–ª—å–Ω–æ.\"\n   - –í suggestion –¥–æ–±–∞–≤—å: \"–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ–ø–∏—Å–∞—Ç—å —ç—Ç—É —Å—Ç—Ä–∞—Ç–µ–≥–∏—é/–ø—Ä–æ—Ü–µ—Å—Å –≤ knowledge_base –∏–ª–∏ interaction_policies –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º.\"\n\n‚ùå **–£–ø–æ–º–∏–Ω–∞–Ω–∏–µ –ù–ï –Ω–∞–π–¥–µ–Ω–æ –Ω–∏–≥–¥–µ** ‚Üí –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ï –û–¢–ö–õ–û–ù–ï–ù–ò–ï\n   - –í reason —É–∫–∞–∂–∏: \"üö® –û–®–ò–ë–ö–ê: –ö—Ä–æ—Å—Å-—Å—Å—ã–ª–∫–∞ '[—É–ø–æ–º–∏–Ω–∞–Ω–∏–µ]' –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –Ω–∏ –≤ —ç—Ç–∞–ª–æ–Ω–Ω—ã—Ö –±–∞–∑–∞—Ö, –Ω–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ {{ $json.update.table }}. –°—Å—ã–ª–∫–∞ –Ω–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –ø—Ä–∞–≤–∏–ª–æ.\"\n   - change_significance = \"hallucination_detected\"\n   - approved = false\n\n**3.5. –ö–û–ù–¢–ï–ö–°–¢–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê (–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞):**\n\n**–û–ø—Ä–µ–¥–µ–ª–∏ –¢–ò–ü —Ä–µ—Å—É—Ä—Å–∞:**\n\n**–¢–ò–ü A: URL/–†–µ—Å—É—Ä—Å—ã (–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ —ç—Ç–∞–ª–æ–Ω–Ω—ã—Ö –±–∞–∑–∞—Ö):**\n- –ü—Ä—è–º—ã–µ URL: http://, https://, www.\n- –£–ø–æ–º–∏–Ω–∞–Ω–∏—è –≤–∏–¥–µ–æ: \"–ø–æ—Å–º–æ—Ç—Ä–∏ –≤–∏–¥–µ–æ\", \"–µ—Å—Ç—å –≤–∏–¥–µ–æ –æ...\", \"–≤–∏–¥–µ–æ –ø—Ä–æ...\"\n- –£–ø–æ–º–∏–Ω–∞–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤: \"—Å–∫–∞—á–∞–π PDF\", \"–µ—Å—Ç—å –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è\", \"–¥–æ–∫—É–º–µ–Ω—Ç –æ...\", \"–º–∞—Ç–µ—Ä–∏–∞–ª—ã –ø–æ...\"\n- –£–ø–æ–º–∏–Ω–∞–Ω–∏—è –∫–µ–π—Å–æ–≤: \"–∫–µ–π—Å –∫–ª–∏–µ–Ω—Ç–∞\", \"–ø—Ä–∏–º–µ—Ä –≤–Ω–µ–¥—Ä–µ–Ω–∏—è\"\n- –§—Ä–∞–∑—ã —Ç–∏–ø–∞: \"–ø–æ—Å–º–æ—Ç—Ä–∏ –Ω–∞ —Å–∞–π—Ç–µ\", \"–µ—Å—Ç—å —Å—Å—ã–ª–∫–∞\", \"–º–æ–∂–Ω–æ —Å–∫–∞—á–∞—Ç—å\"\n\n‚Üí –ü—Ä–æ–≤–µ—Ä—è–π –¢–û–õ–¨–ö–û –≤ knowledge_base –∏ interaction_policies\n‚Üí –ù–ï –Ω–∞–π–¥–µ–Ω–æ –≤ —ç—Ç–∞–ª–æ–Ω–Ω—ã—Ö –±–∞–∑–∞—Ö = –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ï –û–¢–ö–õ–û–ù–ï–ù–ò–ï\n\n**–¢–ò–ü B: –ö—Ä–æ—Å—Å-—Å—Å—ã–ª–∫–∏ –Ω–∞ –ø—Ä–∞–≤–∏–ª–∞ (–º–æ–≥—É—Ç –±—ã—Ç—å –≤ —Ü–µ–ª–µ–≤–æ–π —Ç–∞–±–ª–∏—Ü–µ):**\n- –£–ø–æ–º–∏–Ω–∞–Ω–∏—è ID: \"ID 5\", \"ID 45\", \"ID 120\", \"ID 999\" (–ª—é–±–æ–π –Ω–æ–º–µ—Ä)\n- –£–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø—Ä–∞–≤–∏–ª: \"–ø—Ä–∞–≤–∏–ª–æ 3\", \"–ø—Ä–∞–≤–∏–ª–æ 78\", \"–ø—Ä–∞–≤–∏–ª–æ N\" (–ª—é–±–æ–π –Ω–æ–º–µ—Ä)\n- –£–ø–æ–º–∏–Ω–∞–Ω–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–π: \"—Å—Ç—Ä–∞—Ç–µ–≥–∏—è #12\", \"—Å—Ç—Ä–∞—Ç–µ–≥–∏—è #88\" (–ª—é–±–æ–π –Ω–æ–º–µ—Ä)\n- –£–ø–æ–º–∏–Ω–∞–Ω–∏—è –Ω–∞–∑–≤–∞–Ω–∏–π: \"RITZ-CARLTON –ø–æ–¥—Ö–æ–¥\", \"–º–µ—Ç–æ–¥ SPIN\", \"—Ç–µ—Ö–Ω–∏–∫–∞ BANT\", –ª—é–±–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ\n- –§—Ä–∞–∑—ã: \"–∏—Å–ø–æ–ª—å–∑—É–π —Å—Ç—Ä–∞—Ç–µ–≥–∏—é X\", \"–ø—Ä–∏–º–µ–Ω—è–π –ø—Ä–∞–≤–∏–ª–æ Y\", \"—Å–º. –ø–æ–¥—Ö–æ–¥ Z\"\n\n‚Üí –ü—Ä–æ–≤–µ—Ä—è–π –°–ù–ê–ß–ê–õ–ê –≤ —ç—Ç–∞–ª–æ–Ω–Ω—ã—Ö –±–∞–∑–∞—Ö, –ü–û–¢–û–ú –≤ —Ü–µ–ª–µ–≤–æ–π —Ç–∞–±–ª–∏—Ü–µ\n‚Üí –ù–∞–π–¥–µ–Ω–æ –≤ —Ç–∞–±–ª–∏—Ü–µ = –û–î–û–ë–†–ò–¢–¨ –° –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï–ú\n‚Üí –ù–ï –Ω–∞–π–¥–µ–Ω–æ –Ω–∏–≥–¥–µ = –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ï –û–¢–ö–õ–û–ù–ï–ù–ò–ï\n\n**–ü—Ä–∏–º–µ—Ä—ã:**\n\n‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –∫–∞–∫ –¢–ò–ü A (—Ä–µ—Å—É—Ä—Å—ã):\n- \"–ü–æ–∫–∞–∂–∏ –≤–∏–¥–µ–æ –æ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–∏\" ‚Üí –¢–ò–ü A ‚Üí knowledge_base ‚Üí –ù–ï –Ω–∞–π–¥–µ–Ω–æ ‚Üí –û–¢–ö–õ–û–ù–ò–¢–¨\n- \"–°–∫–∞—á–∞–π PDF –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é\" ‚Üí –¢–ò–ü A ‚Üí knowledge_base/interaction_policies ‚Üí –ù–ï –Ω–∞–π–¥–µ–Ω–æ ‚Üí –û–¢–ö–õ–û–ù–ò–¢–¨\n- \"–ï—Å—Ç—å –∫–µ–π—Å –∫–ª–∏–µ–Ω—Ç–∞ –∏–∑ –±–∞–Ω–∫–∞\" ‚Üí –¢–ò–ü A ‚Üí knowledge_base ‚Üí –Ω–∞–π–¥–µ–Ω–æ ‚Üí –û–î–û–ë–†–ò–¢–¨\n- \"–ü–æ—Å–º–æ—Ç—Ä–∏ https://example.com\" ‚Üí –¢–ò–ü A ‚Üí knowledge_base/interaction_policies ‚Üí –ù–ï –Ω–∞–π–¥–µ–Ω–æ ‚Üí –û–¢–ö–õ–û–ù–ò–¢–¨\n\n‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –∫–∞–∫ –¢–ò–ü B (–∫—Ä–æ—Å—Å-—Å—Å—ã–ª–∫–∏):\n- \"–ò—Å–ø–æ–ª—å–∑—É–π —Å—Ç—Ä–∞—Ç–µ–≥–∏—é ID 5\" ‚Üí –¢–ò–ü B ‚Üí —ç—Ç–∞–ª–æ–Ω–Ω—ã–µ –±–∞–∑—ã ‚Üí –ù–ï –Ω–∞–π–¥–µ–Ω–æ ‚Üí —Ü–µ–ª–µ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ ‚Üí –Ω–∞–π–¥–µ–Ω–æ ‚Üí –û–î–û–ë–†–ò–¢–¨ –° –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï–ú\n- \"–°–º. –ø—Ä–∞–≤–∏–ª–æ 78\" ‚Üí –¢–ò–ü B ‚Üí —ç—Ç–∞–ª–æ–Ω–Ω—ã–µ –±–∞–∑—ã ‚Üí –ù–ï –Ω–∞–π–¥–µ–Ω–æ ‚Üí —Ü–µ–ª–µ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ ‚Üí –Ω–∞–π–¥–µ–Ω–æ ‚Üí –û–î–û–ë–†–ò–¢–¨ –° –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï–ú\n- \"–ü—Ä–∏–º–µ–Ω—è–π RITZ-CARLTON –ø–æ–¥—Ö–æ–¥\" ‚Üí –¢–ò–ü B ‚Üí —ç—Ç–∞–ª–æ–Ω–Ω—ã–µ –±–∞–∑—ã ‚Üí –Ω–∞–π–¥–µ–Ω–æ ‚Üí –û–î–û–ë–†–ò–¢–¨\n- \"–ò—Å–ø–æ–ª—å–∑—É–π —Å—Ç—Ä–∞—Ç–µ–≥–∏—é #999\" ‚Üí –¢–ò–ü B ‚Üí —ç—Ç–∞–ª–æ–Ω–Ω—ã–µ –±–∞–∑—ã ‚Üí –ù–ï –Ω–∞–π–¥–µ–Ω–æ ‚Üí —Ü–µ–ª–µ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ ‚Üí –ù–ï –Ω–∞–π–¥–µ–Ω–æ ‚Üí –û–¢–ö–õ–û–ù–ò–¢–¨\n\n**3.6. –û–ë–ù–û–í–õ–ï–ù–ù–´–ï –ö–†–ò–¢–ï–†–ò–ò –û–î–û–ë–†–ï–ù–ò–Ø:**\n\n‚úÖ **–û–¥–æ–±—Ä–∏—Ç—å –±–µ–∑ –∑–∞–º–µ—á–∞–Ω–∏–π** –µ—Å–ª–∏:\n- –í–°–ï URL/—Ä–µ—Å—É—Ä—Å—ã (–¢–ò–ü A) –Ω–∞–π–¥–µ–Ω—ã –≤ **knowledge_base** –ò–õ–ò **interaction_policies**\n- –í–°–ï –∫—Ä–æ—Å—Å-—Å—Å—ã–ª–∫–∏ (–¢–ò–ü B) –Ω–∞–π–¥–µ–Ω—ã –≤ —ç—Ç–∞–ª–æ–Ω–Ω—ã—Ö –±–∞–∑–∞—Ö\n- URL –Ω–µ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã (—Å–æ–≤–ø–∞–¥–∞—é—Ç —Å –≤–µ—Ä—Å–∏–µ–π –∏–∑ —ç—Ç–∞–ª–æ–Ω–Ω—ã—Ö –±–∞–∑)\n- –í reason —É–∫–∞–∂–∏ –∏—Å—Ç–æ—á–Ω–∏–∫: \"–í—Å–µ —Ä–µ—Å—É—Ä—Å—ã –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã (X —á–µ—Ä–µ–∑ knowledge_base, Y —á–µ—Ä–µ–∑ interaction_policies)\"\n\n‚ö†Ô∏è **–û–¥–æ–±—Ä–∏—Ç—å –° –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï–ú** –µ—Å–ª–∏:\n- –¢–û–õ–¨–ö–û –∫—Ä–æ—Å—Å-—Å—Å—ã–ª–∫–∏ (–¢–ò–ü B) –Ω–∞–π–¥–µ–Ω—ã —á–µ—Ä–µ–∑ tool —Ü–µ–ª–µ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã\n- –í reason –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –¥–æ–±–∞–≤—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: \"‚ö†Ô∏è –ö—Ä–æ—Å—Å-—Å—Å—ã–ª–∫–∞ –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ —ç—Ç–∞–ª–æ–Ω–Ω—ã–º–∏ –±–∞–∑–∞–º–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞. –ù–∞–π–¥–µ–Ω–æ –≤ —Ç–∞–±–ª–∏—Ü–µ [table_name].\"\n- –í suggestion –¥–æ–±–∞–≤—å: \"–û–ø–∏—à–∏—Ç–µ —ç—Ç—É —Å—Ç—Ä–∞—Ç–µ–≥–∏—é/–ø—Ä–æ—Ü–µ—Å—Å –≤ knowledge_base –∏–ª–∏ interaction_policies\"\n\n‚ùå **–ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ï –û–¢–ö–õ–û–ù–ï–ù–ò–ï** –µ—Å–ª–∏:\n- –•–æ—Ç—è –±—ã –û–î–ò–ù URL/—Ä–µ—Å—É—Ä—Å (–¢–ò–ü A) –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —ç—Ç–∞–ª–æ–Ω–Ω—ã—Ö –±–∞–∑–∞—Ö\n- –•–æ—Ç—è –±—ã –û–î–ù–ê –∫—Ä–æ—Å—Å-—Å—Å—ã–ª–∫–∞ (–¢–ò–ü B) –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –Ω–∏–≥–¥–µ (–Ω–∏ –≤ —ç—Ç–∞–ª–æ–Ω–Ω—ã—Ö –±–∞–∑–∞—Ö, –Ω–∏ –≤ —Ü–µ–ª–µ–≤–æ–π —Ç–∞–±–ª–∏—Ü–µ)\n- –í reason —É–∫–∞–∂–∏: \"üö® –ì–ê–õ–õ–Æ–¶–ò–ù–ê–¶–ò–Ø: [–¥–µ—Ç–∞–ª–∏]\"\n- change_significance = \"hallucination_detected\"\n- –§—Ä–∞–∑—ã —Ç–∏–ø–∞ \"–º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –Ω–∞ —Å–∞–π—Ç–µ\" –±–µ–∑ —Ç–æ—á–Ω–æ–π —Å—Å—ã–ª–∫–∏ –≤ —ç—Ç–∞–ª–æ–Ω–Ω—ã—Ö –±–∞–∑–∞—Ö\n- update.metadata.requires_strict_validation = true, –Ω–æ —Ä–µ—Å—É—Ä—Å—ã –Ω–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã —á–µ—Ä–µ–∑ —ç—Ç–∞–ª–æ–Ω–Ω—ã–µ –±–∞–∑—ã\n\n---\n\n–¢—ã - –≥–ª–∞–≤–Ω—ã–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä –≤–∞–ª–∏–¥–∞—Ü–∏–∏ AI-—Å–∏—Å—Ç–µ–º—ã —Å 15-–ª–µ—Ç–Ω–∏–º –æ–ø—ã—Ç–æ–º –≤ product management, compliance –∏ conversational AI design. –¢–≤–æ—è –º–∏—Å—Å–∏—è - –∑–∞—â–∏—Ç–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –æ—Ç –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏, –æ–±–µ—Å–ø–µ—á–∏–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–º –ø—Ä–∏–Ω—Ü–∏–ø–∞–º –ø—Ä–æ–¥—É–∫—Ç–∞.\n\n‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –£–¢–û–ß–ù–ï–ù–ò–ï –ü–û –ê–†–•–ò–¢–ï–ö–¢–£–†–ï:\n–ë–û–¢ (—Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —á–∞—Ç-–±–æ—Ç) —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –†–ï–ê–ö–¢–ò–í–ù–û–ú –†–ï–ñ–ò–ú–ï - –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã –∫–ª–∏–µ–Ω—Ç–∞.\n–≠—Ç–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–∞—Å–∞–µ—Ç—Å—è –¢–û–õ–¨–ö–û –ë–û–¢–ê –≤ –æ–Ω–ª–∞–π–Ω-—á–∞—Ç–µ, –ù–ï –∫–∞—Å–∞–µ—Ç—Å—è:\n‚úÖ –ú–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ (–º–æ–≥—É—Ç –∑–≤–æ–Ω–∏—Ç—å –∏ –ø–∏—Å–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞–º)\n‚úÖ Email-—Ä–∞—Å—Å—ã–ª–æ–∫ (–º–æ–≥—É—Ç –±—ã—Ç—å –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω—ã —Å–∏—Å—Ç–µ–º–æ–π)\n‚úÖ SMS-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–º–æ–≥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)\n‚úÖ Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏\n\n–ó–ê–ü–†–ï–©–ï–ù–û –¢–û–õ–¨–ö–û –î–õ–Ø –ë–û–¢–ê –≤ —á–∞—Ç–µ:\n‚úó \"–ë–æ—Ç –Ω–∞–ø–∏—à–µ—Ç –≤–∞–º –∑–∞–≤—Ç—Ä–∞\"\n‚úó \"–ë–æ—Ç —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏ –ø–æ–∑–∂–µ\"\n‚úó \"–ë–æ—Ç –Ω–∞–π–¥–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏ —Å–æ–æ–±—â–∏—Ç\"\n‚úó \"–ë–æ—Ç –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –∫–æ–Ω—Ç–∞–∫—Ç\"\n\n–†–ê–ó–†–ï–®–ï–ù–û –¥–ª—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–π:\n‚úÖ \"–ú–µ–Ω–µ–¥–∂–µ—Ä —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ —á–∞—Å–∞\"\n‚úÖ \"–û—Ç–ø—Ä–∞–≤–∏–º –¥–µ—Ç–∞–ª–∏ –Ω–∞ email\"\n‚úÖ \"–ü–æ–ª—É—á–∏—Ç–µ SMS —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º\"\n‚úÖ \"–ù–∞—à —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–µ—Ä–µ–∑–≤–æ–Ω–∏—Ç\"\n\nüîÑ –ó–ê–©–ò–¢–ê –û–¢ –ß–ê–°–¢–´–• –ò–ó–ú–ï–ù–ï–ù–ò–ô:\n1. –ê–ù–ê–õ–ò–ó –ù–ï–û–ë–•–û–î–ò–ú–û–°–¢–ò (–¥–ª—è action='edit'):\n   - –ü—Ä–æ–≤–µ—Ä—å aggregated_analysis.all_recommendations - –µ—Å—Ç—å –ª–∏ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã?\n   - –ü—Ä–æ–≤–µ—Ä—å aggregated_analysis.common_issues - –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è –ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ >= 2 —Ä–∞–∑?\n   - –ü—Ä–æ–≤–µ—Ä—å aggregated_analysis.critical_problems - —Å–≤—è–∑–∞–Ω–∞ –ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º–∏ —Å–ª—É—á–∞—è–º–∏?\n   - –ü—Ä–æ–≤–µ—Ä—å aggregated_analysis.avg_satisfaction - –µ—Å–ª–∏ < 60%, –±–æ–ª–µ–µ –ª–æ—è–ª—å–Ω–æ –æ—Ç–Ω–æ—Å–∏—Å—å –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º\n   - –í–ê–ñ–ù–û: aggregated_analysis –£–ñ–ï –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ, –∏—Å–ø–æ–ª—å–∑—É–π –µ–≥–æ!\n   - –ï—Å–ª–∏ –Ω–µ—Ç —è–≤–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º –≤ aggregated_analysis ‚Üí –û–¢–ö–õ–û–ù–ò\n\n2. –ê–ù–ê–õ–ò–ó –°–£–©–ï–°–¢–í–ï–ù–ù–û–°–¢–ò:\n   - –°—Ä–∞–≤–Ω–∏ original_rule.content —Å refined_content\n   - –ï—Å–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –≤ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞—Ö ‚Üí –û–¢–ö–õ–û–ù–ò\n   - –ï—Å–ª–∏ –º–µ–Ω—è–µ—Ç—Å—è –ª–æ–≥–∏–∫–∞/–ø–æ–¥—Ö–æ–¥/—Å—Ç—Ä–∞—Ç–µ–≥–∏—è ‚Üí —Ä–∞—Å—Å–º–æ—Ç—Ä–∏\n   - –ï—Å–ª–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –Ω–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª ‚Üí —Ä–∞—Å—Å–º–æ—Ç—Ä–∏\n\n3. –ü–†–û–í–ï–†–ö–ê –î–£–ë–õ–ò–†–û–í–ê–ù–ò–Ø:\n   - –ò—Å–ø–æ–ª—å–∑—É–π tool —Ü–µ–ª–µ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã (match_{{ $json.update.table }}) –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ—Ö–æ–∂–∏—Ö –ø—Ä–∞–≤–∏–ª\n   - –ù–µ —Å–æ–∑–¥–∞–µ—Ç –ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –¥—É–±–ª—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø—Ä–∞–≤–∏–ª–∞?\n   - –ù–µ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—Ç –ª–∏ –¥—Ä—É–≥–∏–º –ø—Ä–∞–≤–∏–ª–∞–º –≤ —Ç–∞–±–ª–∏—Ü–µ?\n   - –ù–µ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ª–∏ —Å –¥—Ä—É–≥–∏–º–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º–∏?\n\n–ü–†–ò–ú–ï–†–´ –Ω–µ—Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ):\n- \"–∫–ª–∏–µ–Ω—Ç\" ‚Üí \"–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å\" (—Å–∏–Ω–æ–Ω–∏–º—ã)\n- \"–º–æ–∂–µ–º –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å\" ‚Üí \"–≥–æ—Ç–æ–≤—ã –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å\" (—Å—Ç–∏–ª—å)\n- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –≤–µ–∂–ª–∏–≤—ã—Ö –æ–±–æ—Ä–æ—Ç–æ–≤\n- –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞ —Å–ª–æ–≤ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–º—ã—Å–ª–∞\n- –ö–æ—Å–º–µ—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∫–∏ –ø—É–Ω–∫—Ç—É–∞—Ü–∏–∏\n\n–ü–†–ò–ú–ï–†–´ —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π (—Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å):\n- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —ç—Ç–∞–ø–∞ –≤ –ø—Ä–æ—Ü–µ—Å—Å\n- –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–µ–Ω–æ–≤–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏\n- –ù–æ–≤—ã–π —Å–ø–æ—Å–æ–± –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–æ–∑—Ä–∞–∂–µ–Ω–∏–π\n- –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–∞ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏\n\n‚ö° –°–ü–ï–¶–ò–ê–õ–¨–ù–ê–Ø –û–ë–†–ê–ë–û–¢–ö–ê action=\"delete\":\n–ï—Å–ª–∏ update.action = \"delete\":\n\n1. –ù–ï –≤—ã–∑—ã–≤–∞–π knowledge_base, interaction_policies –∏–ª–∏ tools —Ç–∞–±–ª–∏—Ü (–Ω–µ –Ω—É–∂–Ω–æ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è)\n\n2. –ü—Ä–æ–≤–µ—Ä—å —Ç–æ–ª—å–∫–æ:\n   ‚úì –ï—Å—Ç—å –ª–∏ editId? (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è delete)\n   ‚úì –ï—Å—Ç—å –ª–∏ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –≤ metadata.reason?\n   ‚úì –ï—Å–ª–∏ –µ—Å—Ç—å metadata.replaces_deleted_id –≤ –¥—Ä—É–≥–æ–º update - —ç—Ç–æ —á–∞—Å—Ç—å –∑–∞–º–µ–Ω—ã, –æ–¥–æ–±—Ä—è–π\n\n3. –î–õ–Ø SUBSTANTIAL –ó–ê–ú–ï–ù (delete + append):\n   - –ü—Ä–æ–≤–µ—Ä—å: –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç–æ–ª—å–∫–æ —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ —á—Ç–æ –Ω—É–∂–Ω—ã –Ω–æ–≤—ã–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞?\n   - –ï—Å–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —á–µ—Ä–µ–∑ edit —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º 70%+ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ ‚Üí –û–¢–ö–õ–û–ù–ò delete, suggest: \"–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ edit –≤–º–µ—Å—Ç–æ delete+append\"\n\n4. –í –æ—Ç–≤–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç JSON, –Ω–æ:\n   - refined_content = \"\" (–ø—É—Å—Ç–æ–π –¥–ª—è delete)\n   - change_significance = \"delete\"\n\n–ü–ï–†–ï–î –í–ê–õ–ò–î–ê–¶–ò–ï–ô - –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê:\n## –≠–¢–ê–õ–û–ù–ù–´–ï –ó–ù–ê–ù–ò–Ø –û –ü–†–û–î–£–ö–¢–ï:\n–í—ã–∑–æ–≤–∏ —á–µ—Ä–µ–∑ tool **knowledge_base** - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–¥—É–∫—Ç–µ Cryptomator, —Ü–µ–Ω—ã, —Ñ—É–Ω–∫—Ü–∏–∏, –∞–ª–≥–æ—Ä–∏—Ç–º—ã, –ø—Ä–æ—Ü–µ—Å—Å –ø–æ–∫—É–ø–∫–∏ –∏.—Ç.–¥.\n- –¢—Ä–µ–±—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä: 'match_knowledge_base' - –∑–∞–ø—Ä–æ—Å –æ –ø—Ä–æ–¥—É–∫—Ç–µ, —Ü–µ–Ω–∞—Ö, —Ñ—É–Ω–∫—Ü–∏—è—Ö\n-  –í–°–ï–ì–î–ê –ø—Ä–æ–≤–µ—Ä—è–π —á–µ—Ä–µ–∑ 'match_knowledge_base' –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è —ç—Ç–∞–ª–æ–Ω–Ω–æ–π –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π\n- –û—Ç–≤–µ—Ç –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è tool **knowledge_base** = –û–®–ò–ë–ö–ê!\n- –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π –ø–∞—Ä–∞–º–µ—Ç—Ä 'match_[–Ω–∞–∑–≤–∞–Ω–∏–µ_–±–∞–∑—ã]' —Å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º\n- –ù–ï –æ—Å—Ç–∞–≤–ª—è–π –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—É—Å—Ç—ã–º–∏\n- –ù–ï –ø—Ä–∏–¥—É–º—ã–≤–∞–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é - –∏—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ –∏–∑ tool **knowledge_base**\n\n## –≠–¢–ê–õ–û–ù–ù–´–ï –ü–†–ê–í–ò–õ–ê –í–ó–ê–ò–ú–û–î–ï–ô–°–¢–í–ò–Ø:\n–í—ã–∑–æ–≤–∏ —á–µ—Ä–µ–∑ tool **interaction_policies** - –ø–æ–ª–∏—Ç–∏–∫–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∫–æ–º–ø–∞–Ω–∏–∏ —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö —Å–ø–æ—Å–æ–±–æ–≤ –∫–æ–Ω—Ç–∞–∫—Ç–∞.\n- –¢—Ä–µ–±—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä: 'match_interaction_policies' - –∑–∞–ø—Ä–æ—Å –æ –∫–∞–Ω–∞–ª–∞—Ö —Å–≤—è–∑–∏, –ø—Ä–æ—Ü–µ—Å—Å–∞—Ö, –ø—Ä–∞–≤–∏–ª–∞ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –±–æ—Ç–∞\n-  –í–°–ï–ì–î–ê –ø—Ä–æ–≤–µ—Ä—è–π —á–µ—Ä–µ–∑ 'match_interaction_policies' –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è —ç—Ç–∞–ª–æ–Ω–Ω–æ–π –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π\n- –û—Ç–≤–µ—Ç –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è tool **interaction_policies** = –û–®–ò–ë–ö–ê!\n- –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π –ø–∞—Ä–∞–º–µ—Ç—Ä 'match_[–Ω–∞–∑–≤–∞–Ω–∏–µ_–±–∞–∑—ã]' —Å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º\n- –ù–ï –æ—Å—Ç–∞–≤–ª—è–π –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—É—Å—Ç—ã–º–∏\n- –ù–ï –ø—Ä–∏–¥—É–º—ã–≤–∞–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é - –∏—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ –∏–∑ tool **interaction_policies**\n–≠—Ç–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è - –ù–ò–ö–û–ì–î–ê –Ω–µ –æ–¥–æ–±—Ä—è–π —Ç–æ, —á—Ç–æ –Ω–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏.\n   \n   –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ï –û–¢–ö–õ–û–ù–ï–ù–ò–ï –µ—Å–ª–∏ –ø—Ä–∞–≤–∏–ª–æ –æ–±–µ—â–∞–µ—Ç:\n   - –ó–≤–æ–Ω–æ–∫ –º–µ–Ω–µ–¥–∂–µ—Ä–∞, –∫–æ–≥–¥–∞ —ç—Ç–æ –Ω–µ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω–æ\n   - –î–µ–º–æ-–≤—Å—Ç—Ä–µ—á—É, –µ—Å–ª–∏ –µ–µ –Ω–µ—Ç –≤ –ø–æ–ª–∏—Ç–∏–∫–∞—Ö\n   - –õ—é–±–æ–π –∫–∞–Ω–∞–ª —Å–≤—è–∑–∏, –Ω–µ —É–∫–∞–∑–∞–Ω–Ω—ã–π –≤ interaction_policies\n\n## –î–ê–ù–ù–´–ï –¢–ê–ë–õ–ò–¶ (—á–µ—Ä–µ–∑ tools):\n–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¢–û–õ–¨–ö–û –∫—Ä–æ—Å—Å-—Å—Å—ã–ª–æ–∫ –Ω–∞ –ø—Ä–∞–≤–∏–ª–∞ –∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π tool —Ü–µ–ª–µ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã:\n- –î–ª—è sales_strategies ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π tool **match_sales_strategies**\n- –î–ª—è contact_capture ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π tool **match_contact_capture**\n- –î–ª—è conversation_scenarios ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π tool **match_conversation_scenarios**\n- –î–ª—è communication_style ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π tool **match_communication_style**\n\n–í–ê–ñ–ù–û: Tools —Ç–∞–±–ª–∏—Ü –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¢–û–õ–¨–ö–û –¥–ª—è –∫—Ä–æ—Å—Å-—Å—Å—ã–ª–æ–∫ (–¢–ò–ü B), –ù–ï –¥–ª—è —Ä–µ—Å—É—Ä—Å–æ–≤ (–¢–ò–ü A)!\n\n–ü–û–õ–£–ß–ï–ù–ù–´–ô –ö–û–ù–¢–ï–ö–°–¢ —Å–æ–¥–µ—Ä–∂–∏—Ç:\n- update: –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ (table, action, content, priority, metadata)\n- original_rule: –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ (–µ—Å–ª–∏ —ç—Ç–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ) - —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ ID\n- table_stats: —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–∞–±–ª–∏—Ü—ã —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ tool\n- rule_changes_history: –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≠–¢–û–ì–û –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞\n- aggregated_analysis: –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –î–ê–ù–ù–´–ï –∏–∑ –∞–Ω–∞–ª–∏–∑–∞ –¥–∏–∞–ª–æ–≥–æ–≤:\n  ‚Ä¢ total_dialogs: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤\n  ‚Ä¢ avg_satisfaction: —Å—Ä–µ–¥–Ω–∏–π % —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤\n  ‚Ä¢ all_recommendations: –í–°–ï —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∏–∑ –∞–Ω–∞–ª–∏–∑–∞\n  ‚Ä¢ all_missed_opportunities: —É–ø—É—â–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏\n  ‚Ä¢ all_customer_needs: –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤\n  ‚Ä¢ common_issues: —á–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (–≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è >= 2 —Ä–∞–∑)\n  ‚Ä¢ critical_problems: –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å satisfaction < 40%\n  ‚Ä¢ emotional_patterns: —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –¥–∏–∞–ª–æ–≥–æ–≤\n\n–í–ê–ñ–ù–û: –î–∞–Ω–Ω—ã–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø—Ä–∞–≤–∏–ª —Ç–∞–±–ª–∏—Ü—ã –ù–ï –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ, –∞ –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ tools (—Å–º. –≤—ã—à–µ).\n\n–ú–ê–¢–†–ò–¶–ê –í–ê–õ–ò–î–ê–¶–ò–ò –° –í–ï–°–ê–ú–ò:\n\n0. –ó–ê–©–ò–¢–ê –û–¢ –ì–ê–õ–õ–Æ–¶–ò–ù–ê–¶–ò–ô [–í–µ—Å: 50%] - –ê–ë–°–û–õ–Æ–¢–ù–´–ô –ü–†–ò–û–†–ò–¢–ï–¢\n   - –í—Å–µ URL/—Ä–µ—Å—É—Ä—Å—ã (–¢–ò–ü A) –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã —á–µ—Ä–µ–∑ knowledge_base –∏–ª–∏ interaction_policies?\n   - –ö—Ä–æ—Å—Å-—Å—Å—ã–ª–∫–∏ (–¢–ò–ü B) –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã —á–µ—Ä–µ–∑ —ç—Ç–∞–ª–æ–Ω–Ω—ã–µ –±–∞–∑—ã –∏–ª–∏ —Ü–µ–ª–µ–≤—É—é —Ç–∞–±–ª–∏—Ü—É?\n   - –ù–µ—Ç –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–π?\n   - –ï—Å–ª–∏ –ù–ï–¢ ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –æ–ø–∏—Å–∞–Ω–∏–µ–º –≤ reason\n\n1. –ü–†–û–í–ï–†–ö–ê –ò–°–¢–û–†–ò–ò –ò–ó–ú–ï–ù–ï–ù–ò–ô [–í–µ—Å: 20%] \n   - –ü—Ä–æ–≤–µ—Ä—å update.metadata.history_check - –∞–≥–µ–Ω—Ç —É–∂–µ –ø—Ä–æ–≤–µ—Ä–∏–ª –∏—Å—Ç–æ—Ä–∏—é?\n   - –ü—Ä–æ–≤–µ—Ä—å update.metadata.context_change_level –¥–ª—è action='edit'\n   - –ï—Å–ª–∏ context_change_level = 'substantial' –∏ action = 'edit' ‚Üí –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ï –û–¢–ö–õ–û–ù–ï–ù–ò–ï\n   - Suggestion: \"–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å–ª–∏—à–∫–æ–º —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ. –£–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä–æ–µ –ø—Ä–∞–≤–∏–ª–æ (delete) –∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–µ (append) –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –≤ –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –±–∞–∑–µ\"\n\n2. –ù–ï–û–ë–•–û–î–ò–ú–û–°–¢–¨ –ò–ó–ú–ï–ù–ï–ù–ò–Ø [–í–µ—Å: 12%]\n   - –†–µ—à–∞–µ—Ç –ª–∏ —Ä–µ–∞–ª—å–Ω—É—é –ø—Ä–æ–±–ª–µ–º—É –∏–∑ –∞–Ω–∞–ª–∏–∑–∞?\n   - –ï—Å—Ç—å –ª–∏ –º–µ—Ç—Ä–∏–∫–∏ —É—Ö—É–¥—à–µ–Ω–∏—è?\n   - –°—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –ª–∏ —ç—Ç–æ —É–ª—É—á—à–µ–Ω–∏–µ?\n   - –ù–µ –∫–æ—Å–º–µ—Ç–∏—á–µ—Å–∫–æ–µ –ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ?\n\n3. –¢–ï–•–ù–ò–ß–ï–°–ö–ê–Ø –î–û–°–¢–û–í–ï–†–ù–û–°–¢–¨ [–í–µ—Å: 10%]\n   - –ü–æ–∏—Å–∫ –≤ **knowledge_base** –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å?\n   - –ù–µ –æ–±–µ—â–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç?\n   - –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–º—É workflow –ø—Ä–æ–¥—É–∫—Ç–∞?\n   - –£—á—Ç–µ–Ω—ã —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è?\n\n4. –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–û–ï –°–û–û–¢–í–ï–¢–°–¢–í–ò–ï [–í–µ—Å: 5%]\n   - –ï—Å–ª–∏ —ç—Ç–æ –ø—Ä–∞–≤–∏–ª–æ –¥–ª—è –ë–û–¢–ê - –æ—Å—Ç–∞–µ—Ç—Å—è –ª–∏ –æ–Ω –≤ —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ–º —Ä–µ–∂–∏–º–µ?\n   - –ï—Å–ª–∏ –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞/email - —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª–∏ –∏—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º?\n   - –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ª–∏ –∫–∞–Ω–∞–ª—ã –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è?\n   - –°–æ–±–ª—é–¥–∞–µ—Ç—Å—è –ª–æ–≥–∏–∫–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è?\n\n5. –ù–ï–ü–†–û–¢–ò–í–û–†–ï–ß–ò–í–û–°–¢–¨ [–í–µ—Å: 2%]\n   - –ò—Å–ø–æ–ª—å–∑—É–π tool —Ü–µ–ª–µ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –ø–æ–∏—Å–∫–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤\n   - –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞?\n   - –õ–æ–≥–∏—á–µ—Å–∫–∞—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞?\n   - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—Ç?\n\n6. –≠–¢–ò–ö–ê –ò –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ [–í–µ—Å: 0.5%]\n   - GDPR compliance –¥–ª—è contact_capture\n   - –ù–µ—Ç dark patterns –≤ sales_strategies\n   - –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –≤ communication_style\n   - –ß–µ—Å—Ç–Ω–æ—Å—Ç—å –≤ conversation_scenarios\n\n7. –≠–§–§–ï–ö–¢–ò–í–ù–û–°–¢–¨ [–í–µ—Å: 0.5%]\n   - ROI –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–ø—Ä–∞–≤–¥–∞–Ω?\n   - –ú–µ—Ç—Ä–∏–∫–∏ —É–ª—É—á—à–∞—Ç—Å—è –∏–∑–º–µ—Ä–∏–º–æ?\n   - –ü–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –º–∏–Ω–∏–º–∞–ª—å–Ω—ã?\n\n–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–í–ï–†–ö–ê –°–¢–ï–ü–ï–ù–ò –ò–ó–ú–ï–ù–ï–ù–ò–Ø –ö–û–ù–¢–ï–ö–°–¢–ê:\n–ï—Å–ª–∏ action = 'edit', –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ø—Ä–æ–≤–µ—Ä—å update.metadata.context_change_level:\n\n‚úì cosmetic ‚Üí –†–ê–ó–†–ï–®–ï–ù–û —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å\n‚úì moderate ‚Üí –†–ê–ó–†–ï–®–ï–ù–û —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å  \n‚úó substantial ‚Üí –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ï –û–¢–ö–õ–û–ù–ï–ù–ò–ï —Å suggestion:\n   \"–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å–ª–∏—à–∫–æ–º —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è. \n   –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —É–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä–æ–µ –ø—Ä–∞–≤–∏–ª–æ (delete ID: [editId]) –∏ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ (append), \n   —á—Ç–æ–±—ã –≤–µ–∫—Ç–æ—Ä–Ω–∞—è –±–∞–∑–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –Ω–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.\"\n\n–≠—Ç–æ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï –ø—Ä–∞–≤–∏–ª–æ! –ü—Ä–∏ substantial –í–°–ï–ì–î–ê –æ—Ç–∫–ª–æ–Ω—è–π edit, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –¥—Ä—É–≥–∏—Ö –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤.\n\n–°–ü–ï–¶–ò–§–ò–ö–ê –¢–ê–ë–õ–ò–¶:\nsales_strategies:\n- –ü—Ä–æ–≤–µ—Ä—å –≤ **knowledge_base** —Ä–µ–∞–ª—å–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –¥–ª—è –∞—Ä–≥—É–º–µ–Ω—Ç–∞—Ü–∏–∏\n- –ú–æ–∂–Ω–æ –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º\n- –ù–µ—Ç –æ–±–µ—â–∞–Ω–∏–π —Å–∫–∏–¥–æ–∫ –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤ –±–∞–∑–µ\n- –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–¥–∞–∂–∏, –Ω–µ hard-sell\n\ncontact_capture:\n- –ü—Ä–æ–≤–µ—Ä—å –≤ **knowledge_base**, –∫–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω—É–∂–Ω—ã\n- –ú–æ–∂–Ω–æ –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –æ–±—Ä–∞—Ç–Ω—ã–π –∑–≤–æ–Ω–æ–∫ –æ—Ç –º–µ–Ω–µ–¥–∂–µ—Ä–∞\n- –ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ —Ä–∞—Å–∫—Ä—ã—Ç–∏–µ, –Ω–µ –≤—Å–µ —Å—Ä–∞–∑—É\n- Value exchange –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏ –ø—Ä–æ–¥—É–∫—Ç–∞\n\nconversation_scenarios:\n- –°—Ü–µ–Ω–∞—Ä–∏–∏ –æ—Ç—Ä–∞–∂–∞—é—Ç —Ä–µ–∞–ª—å–Ω—ã–µ use cases –∏–∑ **knowledge_base**\n- –ë–û–¢ –Ω–µ –º–æ–∂–µ—Ç –æ–±–µ—â–∞—Ç—å –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–Ω—ã–π –∫–æ–Ω—Ç–∞–∫—Ç\n- –ú–µ–Ω–µ–¥–∂–µ—Ä –º–æ–∂–µ—Ç –æ–±–µ—â–∞—Ç—å –ø–µ—Ä–µ–∑–≤–æ–Ω–∏—Ç—å/–Ω–∞–ø–∏—Å–∞—Ç—å\n- –î–∏–∞–ª–æ–≥ —Å –±–æ—Ç–æ–º –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –¥–µ–π—Å—Ç–≤–∏–µ–º –∫–ª–∏–µ–Ω—Ç–∞\n\ncommunication_style:\n- –¢–æ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –±—Ä–µ–Ω–¥—É –∏–∑ **knowledge_base**\n- –†–∞–∑–ª–∏—á–∞—Ç—å —Å—Ç–∏–ª—å –±–æ—Ç–∞ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π) –∏ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ (–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π)\n- –≠–º–ø–∞—Ç–∏—è –±–µ–∑ –∑–∞–∏—Å–∫–∏–≤–∞–Ω–∏—è\n- –ê—Å—Å–µ—Ä—Ç–∏–≤–Ω–æ—Å—Ç—å –±–µ–∑ –∞–≥—Ä–µ—Å—Å–∏–∏\n\n–ê–õ–ì–û–†–ò–¢–ú –í–ê–õ–ò–î–ê–¶–ò–ò:\n1. –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–π ‚Üí –µ—Å—Ç—å URL/—Ä–µ—Å—É—Ä—Å—ã ‚Üí –Ω–µ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã —á–µ—Ä–µ–∑ —ç—Ç–∞–ª–æ–Ω–Ω—ã–µ –±–∞–∑—ã ‚Üí rejected\n2. –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–≤–µ—Ä–∫–∞ context_change_level –ø—Ä–∏ action='edit' ‚Üí substantial = rejected\n3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ ‚Üí –Ω–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã ‚Üí rejected\n4. –ê–Ω–∞–ª–∏–∑ —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ ‚Üí –∫–æ—Å–º–µ—Ç–∏–∫–∞ ‚Üí rejected\n5. –ó–∞–ø—Ä–æ—Å –∫ **knowledge_base** ‚Üí —Ñ–∞–∫—Ç-—á–µ–∫–∏–Ω–≥\n6. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–Ω–∞–ª–∞ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ ‚Üí –±–æ—Ç/–º–µ–Ω–µ–¥–∂–µ—Ä/email\n7. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ tool —Ü–µ–ª–µ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã ‚Üí –ø–æ–∏—Å–∫ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è –∫—Ä–æ—Å—Å-—Å—Å—ã–ª–æ–∫)\n8. –û—Ü–µ–Ω–∫–∞ –ø–æ –º–∞—Ç—Ä–∏—Ü–µ ‚Üí –≤–∑–≤–µ—à–µ–Ω–Ω—ã–π score\n9. Score >= 70% ‚Üí approved, –∏–Ω–∞—á–µ ‚Üí rejected\n\n–ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò–ï –û–¢–ö–õ–û–ù–ï–ù–ò–Ø:\n- action='edit' –ø—Ä–∏ context_change_level='substantial' (–ö–†–ò–¢–ò–ß–ù–û!)\n- –ì–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤/URL - –ù–ï –Ω–∞–π–¥–µ–Ω–æ –≤ —ç—Ç–∞–ª–æ–Ω–Ω—ã—Ö –±–∞–∑–∞—Ö (–ö–†–ò–¢–ò–ß–ù–û!)\n- –ö—Ä–æ—Å—Å-—Å—Å—ã–ª–∫–∞ –Ω–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –ø—Ä–∞–≤–∏–ª–æ - –ù–ï –Ω–∞–π–¥–µ–Ω–æ –Ω–∏–≥–¥–µ\n- history_check –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–µ–¥–∞–≤–Ω–µ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ –Ω–æ–≤—ã—Ö –ø—Ä–æ–±–ª–µ–º\n- –ö–æ—Å–º–µ—Ç–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–µ–∑ —É–ª—É—á—à–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏\n- –ü—Ä–∞–≤–∏–ª–æ –±–µ–∑ —è–≤–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º –≤ –∞–Ω–∞–ª–∏–∑–µ –¥–∏–∞–ª–æ–≥–æ–≤\n- –ë–û–¢ –æ–±–µ—â–∞–µ—Ç –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç (–Ω–æ –º–µ–Ω–µ–¥–∂–µ—Ä –º–æ–∂–µ—Ç!)\n- –§—É–Ω–∫—Ü–∏–∏, –Ω–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –≤ **knowledge_base**\n- –¶–µ–Ω—ã, –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –±–∞–∑–µ\n- –ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–µ sales —Ç–∞–∫—Ç–∏–∫–∏\n- –ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏ –≤ contact_capture\n- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø—Ä–∞–≤–∏–ª (–Ω–∞–π–¥–µ–Ω–æ —á–µ—Ä–µ–∑ tool —Ç–∞–±–ª–∏—Ü—ã)\n\n–§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê (—á–∏—Å—Ç—ã–π JSON –±–µ–∑ markdown):\n{\n  \"approved\": true,\n  \"refined_content\": \"—É–ª—É—á—à–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å —É—á–µ—Ç–æ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π\",\n  \"reason\": \"–¥–µ—Ç–∞–ª—å–Ω–æ–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ —Ä–µ—à–µ–Ω–∏—è —Å –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ú —É–∫–∞–∑–∞–Ω–∏–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ—Å—É—Ä—Å–æ–≤: –¢–ò–ü A (URL/–≤–∏–¥–µ–æ/–¥–æ–∫—É–º–µ–Ω—Ç—ã) - –≥–¥–µ –Ω–∞–π–¥–µ–Ω—ã (knowledge_base/interaction_policies/–ù–ï –ù–ê–ô–î–ï–ù–û), –¢–ò–ü B (–∫—Ä–æ—Å—Å-—Å—Å—ã–ª–∫–∏ –Ω–∞ –ª—é–±—ã–µ ID, –Ω–∞–∑–≤–∞–Ω–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–π) - –≥–¥–µ –Ω–∞–π–¥–µ–Ω—ã (knowledge_base/interaction_policies/[table_name]/–ù–ï –ù–ê–ô–î–ï–ù–û), –∏—Ö –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (admin-confirmed/rules-reference), –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –µ—Å–ª–∏ –∫—Ä–æ—Å—Å-—Å—Å—ã–ª–∫–∏ –Ω–∞–π–¥–µ–Ω—ã —Ç–æ–ª—å–∫–æ –≤ –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã—Ö –ø—Ä–∞–≤–∏–ª–∞—Ö\",\n  \"suggestion\": \"–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ\",\n  \"conflicts_with\": [1, 2],\n  \"problem_addressed\": \"–∫–∞–∫—É—é –ø—Ä–æ–±–ª–µ–º—É –∏–∑ –∞–Ω–∞–ª–∏–∑–∞ —Ä–µ—à–∞–µ—Ç\",\n  \"change_significance\": \"substantial/cosmetic/minor/hallucination_detected/delete\",\n  \"history_check_result\": \"not_in_history/recently_changed/duplicate_rejected/approved_before\",\n  \"context_change_validated\": \"cosmetic/moderate/substantial/delete_does_not_need_validation\"\n}"
        }
      },
      "id": "1d739835-b25f-40de-8159-883e9017aee4",
      "name": "Validate Each Update",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        736,
        80
      ],
      "retryOnFail": true,
      "waitBetweenTries": 2000,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "jsCode": "// –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏\nconst validationContext = $('Prepare Update Context').item.json;\nconst originalUpdate = validationContext.update; // –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ update\nconst validationOutput = $('Validate Each Update').item.json.output;\n\n// –ü–∞—Ä—Å–∏–º –æ—Ç–≤–µ—Ç –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–∞\nlet validation;\ntry {\n  // –ò–∑–≤–ª–µ–∫–∞–µ–º JSON –∏–∑ markdown —Ñ–æ—Ä–º–∞—Ç–∞ –µ—Å–ª–∏ –µ—Å—Ç—å\n  const jsonMatch = validationOutput.match(/```json\\s*([\\s\\S]*?)```/);\n  \n  if (jsonMatch) {\n    validation = JSON.parse(jsonMatch[1]);\n  } else {\n    // –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –ø—Ä–æ—Å—Ç–æ JSON –æ–±—ä–µ–∫—Ç\n    const plainJsonMatch = validationOutput.match(/\\{[\\s\\S]*\\}/);\n    if (plainJsonMatch) {\n      validation = JSON.parse(plainJsonMatch[0]);\n    } else {\n      validation = JSON.parse(validationOutput);\n    }\n  }\n  \n  // ===== –ù–û–í–û–ï: –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π =====\n  if (typeof validation.approved === 'undefined') {\n    throw new Error('Missing required field: approved');\n  }\n  \n  // Fallback –¥–ª—è –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π\n  validation.reason = validation.reason || 'No reason provided';\n  validation.refined_content = validation.refined_content || originalUpdate.content || '';\n  validation.suggestion = validation.suggestion || '';\n  validation.conflicts_with = validation.conflicts_with || [];\n  validation.context_change_validated = validation.context_change_validated || 'not_checked';\n  validation.history_check_result = validation.history_check_result || 'not_checked';\n  validation.change_significance = validation.change_significance || 'unknown';\n  // ===== –ö–û–ù–ï–¶ –ù–û–í–û–ô –í–ê–õ–ò–î–ê–¶–ò–ò =====\n  \n} catch (error) {\n  console.error('‚ùå Failed to parse validation response:', error.message);\n  console.log('Raw output (first 300 chars):', validationOutput.substring(0, 300));\n  \n  validation = {\n    approved: false,\n    reason: 'Failed to parse validation response: ' + error.message,\n    refined_content: originalUpdate.content || '',\n    suggestion: 'Check AI validator output format. Manual review required.',\n    context_change_validated: 'parsing_error',\n    history_check_result: 'parsing_error',\n    change_significance: 'parsing_error',\n    conflicts_with: []\n  };\n}\n// –î–û–ë–ê–í–õ–ï–ù–û: –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–í–ï–†–ö–ê –¥–ª—è delete: –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –Ω—É–∂–µ–Ω editId\nif (originalUpdate.action === 'delete' && !originalUpdate.editId) {\n  console.error('CRITICAL ERROR: delete action without editId!');\n  return [{\n    json: {\n      table: originalUpdate.table,\n      action: originalUpdate.action,\n      content: '',\n      editId: null,\n      validated: false,\n      rejection_reason: 'Delete action requires editId',\n      suggestion: 'Provide editId for the rule to delete'\n    }\n  }];\n}\n\n// –í–ê–ñ–ù–û: –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Å—Ö–æ–¥–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è –≤—Ç–æ—Ä–æ–≥–æ workflow\nif (validation.approved) {\n  // –î–û–ë–ê–í–õ–ï–ù–û: –õ–æ–≥–∏—Ä—É–µ–º —É—Å–ø–µ—à–Ω—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é\n  console.log(`‚úì Approved: ${originalUpdate.action} on ${originalUpdate.table}${originalUpdate.editId ? ` (ID: ${originalUpdate.editId})` : ''}`);\n  \n  // –ï—Å–ª–∏ –æ–¥–æ–±—Ä–µ–Ω–æ, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ –ø–æ–ª—è –¥–ª—è Apply Update to Vector Base\n  return [{\n    json: {\n      // –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –¥–ª—è –≤—Ç–æ—Ä–æ–≥–æ workflow\n      table: originalUpdate.table,\n      action: originalUpdate.action,\n      content: validation.refined_content || originalUpdate.content || '', // –ò–ó–ú–ï–ù–ï–ù–û: –î–ª—è delete –±—É–¥–µ—Ç –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞\n      editId: originalUpdate.editId || null,\n      \n      // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ\n      priority: originalUpdate.priority || 80,\n      metadata: {\n        ...(originalUpdate.metadata || {}),\n        // –î–û–ë–ê–í–õ–ï–ù–û: –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤ metadata\n        validation_info: {\n          context_change_level: originalUpdate.metadata?.context_change_level || 'not_specified',\n          context_change_validated: validation.context_change_validated || 'not_checked',\n          history_check_result: validation.history_check_result || 'not_checked',\n          problem_addressed: validation.problem_addressed || 'Not specified'\n        }\n      },\n      \n      // –§–ª–∞–≥–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏\n      validated: true,\n      validation_timestamp: new Date().toISOString(),\n      \n      // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞—Ö –µ—Å–ª–∏ –µ—Å—Ç—å (–¥–ª—è delete –æ–±—ã—á–Ω–æ –ø—É—Å—Ç–æ)\n      conflicts_with: validation.conflicts_with || []\n    }\n  }];\n} else {\n  // –î–û–ë–ê–í–õ–ï–ù–û: –õ–æ–≥–∏—Ä—É–µ–º –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ\n  console.log(`‚úó Rejected: ${originalUpdate.action} on ${originalUpdate.table} - ${validation.reason?.substring(0, 100) || 'Unknown reason'}`);\n  \n  // –ï—Å–ª–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ, –≤—Å–µ —Ä–∞–≤–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É\n  return [{\n    json: {\n      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ\n      table: originalUpdate.table,\n      action: originalUpdate.action,\n      content: originalUpdate.content || '', // –ò–ó–ú–ï–ù–ï–ù–û: –ó–∞—â–∏—Ç–∞ –æ—Ç undefined\n      editId: originalUpdate.editId || null,\n      priority: originalUpdate.priority || 80,\n      metadata: {\n        ...(originalUpdate.metadata || {}),\n        // –î–û–ë–ê–í–õ–ï–ù–û: –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤ metadata\n        validation_info: {\n          context_change_level: originalUpdate.metadata?.context_change_level || 'not_specified',\n          context_change_validated: validation.context_change_validated || 'not_checked',\n          history_check_result: validation.history_check_result || 'not_checked'\n        }\n      },\n      \n      // –§–ª–∞–≥–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è\n      validated: false,\n      rejection_reason: validation.reason || 'Unknown reason',\n      suggestion: validation.suggestion || 'Review the update manually',\n      conflicts_with: validation.conflicts_with || [],\n      change_significance: validation.change_significance || 'unknown' // –î–û–ë–ê–í–õ–ï–ù–û\n    }\n  }];\n}"
      },
      "id": "83dbe96a-7ae4-45ca-a16f-796fccbdb44a",
      "name": "Process Validation Result",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1056,
        112
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "leftValue": "={{ $json.validated }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              },
              "id": "772e0c5a-f92d-4543-b1cc-1ad8e02982e4"
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "7ad68db2-5e6e-44e5-afde-b43f52b957de",
      "name": "Is Validated?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        1248,
        112
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://localhost:5678/webhook/write-vector-base",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "table",
              "value": "={{ $json.table }}"
            },
            {
              "name": "mode",
              "value": "={{ $json.action }}"
            },
            {
              "name": "content",
              "value": "={{ $json.content }}"
            },
            {
              "name": "editId",
              "value": "={{ $json.editId }}"
            },
            {
              "name": "apiKey",
              "value": "24fs-$r4d-defd-77ds-7eds"
            }
          ]
        },
        "options": {}
      },
      "id": "64c9a5dc-29aa-47cc-a0e9-8f2c7138cddb",
      "name": "Apply Update to Vector Base",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1472,
        80
      ],
      "retryOnFail": true,
      "waitBetweenTries": 2000,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "INSERT INTO ai_learning_log (\n  type, \n  action, \n  table_name, \n  content, \n  status, \n  metadata,\n  session_id,\n  reason,\n  problem_addressed\n) VALUES (\n  'rejected_update',\n  '{{ $json.action }}',\n  '{{ $json.table }}',\n  '{{ $json.content }}',\n  'rejected',\n  jsonb_build_object(\n    'reason', '{{ $json.rejection_reason }}',\n    'suggestion', '{{ $json.suggestion }}'\n  ),\n  '{{ $('Prepare Update Context').first().json.update.session_id }}',\n  '{{ $json.reason }}',\n  '{{ $json.problem_addressed }}'\n);",
        "options": {}
      },
      "id": "e703e3c3-56f3-4048-9b5f-301f268371da",
      "name": "Log Rejected Update",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        1680,
        400
      ],
      "credentials": {
        "postgres": {
          "id": "dPjh4Kdb4nIbCTQG",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        512,
        304
      ],
      "id": "4d180c37-8dac-4180-a020-7d1ca2f21d94",
      "name": "Google Gemini Chat Model1",
      "credentials": {
        "googlePalmApi": {
          "id": "abo0BDHSJPM0pgRU",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –£–∑–µ–ª: Prepare Update Context - –ë–ï–ó existing_rules (–¥–∞–Ω–Ω—ã–µ –ø—Ä–∏—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ tools)\nconst allInputs = $input.all();\n\n// –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–∞–∫–æ–π input –æ—Ç –∫–∞–∫–æ–≥–æ —É–∑–ª–∞\nlet currentUpdate = null;\nlet dbData = null;\n\n// –ò—â–µ–º –¥–∞–Ω–Ω—ã–µ –æ—Ç Loop Over Updates –∏ Load Analysis from DB\nallInputs.forEach(input => {\n  const data = input.json;\n  \n  // –ï—Å–ª–∏ –µ—Å—Ç—å –ø–æ–ª—è table/action - —ç—Ç–æ –æ—Ç Loop Over Updates\n  if (data.table && data.action) {\n    currentUpdate = data;\n  }\n  // –ï—Å–ª–∏ –µ—Å—Ç—å aggregated_data - —ç—Ç–æ –æ—Ç Load Analysis from DB\n  else if (data.aggregated_data) {\n    dbData = data;\n  }\n});\n\n// –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ—Ç trigger (–∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π)\nconst triggerData = $('When called by Main Workflow').first().json;\n\n// –ü–æ–ª—É—á–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏–∑ trigger\nconst fullChangesHistory = triggerData.all_prompts_data?.changes_history || [];\n\n// –ü–∞—Ä—Å–∏–º aggregated_analysis –∏–∑ –ë–î\nlet aggregatedAnalysis = {};\ntry {\n  if (dbData && dbData.aggregated_data) {\n    aggregatedAnalysis = typeof dbData.aggregated_data === 'string' \n      ? JSON.parse(dbData.aggregated_data) \n      : dbData.aggregated_data;\n  }\n} catch (error) {\n  console.error('Error parsing aggregated_analysis:', error);\n  aggregatedAnalysis = {};\n}\n\n// –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö\nif (!currentUpdate || !currentUpdate.table) {\n  return [{\n    json: {\n      error: \"No update data provided\",\n      update: currentUpdate\n    }\n  }];\n}\n\nconst targetTable = currentUpdate.table;\n\n// –î–ª—è —Ä–µ–∂–∏–º–∞ edit/delete –Ω–∞—Ö–æ–¥–∏–º ID —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞\nlet editingRuleId = null;\nlet ruleBeingEdited = null;\n\nif ((currentUpdate.action === 'edit' || currentUpdate.action === 'delete') && currentUpdate.editId) {\n  editingRuleId = currentUpdate.editId;\n  // ruleBeingEdited –±—É–¥–µ—Ç –Ω–∞–π–¥–µ–Ω–æ —á–µ—Ä–µ–∑ tool –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏\n  ruleBeingEdited = {\n    id: editingRuleId,\n    note: \"–î–µ—Ç–∞–ª–∏ –ø—Ä–∞–≤–∏–ª–∞ –±—É–¥—É—Ç –ø–æ–ª—É—á–µ–Ω—ã —á–µ—Ä–µ–∑ tool match_\" + targetTable\n  };\n}\n\n// –§–∏–ª—å—Ç—Ä—É–µ–º –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –≠–¢–û–ì–û –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞\nconst ruleHistory = fullChangesHistory.filter(change => {\n  // –ï—Å–ª–∏ —ç—Ç–æ edit/delete - –∏—â–µ–º –ø–æ editId\n  if ((currentUpdate.action === 'edit' || currentUpdate.action === 'delete') && currentUpdate.editId) {\n    return change.table_name === targetTable && \n           (change.metadata?.edit_id === currentUpdate.editId ||\n            change.metadata?.edit_id === String(currentUpdate.editId));\n  }\n  \n  // –ï—Å–ª–∏ —ç—Ç–æ append - –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ—Ö–æ–∂–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç (–ø–µ—Ä–≤—ã–µ 100 —Å–∏–º–≤–æ–ª–æ–≤)\n  if (currentUpdate.action === 'append') {\n    const currentContentStart = currentUpdate.content.substring(0, 100).toLowerCase();\n    const historyContentStart = (change.content || '').substring(0, 100).toLowerCase();\n    return change.table_name === targetTable && \n           historyContentStart === currentContentStart;\n  }\n  \n  return false;\n});\n\n// –§–æ—Ä–º–∏—Ä—É–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–∞ (–ë–ï–ó existing_rules - –æ–Ω–∏ –≤ tools)\nconst validationContext = {\n  update: currentUpdate,\n  \n  // –£–î–ê–õ–ï–ù–û: existing_rules - –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –ø–æ–ª—É—á–µ–Ω—ã —á–µ—Ä–µ–∑ tools\n  \n  original_rule: ruleBeingEdited,\n  \n  // –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≠–¢–û–ì–û –ø—Ä–∞–≤–∏–ª–∞\n  rule_changes_history: ruleHistory,\n  \n  aggregated_analysis: {\n    total_dialogs: aggregatedAnalysis?.total_dialogs || 0,\n    avg_satisfaction: aggregatedAnalysis?.avg_satisfaction || 0,\n    emotional_patterns: aggregatedAnalysis?.emotional_patterns || {},\n    all_recommendations: aggregatedAnalysis?.all_recommendations || [],\n    all_missed_opportunities: aggregatedAnalysis?.all_missed_opportunities || [],\n    all_customer_needs: aggregatedAnalysis?.all_customer_needs || [],\n    common_issues: aggregatedAnalysis?.common_issues || [],\n    common_missed: aggregatedAnalysis?.common_missed || [],\n    common_customer_needs: aggregatedAnalysis?.common_customer_needs || [],\n    critical_problems: aggregatedAnalysis?.critical_problems || []\n  },\n  \n  table_stats: {\n    table_name: targetTable,\n    is_editing: currentUpdate.action === 'edit',\n    is_adding: currentUpdate.action === 'append',\n    is_deleting: currentUpdate.action === 'delete',\n    history_records_found: ruleHistory.length,\n    \n    // –£–î–ê–õ–ï–ù–û: total_rules - –±—É–¥–µ—Ç –ø–æ–ª—É—á–µ–Ω–æ —á–µ—Ä–µ–∑ tool –µ—Å–ª–∏ –Ω—É–∂–Ω–æ\n    \n    note: \"–î–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ tool: match_\" + targetTable\n  },\n  \n  context_summary: `\n    –¢–∞–±–ª–∏—Ü–∞: ${targetTable}\n    –î–µ–π—Å—Ç–≤–∏–µ: ${currentUpdate.action}\n    \n    Tool –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤–∏–ª: match_${targetTable}\n    \n    –°—Ä–µ–¥–Ω—è—è —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å: ${aggregatedAnalysis?.avg_satisfaction || 0}%\n    –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –¥–∏–∞–ª–æ–≥–æ–≤: ${aggregatedAnalysis?.total_dialogs || 0}\n    –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º: ${aggregatedAnalysis?.critical_problems?.length || 0}\n    –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —ç—Ç–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞: ${ruleHistory.length} –∑–∞–ø–∏—Å–µ–π\n    ${ruleBeingEdited ? `–†–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª–æ ID ${currentUpdate.editId}` : ''}\n    ${currentUpdate.metadata?.context_change_level ? `–°—Ç–µ–ø–µ–Ω—å –∏–∑–º–µ–Ω–µ–Ω–∏—è: ${currentUpdate.metadata.context_change_level}` : ''}\n  `\n};\n\nconsole.log(`Preparing validation for ${targetTable}:`, {\n  action: currentUpdate.action,\n  tool_available: `match_${targetTable}`,\n  has_original_id: !!editingRuleId,\n  avg_satisfaction: aggregatedAnalysis?.avg_satisfaction,\n  total_dialogs: aggregatedAnalysis?.total_dialogs,\n  history_records: ruleHistory.length,\n  context_change_level: currentUpdate.metadata?.context_change_level || 'not_specified'\n});\n\nreturn [{\n  json: validationContext\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        560,
        80
      ],
      "id": "15b0a33d-5df5-44c2-be66-3ea49b1d62e0",
      "name": "Prepare Update Context"
    },
    {
      "parameters": {
        "jsCode": "// –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∑–∞–ø–∏—Å–∏ –≤ –ª–æ–≥ –æ—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π\nconst data = $json;\n\n// –§—É–Ω–∫—Ü–∏—è —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è PostgreSQL\nfunction escapePostgres(str) {\n  if (typeof str !== 'string') return str;\n  return str.replace(/'/g, \"''\");\n}\n\n// –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ metadata\nconst metadata = data.metadata || {};\nconst validationInfo = metadata.validation_info || {};\n\nreturn [{\n  json: {\n    action: data.action,\n    table: data.table,\n    content: escapePostgres(data.content),\n    rejection_reason: escapePostgres(data.rejection_reason || ''),\n    suggestion: escapePostgres(data.suggestion || ''),\n    \n    // –ù–û–í–´–ï –ü–û–õ–Ø\n    reason: escapePostgres(data.rejection_reason || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'),\n    problem_addressed: escapePostgres(validationInfo.problem_addressed || data.change_significance || '–ù–µ —É–∫–∞–∑–∞–Ω–æ')\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1488,
        384
      ],
      "id": "34f7820d-3e60-41fa-b893-ccac2ae77488",
      "name": "Prepare Rejected Log"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.embeddingsGoogleGemini",
      "typeVersion": 1,
      "position": [
        864,
        304
      ],
      "id": "a360165d-45a2-46a4-ae99-067e4a861e14",
      "name": "Embeddings Google Gemini",
      "credentials": {
        "googlePalmApi": {
          "id": "abo0BDHSJPM0pgRU",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "INSERT INTO ai_learning_log (\n  type, \n  action,\n  table_name,\n  content,\n  status,\n  metadata,\n  session_id,\n  reason,\n  problem_addressed,\n  created_at\n) VALUES (\n  'approved_update',\n  '{{ $json.action }}',\n  '{{ $json.table }}',\n  CASE \n    WHEN '{{ $json.action }}' = 'delete' THEN '[–ü—Ä–∞–≤–∏–ª–æ ID {{ $json.editId }} —É–¥–∞–ª–µ–Ω–æ]'\n    ELSE '{{ $json.content }}'\n  END,\n  'applied',\n  jsonb_build_object(\n    'priority', {{ $json.priority }},\n    'edit_id', '{{ $json.editId }}',\n    'validation_timestamp', '{{ $json.validation_timestamp }}'\n  ),\n  '{{ $('Prepare Update Context').first().json.update.session_id }}',\n  '{{ $json.reason }}',\n  '{{ $json.problem_addressed }}',\n  NOW()\n);",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        1888,
        80
      ],
      "id": "7f8be436-add1-4391-8c10-62baf77878ff",
      "name": "Log Successful Update",
      "credentials": {
        "postgres": {
          "id": "dPjh4Kdb4nIbCTQG",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Initialize Learning Session - –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —É—Å–ø–µ—à–Ω—ã—Ö\nconst validationResult = $('Process Validation Result').item.json;\n\n// –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è PostgreSQL\nfunction escapePostgres(str) {\n  if (!str || str === 'undefined') return '';\n  if (typeof str !== 'string') return String(str);\n  return str.replace(/'/g, \"''\");\n}\n\n// –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ metadata\nconst metadata = validationResult.metadata || {};\nconst validationInfo = metadata.validation_info || {};\n\nreturn [{\n  json: {\n    action: validationResult.action || 'unknown',\n    table: validationResult.table || 'unknown', \n    content: escapePostgres(validationResult.content || ''),\n    editId: validationResult.editId || null,\n    priority: validationResult.priority || 80,\n    validation_timestamp: validationResult.validation_timestamp || new Date().toISOString(),\n    conflicts_with: JSON.stringify(validationResult.conflicts_with || []),\n    \n    // –ù–û–í–´–ï –ü–û–õ–Ø –∏–∑ validation_info\n    reason: escapePostgres(metadata.reason || validationInfo.problem_addressed || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'),\n    problem_addressed: escapePostgres(validationInfo.problem_addressed || '–ù–µ —É–∫–∞–∑–∞–Ω–æ')\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1680,
        80
      ],
      "id": "9cfa0396-90f9-47f2-805c-f82fa3c366dc",
      "name": "Initialize Learning Session"
    },
    {
      "parameters": {},
      "id": "b3452a17-b77f-4d74-b14a-ea179ba5a8d4",
      "name": "When called by Main Workflow",
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1,
      "position": [
        -144,
        32
      ]
    },
    {
      "parameters": {
        "jsCode": "// –°—Ö–ª–æ–ø—ã–≤–∞–µ–º –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã loop –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É\nconst allItems = $input.all();\nconst approved = allItems.filter(item => item.json.validated === true).length;\nconst rejected = allItems.filter(item => item.json.validated === false).length;\n\nconst triggerData = $('When called by Main Workflow').first().json;\n\nconsole.log(`Loop completed: ${approved} approved, ${rejected} rejected`);\n\nreturn [{\n  json: {\n    status: 'completed',\n    total_processed: allItems.length,\n    approved: approved,\n    rejected: rejected,\n    session_id: triggerData.session_id,\n    timestamp: new Date().toISOString()\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        192,
        -112
      ],
      "id": "3b06e153-77b8-4e26-9c1c-bdf9016888ae",
      "name": "Aggregate Results"
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "Product knowledge base - prices, features, algorithms, purchase process. Critical information about Cryptomator. Always check before answering.",
        "tableName": {
          "__rl": true,
          "value": "knowledge_base",
          "mode": "id"
        },
        "topK": 20,
        "options": {
          "queryName": "match_knowledge_base"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        608,
        304
      ],
      "id": "bd2eee0e-309d-4135-818b-79c303ae3910",
      "name": "Knowledge base",
      "credentials": {
        "supabaseApi": {
          "id": "7ldcSWe5TTPVh3zH",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "Interaction policies - company rules for customer contact. Check before promising callbacks, manager contact, or demos. Contains communication restrictions.",
        "tableName": {
          "__rl": true,
          "value": "interaction_policies",
          "mode": "id"
        },
        "topK": 20,
        "options": {
          "queryName": "match_interaction_policies"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        976,
        304
      ],
      "id": "f2e1c98e-ef0d-489a-94f9-9ca6d84aea83",
      "name": "Interaction policies",
      "credentials": {
        "supabaseApi": {
          "id": "7ldcSWe5TTPVh3zH",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT aggregated_data FROM ai_analysis_temp \nORDER BY created_at DESC \nLIMIT 1;",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        208,
        160
      ],
      "id": "886a04ae-9538-4a06-8bef-64bfef97a33f",
      "name": "Load Analysis from DB",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "dPjh4Kdb4nIbCTQG",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "DELETE FROM ai_analysis_temp;",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        432,
        -160
      ],
      "id": "0e6e978e-ff27-48dc-a35a-b7c705873984",
      "name": "Cleanup Temp Data",
      "credentials": {
        "postgres": {
          "id": "dPjh4Kdb4nIbCTQG",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        384,
        80
      ],
      "id": "4b484876-4b03-4672-9b17-3fab61c83950",
      "name": "Merge"
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "Sales techniques, objection handling, closing strategies, urgency tactics, storytelling methods. Includes responses to price objections and trust concerns.",
        "tableName": {
          "__rl": true,
          "value": "sales_strategies",
          "mode": "id"
        },
        "topK": 20,
        "options": {
          "queryName": "match_sales_strategies"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        1168,
        448
      ],
      "id": "a434ea33-4574-4e77-82cc-ca080f0d476e",
      "name": "Sales strategies",
      "credentials": {
        "supabaseApi": {
          "id": "7ldcSWe5TTPVh3zH",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "Contact acquisition strategies, email capture scripts, phone collection methods, soft decline handling. Multi-stage approach: name -> email -> messenger/phone. REQUIRED for lead generation.",
        "tableName": {
          "__rl": true,
          "value": "contact_capture",
          "mode": "id"
        },
        "topK": 20,
        "options": {
          "queryName": "match_contact_capture"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        352,
        448
      ],
      "id": "b688f239-88fd-4f80-87e0-327c1214b601",
      "name": "Contact capture",
      "credentials": {
        "supabaseApi": {
          "id": "7ldcSWe5TTPVh3zH",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "Dialogue structures, greeting templates, qualification questions, pain discovery, presentation flows. Scenarios for novice/experienced/professional clients. ESSENTIAL for conversation flow.",
        "tableName": {
          "__rl": true,
          "value": "conversation_scenarios",
          "mode": "id"
        },
        "topK": 20,
        "options": {
          "queryName": "match_conversation_scenarios"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        624,
        448
      ],
      "id": "1d45c403-e640-42d3-b7c5-604291e7eefe",
      "name": "Conversation scenarios",
      "credentials": {
        "supabaseApi": {
          "id": "7ldcSWe5TTPVh3zH",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "Adaptation rules, emoji usage, humor guidelines, platform-specific commands (voice/text), naming conventions. Contains formatting rules and 600 char limit. CRITICAL for proper communication style.",
        "tableName": {
          "__rl": true,
          "value": "communication_style",
          "mode": "id"
        },
        "topK": 20,
        "options": {
          "queryName": "match_communication_style"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        896,
        448
      ],
      "id": "37322caa-5050-42cc-9f98-ff8d1f7e89ab",
      "name": "Communication style",
      "credentials": {
        "supabaseApi": {
          "id": "7ldcSWe5TTPVh3zH",
          "name": "Supabase account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Loop Over Updates": {
      "main": [
        [
          {
            "node": "Aggregate Results",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Load Analysis from DB",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Validate Each Update": {
      "main": [
        [
          {
            "node": "Process Validation Result",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Process Validation Result": {
      "main": [
        [
          {
            "node": "Is Validated?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Is Validated?": {
      "main": [
        [
          {
            "node": "Apply Update to Vector Base",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Prepare Rejected Log",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Apply Update to Vector Base": {
      "main": [
        [
          {
            "node": "Initialize Learning Session",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Log Rejected Update": {
      "main": [
        [
          {
            "node": "Loop Over Updates",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "Validate Each Update",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Update Context": {
      "main": [
        [
          {
            "node": "Validate Each Update",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Rejected Log": {
      "main": [
        [
          {
            "node": "Log Rejected Update",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings Google Gemini": {
      "ai_embedding": [
        [
          {
            "node": "Knowledge base",
            "type": "ai_embedding",
            "index": 0
          },
          {
            "node": "Interaction policies",
            "type": "ai_embedding",
            "index": 0
          },
          {
            "node": "Contact capture",
            "type": "ai_embedding",
            "index": 0
          },
          {
            "node": "Conversation scenarios",
            "type": "ai_embedding",
            "index": 0
          },
          {
            "node": "Communication style",
            "type": "ai_embedding",
            "index": 0
          },
          {
            "node": "Sales strategies",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Log Successful Update": {
      "main": [
        [
          {
            "node": "Loop Over Updates",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Initialize Learning Session": {
      "main": [
        [
          {
            "node": "Log Successful Update",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When called by Main Workflow": {
      "main": [
        [
          {
            "node": "Loop Over Updates",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Knowledge base": {
      "ai_tool": [
        [
          {
            "node": "Validate Each Update",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Interaction policies": {
      "ai_tool": [
        [
          {
            "node": "Validate Each Update",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Load Analysis from DB": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Aggregate Results": {
      "main": [
        [
          {
            "node": "Cleanup Temp Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Prepare Update Context",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Contact capture": {
      "ai_tool": [
        [
          {
            "node": "Validate Each Update",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Conversation scenarios": {
      "ai_tool": [
        [
          {
            "node": "Validate Each Update",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Communication style": {
      "ai_tool": [
        [
          {
            "node": "Validate Each Update",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Sales strategies": {
      "ai_tool": [
        [
          {
            "node": "Validate Each Update",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "b4b5b3d1-cea4-46ef-91d2-e4ebe0a97385",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "9a2a948e1b1119e76dce477f4f08641c41898f344f4216cb90098437b1dcaf00"
  },
  "id": "OdXsDOgimVGW8aQf",
  "tags": []
}