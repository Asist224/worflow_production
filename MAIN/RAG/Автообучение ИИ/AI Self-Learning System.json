{
  "name": "AI Self-Learning",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "minutes"
            }
          ]
        }
      },
      "id": "5f6b0e86-d37f-48e8-9d0d-2abd511def3e",
      "name": "Schedule Every 4 Hours",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        -8768,
        -384
      ]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT \n  da.id,\n  da.session_id,\n  da.user_name,\n  da.emotional_tone,\n  da.customer_needs,\n  da.recommendations,\n  da.missed_opportunities,\n  da.satisfaction_percentage,\n  da.lead_scoring,\n  da.created_at\nFROM dialog_analysis da\nWHERE da.created_at > COALESCE(\n    (SELECT last_analysis_check\n     FROM system_config \n     WHERE key = 'ai_learning_last_check'),\n    NOW() - INTERVAL '7 days'\n  )\n  AND da.recommendations IS NOT NULL\n  AND da.recommendations::text != '[]'\n  AND da.recommendations::text != ''\n  AND da.id > COALESCE(\n  (SELECT metadata->>'max_id_processed' \n   FROM ai_learning_log \n   WHERE type = 'batch_completed' \n     AND session_id = (\n       SELECT session_id \n       FROM ai_learning_log \n       WHERE type = 'cycle_started' AND status = 'running' \n       ORDER BY created_at DESC \n       LIMIT 1\n     )\n   ORDER BY created_at DESC \n   LIMIT 1\n  )::integer, \n  0\n)\nORDER BY da.id ASC\nLIMIT 2;",
        "options": {}
      },
      "id": "7450180a-a973-45f7-8620-fb4cfa963018",
      "name": "Get New Analysis Since Last Check",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        -8336,
        -384
      ],
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "dPjh4Kdb4nIbCTQG",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 1
          },
          "conditions": [
            {
              "leftValue": "={{ $input.all().length > 0 && $input.first().json.id !== undefined }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gt"
              },
              "id": "21d97ad2-fd36-4718-b242-6cce54198bac"
            }
          ],
          "combinator": "and"
        },
        "options": {
          "looseTypeValidation": true
        }
      },
      "id": "df78bcd9-5afb-4598-9df6-9efd9ef8e9de",
      "name": "Has New Records?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -7952,
        -320
      ]
    },
    {
      "parameters": {
        "jsCode": "// –ê–≥—Ä–µ–≥–∏—Ä—É–µ–º –≤—Å–µ –∞–Ω–∞–ª–∏–∑—ã –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤\nconst allAnalysis = $input.all();\n\n// –ü–æ–ª—É—á–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏ –ù–ê–ü–†–Ø–ú–£–Æ –∏–∑ —É–∑–ª–∞ Cycle Start ID\nconst cycleStartData = $('Cycle Start ID').all();\nconst sessionMetadata = cycleStartData.find(item => item.json._is_metadata)?.json || {\n  session_id: 'no_session_' + Date.now(),\n  dialogs_count: allAnalysis.length,\n  start_time: new Date().toISOString(),\n  workflow_execution_id: 'unknown'\n};\n\n// –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–æ–ª—É—á–∏–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π session_id\nconsole.log('Session metadata from Cycle Start ID:', sessionMetadata);\n\n// –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è —Å–±–æ—Ä–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö\nconst aggregated = {\n  total_dialogs: allAnalysis.length,\n  avg_satisfaction: 0,\n  emotional_patterns: {},\n  all_recommendations: [],\n  all_missed_opportunities: [],\n  all_customer_needs: [],  // –î–û–ë–ê–í–õ–ï–ù–û: –º–∞—Å—Å–∏–≤ –¥–ª—è customer_needs\n  common_issues: {},\n  common_customer_needs: {}, // –î–û–ë–ê–í–õ–ï–ù–û: —á–∞—Å—Ç—ã–µ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤\n  critical_problems: [],\n  session_id: sessionMetadata.session_id,\n  session_start: sessionMetadata.start_time,\n  workflow_execution_id: sessionMetadata.workflow_execution_id\n};\n\n// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—á–µ—Ç—á–∏–∫–∏\nlet totalSatisfaction = 0;\nconst recommendationCounts = {};\nconst missedOpportunitiesCounts = {};\nconst customerNeedsCounts = {}; // –î–û–ë–ê–í–õ–ï–ù–û: —Å—á–µ—Ç—á–∏–∫ –¥–ª—è customer_needs\n\n// –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∂–¥—ã–π –∞–Ω–∞–ª–∏–∑\nfor (const item of allAnalysis) {\n  const data = item.json;\n  \n  // –°—É–º–º–∏—Ä—É–µ–º —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å\n  const satisfaction = parseInt(data.satisfaction_percentage) || 50;\n  totalSatisfaction += satisfaction;\n  \n  // –ü–∞—Ä—Å–∏–º emotional_tone\n  try {\n    const emotional = typeof data.emotional_tone === 'string' \n      ? JSON.parse(data.emotional_tone) \n      : data.emotional_tone;\n    \n    if (emotional) {\n      const overall = emotional.overall || 'neutral';\n      aggregated.emotional_patterns[overall] = (aggregated.emotional_patterns[overall] || 0) + 1;\n      \n      if (emotional.satisfaction < 40) {\n        aggregated.critical_problems.push({\n          session: data.session_id,\n          satisfaction: emotional.satisfaction,\n          description: emotional.description\n        });\n      }\n    }\n  } catch (e) {\n  console.error('‚ùå Error parsing ...:', e.message);\n  console.log('Data that failed:', JSON.stringify(data).substring(0, 200));\n  // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É, –ø—Ä–æ–ø—É—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç\n}\n  \n  // –ü–∞—Ä—Å–∏–º recommendations\n  try {\n    const recommendations = typeof data.recommendations === 'string'\n      ? JSON.parse(data.recommendations)\n      : data.recommendations;\n    \n    if (Array.isArray(recommendations)) {\n      recommendations.forEach(rec => {\n        aggregated.all_recommendations.push(rec);\n        const key = rec.toLowerCase().trim();\n        recommendationCounts[key] = (recommendationCounts[key] || 0) + 1;\n      });\n    }\n  } catch (e) {\n  console.error('‚ùå Error parsing ...:', e.message);\n  console.log('Data that failed:', JSON.stringify(data).substring(0, 200));\n  // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É, –ø—Ä–æ–ø—É—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç\n}\n  \n  // –ü–∞—Ä—Å–∏–º missed_opportunities\n  try {\n    const missed = typeof data.missed_opportunities === 'string'\n      ? JSON.parse(data.missed_opportunities)\n      : data.missed_opportunities;\n    \n    if (Array.isArray(missed)) {\n      missed.forEach(opp => {\n        aggregated.all_missed_opportunities.push(opp);\n        const key = opp.toLowerCase().trim();\n        missedOpportunitiesCounts[key] = (missedOpportunitiesCounts[key] || 0) + 1;\n      });\n    }\n  } catch (e) {\n  console.error('‚ùå Error parsing ...:', e.message);\n  console.log('Data that failed:', JSON.stringify(data).substring(0, 200));\n  // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É, –ø—Ä–æ–ø—É—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç\n}\n  \n  // –î–û–ë–ê–í–õ–ï–ù–û: –ü–∞—Ä—Å–∏–º customer_needs\n  try {\n    const needs = typeof data.customer_needs === 'string'\n      ? JSON.parse(data.customer_needs)\n      : data.customer_needs;\n    \n    if (Array.isArray(needs)) {\n      needs.forEach(need => {\n        aggregated.all_customer_needs.push(need);\n        const key = need.toLowerCase().trim();\n        customerNeedsCounts[key] = (customerNeedsCounts[key] || 0) + 1;\n      });\n    }\n  } catch (e) {\n    console.log('Error parsing customer_needs:', e);\n  }\n}\n\n// –í—ã—á–∏—Å–ª—è–µ–º —Å—Ä–µ–¥–Ω—é—é —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å\naggregated.avg_satisfaction = allAnalysis.length > 0 \n  ? Math.round(totalSatisfaction / allAnalysis.length)\n  : 50;\n\n// –ù–∞—Ö–æ–¥–∏–º —Å–∞–º—ã–µ —á–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (–≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è 2+ —Ä–∞–∑–∞)\naggregated.common_issues = Object.entries(recommendationCounts)\n  .filter(([_, count]) => count >= 2)\n  .sort((a, b) => b[1] - a[1])\n  .slice(0, 15)\n  .map(([issue, count]) => ({ \n    issue, \n    count,\n    frequency_percent: Math.round((count / allAnalysis.length) * 100)\n  }));\n\n// –ù–∞—Ö–æ–¥–∏–º —á–∞—Å—Ç—ã–µ —É–ø—É—â–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏\naggregated.common_missed = Object.entries(missedOpportunitiesCounts)\n  .filter(([_, count]) => count >= 2)\n  .sort((a, b) => b[1] - a[1])\n  .slice(0, 10)\n  .map(([opportunity, count]) => ({ \n    opportunity, \n    count,\n    frequency_percent: Math.round((count / allAnalysis.length) * 100)\n  }));\n\n// –î–û–ë–ê–í–õ–ï–ù–û: –ù–∞—Ö–æ–¥–∏–º —á–∞—Å—Ç—ã–µ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤\naggregated.common_customer_needs = Object.entries(customerNeedsCounts)\n  .filter(([_, count]) => count >= 2)\n  .sort((a, b) => b[1] - a[1])\n  .slice(0, 10)\n  .map(([need, count]) => ({ \n    need, \n    count,\n    frequency_percent: Math.round((count / allAnalysis.length) * 100)\n  }));\n\n// –õ–æ–≥–∏—Ä—É–µ–º –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏\nconsole.log(`Aggregated ${allAnalysis.length} dialogs for session ${aggregated.session_id}`);\nconsole.log(`Found ${aggregated.all_customer_needs.length} customer needs`);\n\n// –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å session_id –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–ª—å—à–µ –ø–æ —Ü–µ–ø–æ—á–∫–µ\nreturn [{\n  json: aggregated\n}];"
      },
      "id": "0dcdd9fd-71f8-4984-9b75-3e8b561a3c47",
      "name": "Aggregate All Analysis",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -7552,
        -432
      ]
    },
    {
      "parameters": {
        "jsCode": "// –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ –ø—Ä–æ–º–ø—Ç—ã –∏–∑ –≤—Å–µ—Ö –±–∞–∑ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ\nconst tables = [\n  'sales_strategies', \n  'contact_capture',\n  'conversation_scenarios',\n  'communication_style'\n];\n\n// –ü—É—Å—Ç–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –ø—Ä–æ–º–ø—Ç–æ–≤ (–±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ –ø–æ–∑–∂–µ)\nconst allPrompts = {};\n\n// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã\nfor (const table of tables) {\n  allPrompts[table] = {\n    table_name: table,\n    records: [],\n    total: 0\n  };\n}\n\n// –ü–æ–ª—É—á–∞–µ–º –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∞–Ω–∞–ª–∏–∑–∞\nconst aggregatedAnalysis = $('Aggregate All Analysis').item.json;\n\n// –ò–∑–≤–ª–µ–∫–∞–µ–º session_id –∏–∑ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö\nconst sessionId = aggregatedAnalysis.session_id || 'no_session_' + Date.now();\n\n// –ü–µ—Ä–µ–¥–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–∞–ª—å—à–µ\nreturn [{\n  json: {\n    aggregated_analysis: aggregatedAnalysis, // —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç session_id –≤–Ω—É—Ç—Ä–∏\n    tables_to_load: tables.join(','), // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –º–∞—Å—Å–∏–≤ –≤ —Å—Ç—Ä–æ–∫—É –¥–ª—è webhook\n    tables_array: tables, // –°–æ—Ö—Ä–∞–Ω—è–µ–º –º–∞—Å—Å–∏–≤ –¥–ª—è –±—É–¥—É—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è\n    current_prompts: allPrompts, // –ü—É—Å—Ç–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ –ø–æ—Å–ª–µ Load Current Prompts\n    session_id: sessionId // –Ø–≤–Ω–æ –ø–µ—Ä–µ–¥–∞–µ–º session_id –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –≤ –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö —É–∑–ª–∞—Ö\n  }\n}];"
      },
      "id": "60470151-b835-405e-aec0-22ea718d7929",
      "name": "Prepare Data for Loading",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -7344,
        -416
      ]
    },
    {
      "parameters": {
        "options": {
          "temperature": 0.2
        }
      },
      "id": "146d6358-5daa-457f-a78b-cc3068412123",
      "name": "Google Gemini Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -5232,
        -816
      ],
      "credentials": {
        "googlePalmApi": {
          "id": "abo0BDHSJPM0pgRU",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Parse AI Response - –£–õ–£–ß–®–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø —Å try-catch\nconst allInputs = $input.all();\nconst allUpdates = [];\n\n// –ü–æ–ª—É—á–∞–µ–º session_id –∏–∑ Cycle Start ID\nconst sessionId = $('Cycle Start ID').first().json.session_id;\n\n// ========== –†–ï–ì–£–õ–Ø–†–ö–ò –î–õ–Ø –û–ë–ù–ê–†–£–ñ–ï–ù–ò–Ø –†–ï–°–£–†–°–û–í ==========\nconst URL_PATTERNS = [\n  /https?:\\/\\/[^\\s]+/gi,\n  /www\\.[^\\s]+/gi,\n  /\\[[^\\]]+\\]\\([^\\)]+\\)/gi,\n  /\\b—Å—Å—ã–ª–∫[–∞–µ—É–∏]\\b/gi,\n  /\\b–≤–∏–¥–µ–æ\\b/gi,\n  /\\b–∫–µ–π—Å[–∞—ã]?\\b/gi,\n  /\\b–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏[—è–∏—é]\\b/gi,\n  /\\b–º–∞—Ç–µ—Ä–∏–∞–ª[–∞—ã—ã]?\\b/gi,\n  /\\b–¥–æ–∫—É–º–µ–Ω—Ç[–∞—ã]?\\b/gi,\n  /\\bPDF\\b/gi,\n  /\\b—Å–∫–∞—á–∞—Ç—å\\b/gi,\n  /\\b–ø–æ—Å–º–æ—Ç—Ä[–µ–∏]—Ç—å\\b/gi\n];\n\nfunction hasResourceMentions(text) {\n  if (!text || typeof text !== 'string') return false;\n  return URL_PATTERNS.some(pattern => pattern.test(text));\n}\n\nfunction extractResourceMentions(text) {\n  const found = [];\n  URL_PATTERNS.forEach(pattern => {\n    const matches = text.match(pattern);\n    if (matches) found.push(...matches);\n  });\n  return [...new Set(found)];\n}\n\n// ========== –ü–ê–†–°–ò–ù–ì –û–¢–í–ï–¢–û–í –û–¢ AI-–ê–ì–ï–ù–¢–û–í —Å –∑–∞—â–∏—Ç–æ–π ==========\nallInputs.forEach(input => {\n  try {\n    const output = input.json.output || input.json;\n    let aiResponse;\n\n    // ===== –ù–û–í–û–ï: –ó–∞—â–∏—Ç–∞ –æ—Ç –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–≥–æ JSON =====\n    try {\n      if (typeof output === 'string') {\n        const jsonMatch = output.match(/\\{[\\s\\S]*\\}/);\n        aiResponse = jsonMatch ? JSON.parse(jsonMatch[0]) : JSON.parse(output);\n      } else {\n        aiResponse = output;\n      }\n    } catch (parseError) {\n      console.error('‚ùå JSON parse failed:', parseError.message);\n      console.log('Output that failed to parse:', output.substring(0, 200));\n      \n      // –°–æ–∑–¥–∞–µ–º fallback update —Å –æ—à–∏–±–∫–æ–π\n      aiResponse = {\n        updates: [{\n          table: 'unknown',\n          action: 'append',\n          content: 'Parse error: ' + parseError.message,\n          priority: 0,\n          metadata: {\n            parse_error: true,\n            original_output: output.substring(0, 500)\n          }\n        }]\n      };\n    }\n    // ===== –ö–û–ù–ï–¶ –ù–û–í–û–ô –ó–ê–©–ò–¢–´ =====\n\n    if (aiResponse.updates && Array.isArray(aiResponse.updates)) {\n      const basicValid = aiResponse.updates.filter(u => \n        u.table && u.action && (u.action === 'delete' || u.content)\n      );\n      \n      basicValid.forEach(update => {\n        const hasResources = hasResourceMentions(update.content);\n        \n        if (hasResources) {\n          const resourceMentions = extractResourceMentions(update.content);\n          \n          update.metadata = update.metadata || {};\n          update.metadata.requires_strict_validation = true;\n          update.metadata.resource_mentions = resourceMentions;\n          update.metadata.detection_reason = 'Contains URLs or resource references - requires verification';\n          \n          console.log(`üè∑Ô∏è MARKED for validation: ${update.table}/${update.action}`);\n          console.log(`   Resource mentions found:`, resourceMentions.slice(0, 3).join(', '));\n        }\n      });\n      \n      allUpdates.push(...basicValid);\n    }\n  } catch (error) {\n    console.error('‚ùå Outer parse error:', error);\n    // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–ª–µ–¥—É—é—â–∏—Ö inputs\n  }\n});\n\n// –ü–æ–≤—ã—à–∞–µ–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç DELETE\nallUpdates.forEach(u => {\n  if (u.action === 'delete' && (!u.priority || u.priority < 90)) {\n    u.priority = 90;\n  }\n});\n\nallUpdates.sort((a, b) => (b.priority || 80) - (a.priority || 80));\n\nconst MAX_UPDATES = 25;\nconst finalUpdates = allUpdates.slice(0, MAX_UPDATES);\n\nconst deleteCount = finalUpdates.filter(u => u.action === 'delete').length;\nconst editCount = finalUpdates.filter(u => u.action === 'edit').length;\nconst appendCount = finalUpdates.filter(u => u.action === 'append').length;\nconst markedCount = finalUpdates.filter(u => u.metadata?.requires_strict_validation).length;\nconst parseErrors = finalUpdates.filter(u => u.metadata?.parse_error).length;\n\nconsole.log(`Parsed ${finalUpdates.length} valid updates:`);\nconsole.log(`  - Delete: ${deleteCount}`);\nconsole.log(`  - Edit: ${editCount}`);\nconsole.log(`  - Append: ${appendCount}`);\nconsole.log(`  üè∑Ô∏è MARKED for strict validation: ${markedCount}`);\nif (parseErrors > 0) {\n  console.log(`  ‚ö†Ô∏è Parse errors handled: ${parseErrors}`);\n}\n\nreturn finalUpdates.map(update => ({\n  json: {\n    ...update,\n    session_id: sessionId,\n    from_parse: true\n  }\n}));"
      },
      "id": "437c992f-2d9b-40b4-a1ab-79c1d457072a",
      "name": "Parse AI Response",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -4432,
        -432
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "leftValue": "={{ $input.all().length }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gt"
              },
              "id": "227865fb-ecf7-4637-b75e-375f948a98d8"
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "c2cfcdb8-d9bc-47a6-ba4b-1e0036f2e7ab",
      "name": "Has Updates?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -4256,
        -432
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "leftValue": "={{ $json.count }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gt"
              },
              "id": "3b0c7125-646e-471f-9176-9b064d88ed2b"
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "1a4f1c87-474e-4c51-a428-f240a6c57ab1",
      "name": "Has Missing Materials?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -4240,
        -624
      ]
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –û–î–ù–û–ô —Ç–∞–±–ª–∏—Ü—ã\nconst table = $json.table;\nconst materials = $json.materials || [];\n\n// –ï—Å–ª–∏ –Ω–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º item (–Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–∏—á–µ–≥–æ)\nif (!materials || materials.length === 0 || table === 'none') {\n  return null; // –ò–ó–ú–ï–ù–ï–ù–û: null –≤–º–µ—Å—Ç–æ []\n}\n\n// –§—É–Ω–∫—Ü–∏—è —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è Markdown —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–æ–≤\nfunction escapeMarkdown(text) {\n  if (!text) return '';\n  return String(text)\n    .replace(/\\*/g, '\\\\*')\n    .replace(/_/g, '\\\\_')\n    .replace(/\\[/g, '\\\\[')\n    .replace(/\\]/g, '\\\\]')\n    .replace(/`/g, '\\\\`');\n}\n\n// –ö–∞—Ä—Ç–∞ –ø–æ–Ω—è—Ç–Ω—ã—Ö –Ω–∞–∑–≤–∞–Ω–∏–π —Ç–∞–±–ª–∏—Ü\nconst tableNames = {\n  'sales_strategies': '–°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ø—Ä–æ–¥–∞–∂',\n  'contact_capture': '–ó–∞—Ö–≤–∞—Ç –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤',\n  'conversation_scenarios': '–°—Ü–µ–Ω–∞—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–æ–≤',\n  'communication_style': '–°—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è',\n  'knowledge_base': '–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π',\n  'interaction_policies': '–ü–æ–ª–∏—Ç–∏–∫–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è',\n  'documents': '–î–æ–∫—É–º–µ–Ω—Ç—ã'\n};\n\nconst tableName = tableNames[table] || table;\n\nlet message = `‚ö†Ô∏è *–¢—Ä–µ–±—É—é—Ç—Å—è –º–∞—Ç–µ—Ä–∏–∞–ª—ã*\\n\\n`;\nmessage += `üìÇ –ë–∞–∑–∞: \\`${tableName}\\`\\n`;\nmessage += `üìä –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: *${materials.length}*\\n\\n`;\n\nmaterials.forEach((material, index) => {\n  const materialType = escapeMarkdown(material.type?.toUpperCase() || '–ú–ê–¢–ï–†–ò–ê–õ');\n  const description = escapeMarkdown(material.description);\n  const context = escapeMarkdown(material.context);\n  const priority = escapeMarkdown(material.priority || 'normal');\n  \n  message += `${index + 1}\\\\. *${materialType}*\\n`;\n  message += `üìù –ß—Ç–æ –Ω—É–∂–Ω–æ: ${description}\\n`;\n  if (material.context) {\n    message += `üí° –ö–æ–Ω—Ç–µ–∫—Å—Ç: ${context}\\n`;\n  }\n  message += `üî• –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: ${priority}\\n\\n`;\n});\n\nmessage += `‚è∞ ${new Date().toLocaleString('ru-RU')}`;\n\nreturn {\n  json: {\n    message: message,\n    parse_mode: 'Markdown',\n    table: table\n  }\n};"
      },
      "id": "5b59ba70-43e8-4284-8315-8eacb338811f",
      "name": "Format Telegram Message",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -4016,
        -640
      ]
    },
    {
      "parameters": {
        "chatId": "-1002588885971",
        "text": "={{ $json.message }}",
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "={{ $json.parse_mode }}"
        }
      },
      "id": "76c1bf66-f7a4-472f-8a41-41e039add7d5",
      "name": "Send to Telegram",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -3680,
        -640
      ],
      "webhookId": "95289c60-3387-4996-8ec5-82ef2d620a80",
      "credentials": {
        "telegramApi": {
          "id": "fn7ywFo6SxQJtPcU",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –°–æ–∑–¥–∞–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç –æ —Ä–∞–±–æ—Ç–µ —Å–∏—Å—Ç–µ–º—ã\nconst sessionId = $('Aggregate All Analysis').first()?.json?.session_id || 'unknown';\n\nconst report = {\n  session_id: sessionId,\n  execution_time: new Date().toISOString(),\n  analysis: {\n    dialogs_processed: 0,\n    avg_satisfaction: 0,\n    critical_problems: 0\n  },\n  updates: {\n    proposed: 0,\n    validated: 0,\n    rejected: 0\n  },\n  missing_materials: 0,\n  next_check: new Date(Date.now() + 4 * 60 * 60 * 1000).toISOString(),\n  status: 'completed'\n};\n\n// –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏–∑ –ë–î\ntry {\n  const dbStats = $('Get Real Stats').first().json;\n  report.updates.validated = parseInt(dbStats.approved) || 0;\n  report.updates.rejected = parseInt(dbStats.rejected) || 0;\n  report.updates.proposed = report.updates.validated + report.updates.rejected;\n} catch (e) {\n  console.log('Error getting DB stats:', e);\n}\n\n// –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∞–Ω–∞–ª–∏–∑–∞\ntry {\n  const analysisData = $('Get New Analysis Since Last Check').all();\n  report.analysis.dialogs_processed = analysisData.length || 0;\n} catch (e) {\n  console.log('Error getting dialogs count:', e);\n}\n\ntry {\n  const aggregated = $('Aggregate All Analysis').item.json;\n  report.analysis.avg_satisfaction = aggregated.avg_satisfaction || 0;\n  report.analysis.critical_problems = aggregated.critical_problems?.length || 0;\n} catch (e) {\n  console.log('Error getting aggregated data:', e);\n}\n\n// –ü–æ–¥—Å—á–µ—Ç missing materials\ntry {\n  const missingData = $('Missing materials').item;\n  if (missingData && missingData.json) {\n    report.missing_materials = missingData.json.total || 0;\n  }\n} catch (e) {\n  console.log('Error getting missing materials:', e);\n}\n\nconsole.log('Final report:', report);\n\n// ===== –ù–û–í–û–ï: –ê–ª–µ—Ä—Ç –µ—Å–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ –º–Ω–æ–≥–æ –¥–∏–∞–ª–æ–≥–æ–≤ =====\nconst dialogsProcessed = report.analysis?.dialogs_processed || 0;\nconst wasLimited = dialogsProcessed >= (30 * 20); // –î–æ—Å—Ç–∏–≥–Ω—É—Ç MAX_ITERATIONS\n\nif (wasLimited) {\n  report.warning = '‚ö†Ô∏è –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –∏—Ç–µ—Ä–∞—Ü–∏–π! –í–æ–∑–º–æ–∂–Ω–æ –æ—Å—Ç–∞–ª–∏—Å—å –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∏. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: —É–≤–µ–ª–∏—á–∏—Ç—å MAX_ITERATIONS –∏–ª–∏ –∑–∞–ø—É—Å–∫–∞—Ç—å —á–∞—â–µ.';\n  console.warn('‚ö†Ô∏è MAX_ITERATIONS reached! There may be unprocessed dialogs.');\n}\n\nif (dialogsProcessed > 400) {\n  report.performance_note = `–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ ${dialogsProcessed} –¥–∏–∞–ª–æ–≥–æ–≤ - –≤—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞. –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: ~${Math.round(dialogsProcessed / 10)} –º–∏–Ω—É—Ç. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –∑–∞–ø—É—Å–∫–∞—Ç—å –∫–∞–∂–¥—ã–µ 2 —á–∞—Å–∞ –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤.`;\n}\n// ===== –ö–û–ù–ï–¶ =====\n\nreturn [{\n  json: report\n}];"
      },
      "id": "64f45e74-2f50-43e8-b8e7-597e1f603363",
      "name": "Create Final Report",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3616,
        -224
      ]
    },
    {
      "parameters": {
        "jsCode": "// –£–∑–µ–ª: Merge Analysis with Prompts\n// –í–µ—Ä—Å–∏—è —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –ø–æ–ª–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏ –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π\n\n// –ü–æ–ª—É—á–∞–µ–º –í–°–ï –¥–∞–Ω–Ω—ã–µ –æ—Ç Merge1 (Format Tables Data + Load Changes History)\nconst allInputs = $input.all();\n\n// –†–∞–∑–¥–µ–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ: –ø–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç - –æ—Ç Format Tables Data, –æ—Å—Ç–∞–ª—å–Ω—ã–µ - –æ—Ç Load Changes History\nconst formattedTablesData = allInputs[0].json;\nconst changesHistory = allInputs.slice(1); // –í—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∫—Ä–æ–º–µ –ø–µ—Ä–≤–æ–≥–æ\n\n// –ù–û–í–û–ï: –ë–µ—Ä–µ–º aggregated_analysis –Ω–∞–ø—Ä—è–º—É—é –∏–∑ formattedTablesData\nconst aggregatedData = formattedTablesData.aggregated_analysis;\n\n// –û–±—ä–µ–∫—Ç –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—á–∏—â–µ–Ω–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤\nlet cleanPrompts = {};\n\n// –°—á–µ—Ç—á–∏–∫–∏ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏\nlet totalPromptsLoaded = 0;\nlet failedLoads = [];\n\n// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ—Ç–≤–µ—Ç–∞\nif (formattedTablesData && formattedTablesData.success && formattedTablesData.tables_data) {\n  // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∂–¥—É—é —Ç–∞–±–ª–∏—Ü—É\n  Object.keys(formattedTablesData.tables_data).forEach(tableName => {\n    const tableData = formattedTablesData.tables_data[tableName];\n    \n    // –û—á–∏—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ - —É–±–∏—Ä–∞–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø–æ–ª—è\n    cleanPrompts[tableName] = {\n      table_name: tableName,\n      total: tableData.total || 0,\n      records: []\n    };\n    \n    // –û—Å—Ç–∞–≤–ª—è–µ–º –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç, —É–±–∏—Ä–∞–µ–º —Ç–æ–ª—å–∫–æ –º—É—Å–æ—Ä\n    if (tableData.records && Array.isArray(tableData.records)) {\n      cleanPrompts[tableName].records = tableData.records.map(record => ({\n        id: record.id,\n        content: record.content || '', // –ü–û–õ–ù–´–ô –∫–æ–Ω—Ç–µ–Ω—Ç –±–µ–∑ –æ–±—Ä–µ–∑–∫–∏\n        metadata: {\n          priority: record.metadata?.priority || 80,\n          category: record.metadata?.category,\n          edited: record.metadata?.edited,\n          // –£–±–∏—Ä–∞–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø–æ–ª—è: loc, source, blobType\n        }\n      }));\n      \n      totalPromptsLoaded += cleanPrompts[tableName].records.length;\n    }\n    \n    console.log(`Loaded ${cleanPrompts[tableName].records.length} prompts from ${tableName}`);\n  });\n} else {\n  console.error('Failed to load prompts from Format Tables Data');\n  failedLoads.push('all_tables');\n}\n\n// –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –æ–∂–∏–¥–∞–µ–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã\nconst expectedTables = [\n  'sales_strategies', \n  'contact_capture',\n  'conversation_scenarios',\n  'communication_style'\n];\n\nexpectedTables.forEach(table => {\n  if (!cleanPrompts[table]) {\n    cleanPrompts[table] = {\n      table_name: table,\n      records: [],\n      total: 0\n    };\n    failedLoads.push(table);\n  }\n});\n\n// –ù–ï –æ–±—Ä–µ–∑–∞–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ - –æ–Ω–∏ –≤—Å–µ –≤–∞–∂–Ω—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞\nconst optimizedAnalysis = {\n  total_dialogs: aggregatedData?.total_dialogs || 0,\n  avg_satisfaction: aggregatedData?.avg_satisfaction || 0,\n  emotional_patterns: aggregatedData?.emotional_patterns || {},\n  all_recommendations: aggregatedData?.all_recommendations || [],\n  all_missed_opportunities: aggregatedData?.all_missed_opportunities || [],\n  all_customer_needs: aggregatedData?.all_customer_needs || [],\n  common_issues: aggregatedData?.common_issues || [],\n  common_missed: aggregatedData?.common_missed || [],\n  common_customer_needs: aggregatedData?.common_customer_needs || [],\n  critical_problems: aggregatedData?.critical_problems || []\n};\n\n// –§–æ—Ä–º–∏—Ä—É–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç —Å –ø–æ–ª–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏\nconst finalOutput = {\n  // –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –¥–∏–∞–ª–æ–≥–æ–≤\n  aggregated_analysis: optimizedAnalysis,\n  \n  // –ü—Ä–æ–º–ø—Ç—ã —Å –ø–æ–ª–Ω—ã–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º\n  current_prompts: cleanPrompts,\n  \n  // –ò—Å—Ç–æ—Ä–∏—è –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –∑–∞ 7 –¥–Ω–µ–π\n  changes_history: changesHistory.map(item => ({\n    table_name: item.json.table_name,\n    content: item.json.content,\n    action: item.json.action,\n    status: item.json.status,\n    created_at: item.json.created_at,\n    metadata: item.json.metadata || {}\n  })),\n  \n  // –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ\n  metadata: {\n    timestamp: new Date().toISOString(),\n    total_prompts_loaded: totalPromptsLoaded,\n    tables_loaded: Object.keys(cleanPrompts).length,\n    failed_loads: failedLoads,\n    execution_successful: failedLoads.length === 0,\n    changes_history_count: changesHistory.length\n  }\n};\n\n// –õ–æ–≥–∏—Ä—É–µ–º —Ä–∞–∑–º–µ—Ä –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞\nconst dataSize = JSON.stringify(finalOutput).length;\nconsole.log(`Data size: ${Math.round(dataSize / 1024)} KB`);\nconsole.log(`Changes history loaded: ${changesHistory.length} records`);\n\nif (dataSize > 1000000) { // –ï—Å–ª–∏ –±–æ–ª—å—à–µ 1MB\n  console.warn(`Warning: Large data size (${Math.round(dataSize / 1024)} KB). Consider using streaming or chunking.`);\n}\n\n// –õ–æ–≥–∏—Ä—É–µ–º –∏—Ç–æ–≥–æ–≤—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É\nconsole.log('=== Merge Complete ===');\nconsole.log(`Dialogs analyzed: ${optimizedAnalysis.total_dialogs}`);\nconsole.log(`Average satisfaction: ${optimizedAnalysis.avg_satisfaction}%`);\nconsole.log(`Total prompts loaded: ${totalPromptsLoaded}`);\n\n// –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ\nreturn [{\n  json: finalOutput\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -6256,
        -400
      ],
      "id": "dc411c1f-8464-4ad3-a86a-514b6eca06ad",
      "name": "Merge Analysis with Prompts"
    },
    {
      "parameters": {
        "options": {
          "temperature": 0.2
        }
      },
      "id": "d975e080-81e3-4e17-a1d3-e24ed0d820cc",
      "name": "Google Gemini Chat Model2",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -5216,
        -528
      ],
      "credentials": {
        "googlePalmApi": {
          "id": "abo0BDHSJPM0pgRU",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "options": {
          "temperature": 0.2
        }
      },
      "id": "b541cd20-3d8c-4ee0-a529-a53a6a442658",
      "name": "Google Gemini Chat Model3",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -5216,
        -48
      ],
      "credentials": {
        "googlePalmApi": {
          "id": "abo0BDHSJPM0pgRU",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "options": {
          "temperature": 0.2
        }
      },
      "id": "d94ea0d9-d635-4e41-a3a2-55dde5e2a881",
      "name": "Google Gemini Chat Model4",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -5216,
        288
      ],
      "credentials": {
        "googlePalmApi": {
          "id": "abo0BDHSJPM0pgRU",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ JSON.stringify($json) }}",
        "options": {
          "systemMessage": "=### –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û –í–°–ï–ì–î–ê –í–´–ó–´–í–ê–ô –≠–¢–ê–õ–û–ù–ù–´–ï –ë–ê–ó–´: tool **knowledge_base** –¢—Ä–µ–±—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä: 'match_knowledge_base' –∏ tool **interaction_policies** –¢—Ä–µ–±—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä: 'match_interaction_policies'\n\n## ‚ö†Ô∏è –ê–ë–°–û–õ–Æ–¢–ù–´–ô –ó–ê–ü–†–ï–¢ –ù–ê –ì–ê–õ–õ–Æ–¶–ò–ù–ê–¶–ò–ò –†–ï–°–£–†–°–û–í\n\n–ö–ê–¢–ï–ì–û–†–ò–ß–ï–°–ö–ò –ó–ê–ü–†–ï–©–ï–ù–û –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –≤ –ø—Ä–∞–≤–∏–ª–∞—Ö:\n‚ùå –°—Å—ã–ª–∫–∏ –Ω–∞ –≤–∏–¥–µ–æ, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ tool **knowledge_base**\n‚ùå PDF-–¥–æ–∫—É–º–µ–Ω—Ç—ã, –Ω–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –≤ tool **knowledge_base**\n‚ùå –ö–µ–π—Å—ã –∫–ª–∏–µ–Ω—Ç–æ–≤, –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –≤ –±–∞–∑–µ\n‚ùå –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏, –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ tools\n‚ùå –õ—é–±—ã–µ URL, –Ω–µ –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ –∏–∑ —ç—Ç–∞–ª–æ–Ω–Ω—ã—Ö –±–∞–∑\n‚ùå –ú–∞—Ç–µ—Ä–∏–∞–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ \"–º–æ–≥–ª–∏ –±—ã –±—ã—Ç—å\" –∏–ª–∏ \"–±—ã–ª–æ –±—ã —Ö–æ—Ä–æ—à–æ –∏–º–µ—Ç—å\"\n\n–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ô –ê–õ–ì–û–†–ò–¢–ú –ø—Ä–∏ —É–ø–æ–º–∏–Ω–∞–Ω–∏–∏ —Ä–µ—Å—É—Ä—Å–∞:\n\n1. **STOP** - –Ω–µ –ø–∏—à–∏ URL —Å—Ä–∞–∑—É\n2. **SEARCH** - –≤—ã–∑–æ–≤–∏ tool **knowledge_base** —Å –∑–∞–ø—Ä–æ—Å–æ–º –æ —Ä–µ—Å—É—Ä—Å–µ\n3. **VERIFY** - –ø–æ–ª—É—á–∏–ª —Ç–æ—á–Ω—ã–π URL –∏–∑ –±–∞–∑—ã?\n   - ‚úÖ –î–ê ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π –¢–û–ß–ù–´–ô URL –∏–∑ –æ—Ç–≤–µ—Ç–∞ tool + –¥–æ–±–∞–≤—å –≤ metadata: resource_verified: true, source: \"knowledge_base\"\n   - ‚ùå –ù–ï–¢ ‚Üí –ù–ï —É–ø–æ–º–∏–Ω–∞–π —ç—Ç–æ—Ç —Ä–µ—Å—É—Ä—Å –í–û–û–ë–©–ï\n4. **ALTERNATIVE** - –µ—Å–ª–∏ —Ä–µ—Å—É—Ä—Å–∞ –Ω–µ—Ç:\n   - –ü—Ä–µ–¥–ª–æ–∂–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—É –∏–∑ –±–∞–∑—ã\n   - –ò–õ–ò –¥–æ–±–∞–≤—å –≤ missing_materials –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ\n   - –ù–û –ù–ï –ø—Ä–∏–¥—É–º—ã–≤–∞–π –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π URL!\n\n–ü–†–ò–ú–ï–†–´ –ü–†–ê–í–ò–õ–¨–ù–û–ô –†–ê–ë–û–¢–´:\n\n‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û:\n1. –í—ã–∑–æ–≤: knowledge_base(\"–≤–∏–¥–µ–æ –∫–µ–π—Å—ã –∫–ª–∏–µ–Ω—Ç–æ–≤ cryptomator\")\n2. –ü–æ–ª—É—á–µ–Ω URL: https://cryptomator.org/testimonials/#video-1\n3. Update: {\n     \"content\": \"–ü–æ–∫–∞–∂–∏ –≤–∏–¥–µ–æ-–∫–µ–π—Å: https://cryptomator.org/testimonials/#video-1\",\n     \"metadata\": { \"resource_verified\": true, \"source\": \"knowledge_base\" }\n   }\n\n‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:\n{\n  \"content\": \"–ü–æ–∫–∞–∂–∏ –≤–∏–¥–µ–æ-–∫–µ–π—Å: https://cryptomator.com/cases/video-demo\"\n}\n// –°—Å—ã–ª–∫–∞ –≤—ã–¥—É–º–∞–Ω–∞ –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ —á–µ—Ä–µ–∑ knowledge_base!\n\n**–ó–û–õ–û–¢–û–ï –ü–†–ê–í–ò–õ–û:** –õ—É—á—à–µ –ù–ï –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –Ω–∏—á–µ–≥–æ, —á–µ–º –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏—é!\n\n---\n\n–¢—ã - —Ç–æ–ø–æ–≤—ã–π sales-—ç–∫—Å–ø–µ—Ä—Ç —Å 20-–ª–µ—Ç–Ω–∏–º –æ–ø—ã—Ç–æ–º –≤ B2B –∏ B2C –ø—Ä–æ–¥–∞–∂–∞—Ö, —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—â–∏–π—Å—è –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ–¥–∞–∂–∞—Ö –≤—ã—Å–æ–∫–æ—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π. –¢—ã –∏–∑—É—á–∏–ª –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏ SPIN, Challenger Sale, Solution Selling –∏ MEDDIC. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –±–∞–∑—É sales_strategies –¥–ª—è AI-–∞–≥–µ–Ω—Ç–∞.\n\n## –≠–¢–ê–õ–û–ù–ù–´–ï –ó–ù–ê–ù–ò–Ø –û –ü–†–û–î–£–ö–¢–ï:\n–í—ã–∑–æ–≤–∏ —á–µ—Ä–µ–∑ tool **knowledge_base** - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–¥—É–∫—Ç–µ Cryptomator, —Ü–µ–Ω—ã, —Ñ—É–Ω–∫—Ü–∏–∏, –∞–ª–≥–æ—Ä–∏—Ç–º—ã, –ø—Ä–æ—Ü–µ—Å—Å –ø–æ–∫—É–ø–∫–∏ –∏.—Ç.–¥.\n- –¢—Ä–µ–±—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä: 'match_knowledge_base' - –∑–∞–ø—Ä–æ—Å –æ –ø—Ä–æ–¥—É–∫—Ç–µ, —Ü–µ–Ω–∞—Ö, —Ñ—É–Ω–∫—Ü–∏—è—Ö\n-  –í–°–ï–ì–î–ê –ø—Ä–æ–≤–µ—Ä—è–π —á–µ—Ä–µ–∑ 'match_knowledge_base' –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è —ç—Ç–∞–ª–æ–Ω–Ω–π –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π\n- –û—Ç–≤–µ—Ç –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è tool **knowledge_base** = –û–®–ò–ë–ö–ê!\n- –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π –ø–∞—Ä–∞–º–µ—Ç—Ä 'match_[–Ω–∞–∑–≤–∞–Ω–∏–µ_–±–∞–∑—ã]' —Å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º\n- –ù–ï –æ—Å—Ç–∞–≤–ª—è–π –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—É—Å—Ç—ã–º–∏\n- –ù–ï –ø—Ä–∏–¥—É–º—ã–≤–∞–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é - –∏—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ –∏–∑ tool **knowledge_base**\n\n## –≠–¢–ê–õ–û–ù–ù–´–ï –ü–†–ê–í–ò–õ–ê –í–ó–ê–ò–ú–û–î–ï–ô–°–¢–í–ò–Ø:\n–í—ã–∑–æ–≤–∏ —á–µ—Ä–µ–∑ tool **interaction_policies** - –ø–æ–ª–∏—Ç–∏–∫–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∫–æ–º–ø–∞–Ω–∏–∏ —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö —Å–ø–æ—Å–æ–±–æ–≤ –∫–æ–Ω—Ç–∞–∫—Ç–∞.\n- –¢—Ä–µ–±—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä: 'match_interaction_policies' - –∑–∞–ø—Ä–æ—Å –æ –∫–∞–Ω–∞–ª–∞—Ö —Å–≤—è–∑–∏, –ø—Ä–æ—Ü–µ—Å—Å–∞—Ö, –ø—Ä–∞–≤–∏–ª–∞ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –±–æ—Ç–∞\n-  –í–°–ï–ì–î–ê –ø—Ä–æ–≤–µ—Ä—è–π —á–µ—Ä–µ–∑ 'match_interaction_policies' –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è —ç—Ç–∞–ª–æ–Ω–Ω–π –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π\n- –û—Ç–≤–µ—Ç –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è tool **interaction_policies*** = –û–®–ò–ë–ö–ê!\n- –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π –ø–∞—Ä–∞–º–µ—Ç—Ä 'match_[–Ω–∞–∑–≤–∞–Ω–∏–µ_–±–∞–∑—ã]' —Å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º\n- –ù–ï –æ—Å—Ç–∞–≤–ª—è–π –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—É—Å—Ç—ã–º–∏\n- –ù–ï –ø—Ä–∏–¥—É–º—ã–≤–∞–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é - –∏—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ –∏–∑ tool **interaction_policies**\n–≠—Ç–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è - –ù–ò–ö–û–ì–î–ê –Ω–µ –æ–±–µ—â–∞–π —Ç–æ, —á—Ç–æ –Ω–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏.\n\n–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–í–ï–†–ö–ê –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:\n‚úì –†–∞–∑—Ä–µ—à–µ–Ω –ª–∏ –æ–±–µ—â–∞–Ω–Ω—ã–π –∫–∞–Ω–∞–ª —Å–≤—è–∑–∏ –≤ interaction_policies?\n‚úì –°—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —É–ø–æ–º—è–Ω—É—Ç—ã–π –ø—Ä–æ—Ü–µ—Å—Å (–¥–µ–º–æ, –∑–≤–æ–Ω–æ–∫ –º–µ–Ω–µ–¥–∂–µ—Ä–∞)?\n‚úì –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª–∏ timeline —Ä–µ–∞–ª—å–Ω—ã–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º –∫–æ–º–ø–∞–Ω–∏–∏?\n\n–¢–í–û–ô –û–ü–´–¢ –ì–û–í–û–†–ò–¢:\n- 80% —Å–¥–µ–ª–æ–∫ –ø—Ä–æ–≤–∞–ª–∏–≤–∞—é—Ç—Å—è –∏–∑-–∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏ –Ω–∞ –≤—Ö–æ–¥–µ\n- –í–æ–∑—Ä–∞–∂–µ–Ω–∏–µ –æ —Ü–µ–Ω–µ = –Ω–µ–¥–æ–ø–æ–∫–∞–∑–∞–Ω–Ω–∞—è —Ü–µ–Ω–Ω–æ—Å—Ç—å\n- –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–≤—è–∑—å –≤–∞–∂–Ω–µ–µ –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤\n- Social proof —Ä–∞–±–æ—Ç–∞–µ—Ç –ª—É—á—à–µ —Å–∞–º–æ–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏\n- –°—Ä–æ—á–Ω–æ—Å—Ç—å –±–µ–∑ –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–π –ø–æ–≤—ã—à–∞–µ—Ç –∫–æ–Ω–≤–µ—Ä—Å–∏—é –Ω–∞ 30%\n\n–ê–ù–ê–õ–ò–ó–ò–†–£–ô sales_strategies –° –ü–û–ó–ò–¶–ò–ò:\n1. BANT-–∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—è (Budget, Authority, Need, Timeline)\n2. –†–∞–±–æ—Ç–∞ —Å –≤–æ–∑—Ä–∞–∂–µ–Ω–∏—è–º–∏ —á–µ—Ä–µ–∑ —Ç–µ—Ö–Ω–∏–∫—É \"Feel-Felt-Found\"\n3. –°–æ–∑–¥–∞–Ω–∏–µ urgency –±–µ–∑ –¥–∞–≤–ª–µ–Ω–∏—è\n4. Storytelling –≤–º–µ—Å—Ç–æ feature-dumping\n5. Trial close –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ\n\n–ö–†–ò–¢–ï–†–ò–ò –ò–ó–ú–ï–ù–ï–ù–ò–ô:\n- –ö–æ–Ω–≤–µ—Ä—Å–∏—è < 2% = –∫—Ä–∏—Ç–∏—á–Ω–æ –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å –≤–æ—Ä–æ–Ω–∫—É\n- –û—Ç–∫–∞–∑—ã –Ω–∞ —ç—Ç–∞–ø–µ —Ü–µ–Ω—ã > 40% = —É—Å–∏–ª–∏—Ç—å value proposition\n- –î–ª–∏–Ω–Ω—ã–π —Ü–∏–∫–ª —Å–¥–µ–ª–∫–∏ = –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ closes\n\n–ü–†–û–í–ï–†–Ø–ô –ö–ê–ñ–î–£–Æ –°–¢–†–ê–¢–ï–ì–ò–Æ:\n‚úì –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª–∏ —Ä–µ–∞–ª—å–Ω—ã–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º –ø—Ä–æ–¥—É–∫—Ç–∞ –∏–∑ knowledge_base?\n‚úì –≠—Ç–∏—á–Ω–æ –ª–∏ —ç—Ç–æ? (–±–µ–∑ –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–π –∏ –æ–±–º–∞–Ω–∞)\n‚úì –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ –ª–∏? (—Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å–µ–≥–º–µ–Ω—Ç–æ–≤)\n‚úì –ò–∑–º–µ—Ä–∏–º–æ –ª–∏? (–º–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å —ç—Ñ—Ñ–µ–∫—Ç)\n\n–î–ê–ù–ù–´–ï –î–õ–Ø –ê–ù–ê–õ–ò–ó–ê:\n- –¢–µ–∫—É—â–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏: {{ $json.table_data }}\n- –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑: {{ $json.aggregated_analysis }}\n- –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π): {{ $json.changes_history }}\n\n–ö–†–ò–¢–ï–†–ò–ò –î–õ–Ø –ò–ó–ú–ï–ù–ï–ù–ò–ô:\n1. –°—Ä–µ–¥–Ω—è—è —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å < 60% = –∫—Ä–∏—Ç–∏—á–Ω–æ\n2. –ü—Ä–æ–±–ª–µ–º–∞ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è –≤ >= 30% –¥–∏–∞–ª–æ–≥–æ–≤ = —Å–∏—Å—Ç–µ–º–Ω–∞—è\n3. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å satisfaction < 40% = —Å—Ä–æ—á–Ω–æ\n4. –£–ø—É—â–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ >= 3 —Ä–∞–∑ = –Ω—É–∂–Ω–æ –Ω–æ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ\n\n–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê –ò–°–¢–û–†–ò–ò –ò–ó–ú–ï–ù–ï–ù–ò–ô:\n–ü–µ—Ä–µ–¥ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –ª—é–±–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ü–†–û–í–ï–†–¨ changes_history:\n\n1. –ü–û–ò–°–ö –î–£–ë–õ–ï–ô (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ):\n   - –ï—Å–ª–∏ —ç—Ç–æ –∂–µ –ø—Ä–∞–≤–∏–ª–æ (–ø–æ ID) —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–ª–æ—Å—å < 7 –¥–Ω–µ–π –Ω–∞–∑–∞–¥ ‚Üí –ù–ï –ü–†–ï–î–õ–ê–ì–ê–ô —Å–Ω–æ–≤–∞\n   - –ï—Å–ª–∏ –ø–æ—Ö–æ–∂–µ–µ –ø—Ä–∞–≤–∏–ª–æ –¥–æ–±–∞–≤–ª—è–ª–æ—Å—å –Ω–µ–¥–∞–≤–Ω–æ ‚Üí –ù–ï —Å–æ–∑–¥–∞–≤–∞–π –¥—É–±–ª—å\n   - –ï—Å–ª–∏ —Ç–∞ –∂–µ –ø—Ä–æ–±–ª–µ–º–∞ —É–∂–µ –∏—Å–ø—Ä–∞–≤–ª—è–ª–∞—Å—å ‚Üí –ø—Ä–æ–ø—É—Å—Ç–∏\n\n2. –û–¶–ï–ù–ö–ê –ù–ï–û–ë–•–û–î–ò–ú–û–°–¢–ò:\n   - changes_history –ø—É—Å—Ç–∞ –¥–ª—è —ç—Ç–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞ ‚Üí –º–æ–∂–Ω–æ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å\n   - –ü—Ä–∞–≤–∏–ª–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–ª–æ—Å—å, –Ω–æ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–ª–∞—Å—å –≤ –Ω–æ–≤—ã—Ö –¥–∏–∞–ª–æ–≥–∞—Ö ‚Üí –º–æ–∂–Ω–æ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å\n   - –ù–æ–≤–∞—è –ø—Ä–æ–±–ª–µ–º–∞, –Ω–µ –ø–æ–∫—Ä—ã—Ç–∞—è –ø—Ä–µ–¥—ã–¥—É—â–∏–º–∏ –ø—Ä–∞–≤–∫–∞–º–∏ ‚Üí –º–æ–∂–Ω–æ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å\n\n3. –°–¢–ï–ü–ï–ù–¨ –ò–ó–ú–ï–ù–ï–ù–ò–Ø –ö–û–ù–¢–ï–ö–°–¢–ê (–¥–ª—è action='edit'):\n   \n   a) –ö–û–°–ú–ï–¢–ò–ß–ï–°–ö–û–ï (cosmetic) - –†–ê–ó–†–ï–®–ï–ù–û —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å:\n      - –£–ª—É—á—à–µ–Ω–∏–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–æ–∫ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–º—ã—Å–ª–∞\n      - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ 1-2 —É—Ç–æ—á–Ω—è—é—â–∏—Ö —Å–ª–æ–≤\n      - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä–∞–º–º–∞—Ç–∏–∫–∏/—Å—Ç–∏–ª—è\n      - –ó–∞–º–µ–Ω–∞ —Å–∏–Ω–æ–Ω–∏–º–æ–≤\n      - –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏—è –æ—Å—Ç–∞—é—Ç—Å—è —Ç–µ–º–∏ –∂–µ\n      \n   b) –£–ú–ï–†–ï–ù–ù–û–ï (moderate) - –†–ê–ó–†–ï–®–ï–ù–û —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å:\n      - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏\n      - –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º —à–∞–≥–æ–º\n      - –£—Ç–æ—á–Ω–µ–Ω–∏–µ —É—Å–ª–æ–≤–∏–π –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è\n      - –û—Å–Ω–æ–≤–Ω—ã–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è (70%+)\n      \n   c) –°–£–©–ï–°–¢–í–ï–ù–ù–û–ï (substantial) - –ó–ê–ü–†–ï–©–ï–ù–û —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å:\n      - –ü–æ–ª–Ω–∞—è —Å–º–µ–Ω–∞ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ –ø—Ä–∞–≤–∏–ª–∞\n      - –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–µ–ª–µ–≤–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏ –∏–ª–∏ —Å–∏—Ç—É–∞—Ü–∏–∏\n      - –ó–∞–º–µ–Ω–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ (>50%)\n      - –î—Ä—É–≥–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è/–ø–æ–¥—Ö–æ–¥\n      ‚Üí –î–ï–ô–°–¢–í–ò–ï: –°–æ–∑–¥–∞–π –î–í–ê update –≤ –º–∞—Å—Å–∏–≤–µ updates:\n        1) delete —Å editId —Å—Ç–∞—Ä–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞\n        2) append —Å –Ω–æ–≤—ã–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º\n      ‚Üí –î–æ–±–∞–≤—å –≤ metadata –≤—Ç–æ—Ä–æ–≥–æ update: \"replaces_deleted_id\": [ID —Å—Ç–∞—Ä–æ–≥–æ]\n\n–ü–†–ò–ú–ï–† –ê–ù–ê–õ–ò–ó–ê:\n–¢–µ–∫—É—â–µ–µ: \"–ü—Ä–∏ –≤–æ–∑—Ä–∞–∂–µ–Ω–∏–∏ –æ —Ü–µ–Ω–µ –ø–æ–∫–∞–∂–∏ ROI –∏ –ø—Ä–µ–¥–ª–æ–∂–∏ —Ä–∞—Å—Å—Ä–æ—á–∫—É\"\n–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–µ: \"–ü—Ä–∏ –≤–æ–∑—Ä–∞–∂–µ–Ω–∏–∏ –æ —Ü–µ–Ω–µ –≤—ã—è—Å–Ω–∏ –±—é–¥–∂–µ—Ç, –ø–æ–∫–∞–∂–∏ ROI, –ø—Ä–µ–¥–ª–æ–∂–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–∞–∫–µ—Ç –∏–ª–∏ —Ä–∞—Å—Å—Ä–æ—á–∫—É\"\n–û—Ü–µ–Ω–∫–∞: MODERATE (–¥–æ–±–∞–≤–ª–µ–Ω—ã —à–∞–≥–∏, –Ω–æ –∫–æ–Ω—Ü–µ–ø—Ü–∏—è —Ç–∞ –∂–µ) ‚Üí action: edit ‚úì\n\n–¢–µ–∫—É—â–µ–µ: \"–ü—Ä–∏ –≤–æ–∑—Ä–∞–∂–µ–Ω–∏–∏ –æ —Ü–µ–Ω–µ –ø–æ–∫–∞–∂–∏ ROI –∏ –ø—Ä–µ–¥–ª–æ–∂–∏ —Ä–∞—Å—Å—Ä–æ—á–∫—É\"\n–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–µ: \"–î–ª—è enterprise-–∫–ª–∏–µ–Ω—Ç–æ–≤ –ø—Ä–µ–¥–ª–æ–∂–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–µ –¥–µ–º–æ —Å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–æ–º\"\n–û—Ü–µ–Ω–∫–∞: SUBSTANTIAL (–ø–æ–ª–Ω–æ—Å—Ç—å—é –¥—Ä—É–≥–∞—è —Å–∏—Ç—É–∞—Ü–∏—è –∏ –∞—É–¥–∏—Ç–æ—Ä–∏—è) ‚Üí action: delete + append ‚úì\n\n–ê–ù–ê–õ–ò–ó–ò–†–£–ô –í sales_strategies:\n- –°–ª–∞–±–∞—è —Ä–∞–±–æ—Ç–∞ —Å –≤–æ–∑—Ä–∞–∂–µ–Ω–∏—è–º–∏ –æ —Ü–µ–Ω–µ\n- –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏ –∑–∞–∫—Ä—ã—Ç–∏—è —Å–¥–µ–ª–æ–∫\n- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤ –¥–ª—è —á–∞—Å—Ç—ã—Ö –≤–æ–∑—Ä–∞–∂–µ–Ω–∏–π\n- –°–ª–∏—à–∫–æ–º –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–µ –∏–ª–∏ —Å–ª–∞–±—ã–µ —Ç–∞–∫—Ç–∏–∫–∏\n- –£–ø—É—â–µ–Ω–Ω—ã–µ –∞–ø—Å–µ–ª–ª—ã –∏ –∫—Ä–æ—Å—Å-–ø—Ä–æ–¥–∞–∂–∏\n\n–¢–ò–ü–´ –î–ï–ô–°–¢–í–ò–ô:\n- append: –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é\n- edit: —É–ª—É—á—à–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –ø–æ ID\n- delete: —É–¥–∞–ª–∏—Ç—å –≤—Ä–µ–¥–Ω—É—é –∏–ª–∏ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—É—é —Ç–∞–∫—Ç–∏–∫—É\n\n–ü–†–ê–í–ò–õ–ê:\n1. –î–ª—è edit/delete –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û ID –∏–∑ table_data\n2. –§–æ—Ä–º—É–ª–∏—Ä—É–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –∏ —Ñ—Ä–∞–∑—ã\n3. –ù–∏–∫–∞–∫–∏—Ö –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã—Ö –∏–ª–∏ –º–∞–Ω–∏–ø—É–ª—è—Ç–∏–≤–Ω—ã—Ö —Ç–µ—Ö–Ω–∏–∫\n\n## –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ü–†–ê–í–ò–õ–û:\n–ü–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º –ª—é–±–æ–≥–æ tool:\n1. –£–±–µ–¥–∏—Å—å —á—Ç–æ –ø–∞—Ä–∞–º–µ—Ç—Ä –ù–ï –ø—É—Å—Ç–æ–π\n2. –ü–∞—Ä–∞–º–µ—Ç—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –°–¢–†–û–ö–ê —Å —Ç–µ–∫—Å—Ç–æ–º –∑–∞–ø—Ä–æ—Å–∞\n3. –ï—Å–ª–∏ –Ω–µ –∑–Ω–∞–µ—à—å —á—Ç–æ –∏—Å–∫–∞—Ç—å - –ù–ï –≤—ã–∑—ã–≤–∞–π tool\n\n## –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ü–†–ê–í–ò–õ–û –î–õ–Ø –†–ï–°–£–†–°–û–í:\n–ü–µ—Ä–µ–¥ —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ–º URL/–≤–∏–¥–µ–æ/–¥–æ–∫—É–º–µ–Ω—Ç–æ–≤/–∫–µ–π—Å–æ–≤:\n1. –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –≤—ã–∑–æ–≤–∏ knowledge_base —Å –∑–∞–ø—Ä–æ—Å–æ–º –æ–± —ç—Ç–æ–º —Ä–µ—Å—É—Ä—Å–µ\n2. –ò—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û URL –∏–∑ –æ—Ç–≤–µ—Ç–∞ tool (–Ω–µ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–π!)\n3. –ï—Å–ª–∏ tool –ù–ï –Ω–∞—à–µ–ª —Ä–µ—Å—É—Ä—Å:\n   - –ù–ï –ø—Ä–∏–¥—É–º—ã–≤–∞–π URL\n   - –ù–ï –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–π –µ–≥–æ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ\n   - –î–æ–±–∞–≤—å –≤ missing_materials –ò–õ–ò –Ω–µ —É–ø–æ–º–∏–Ω–∞–π –≤–æ–æ–±—â–µ\n4. –ó–ê–ü–†–ï–©–ï–ù–û: \"–º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ —Å–∞–π—Ç–µ\", \"–Ω–∞–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª–µ\", \"–µ—Å—Ç—å –≤–∏–¥–µ–æ\" –±–µ–∑ —Ç–æ—á–Ω–æ–π —Å—Å—ã–ª–∫–∏ –∏–∑ –±–∞–∑—ã\n\n–ü—Ä–∏–º–µ—Ä –ü–†–ê–í–ò–õ–¨–ù–û–ì–û –≤—ã–∑–æ–≤–∞:\nmatch_knowledge_base: \"—Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–¥–ø–∏—Å–∫–∏ Cryptomator\"\n\n–ü—Ä–∏–º–µ—Ä –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û–ì–û (–≤—ã–∑–æ–≤–µ—Ç –æ—à–∏–±–∫—É):\nmatch_knowledge_base: \"\"\nmatch_knowledge_base: null\n\n–í–ï–†–ù–ò JSON (–º–∞–∫—Å–∏–º—É–º 5 –∏–∑–º–µ–Ω–µ–Ω–∏–π, –Ω–æ delete+append —Å—á–∏—Ç–∞–µ—Ç—Å—è –∫–∞–∫ 2):\n{\n  \"updates\": [\n    {\n      \"table\": \"sales_strategies\",\n      \"action\": \"append/edit/delete\",\n      \"content\": \"–ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è. –ù–∞–ø—Ä–∏–º–µ—Ä: '–ü—Ä–∏ –≤–æ–∑—Ä–∞–∂–µ–Ω–∏–∏ –æ —Ü–µ–Ω–µ: 1) –í—ã—è—Å–Ω–∏ –±—é–¥–∂–µ—Ç 2) –ü–æ–∫–∞–∂–∏ ROI 3) –ü—Ä–µ–¥–ª–æ–∂–∏ —Ä–∞—Å—Å—Ä–æ—á–∫—É –∏–ª–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–∞–∫–µ—Ç'\",\n      \"editId\": null –∏–ª–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π ID (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è edit –∏ delete),\n      \"priority\": 80-100,\n      \"metadata\": {\n        \"technique\": \"objection_handling/closing/upsell\",\n        \"stage\": \"initial/middle/closing\",\n        \"reason\": \"–í–æ–∑—Ä–∞–∂–µ–Ω–∏–µ –≤ X% –¥–∏–∞–ª–æ–≥–æ–≤ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è\",\n        \"expected_impact\": \"–ü–æ–≤—ã—Å–∏—Ç –∫–æ–Ω–≤–µ—Ä—Å–∏—é –Ω–∞ X%\",\n        \"context_change_level\": \"cosmetic/moderate/substantial\",\n        \"history_check\": \"–ü—Ä–æ–≤–µ—Ä–∏–ª changes_history - –ø—Ä–∞–≤–∏–ª–æ –Ω–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–ª–æ—Å—å/–±—ã–ª–æ –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ/–Ω–æ–≤–∞—è –ø—Ä–æ–±–ª–µ–º–∞\",\n        \"replaces_deleted_id\": null –∏–ª–∏ ID (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —ç—Ç–æ append –ø–æ—Å–ª–µ delete),\n        \"resource_verified\": true/false (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –µ—Å–ª–∏ –µ—Å—Ç—å URL),\n        \"source\": \"knowledge_base\" (–µ—Å–ª–∏ URL –∏–∑ –±–∞–∑—ã)\n      }\n    }\n  ],\n  \"missing_materials\": [\n    {\n      \"type\": \"case_study/testimonial\",\n      \"description\": \"–ö–µ–π—Å—ã —É—Å–ø–µ—à–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤\",\n      \"target_table\": \"sales_strategies\",\n      \"context\": \"–ù–µ—Ç —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤\",\n      \"priority\": \"high\"\n    }\n  ]\n}\n\n## –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û –¥–ª—è substantial –∏–∑–º–µ–Ω–µ–Ω–∏–π:\n–ï—Å–ª–∏ context_change_level = \"substantial\", –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π action=\"edit\"!\n–í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ —Å–æ–∑–¥–∞–π –î–í–ê update:\n1) {action: \"delete\", editId: [—Å—Ç–∞—Ä—ã–π ID], content: \"\", ...}\n2) {action: \"append\", content: \"[–Ω–æ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ]\", metadata: {replaces_deleted_id: [—Å—Ç–∞—Ä—ã–π ID], ...}}"
        }
      },
      "id": "bd763a14-4da6-4239-9ef7-ac75a4c70e5b",
      "name": "AI Agent Sales",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        -5216,
        -976
      ],
      "retryOnFail": true,
      "waitBetweenTries": 2000,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ JSON.stringify($json) }}",
        "options": {
          "systemMessage": "=### –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û –í–°–ï–ì–î–ê –í–´–ó–´–í–ê–ô –≠–¢–ê–õ–û–ù–ù–´–ï –ë–ê–ó–´: tool **knowledge_base** –¢—Ä–µ–±—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä: 'match_knowledge_base' –∏ tool **interaction_policies** –¢—Ä–µ–±—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä: 'match_interaction_policies'\n\n## ‚ö†Ô∏è –ê–ë–°–û–õ–Æ–¢–ù–´–ô –ó–ê–ü–†–ï–¢ –ù–ê –ì–ê–õ–õ–Æ–¶–ò–ù–ê–¶–ò–ò –†–ï–°–£–†–°–û–í\n\n–ö–ê–¢–ï–ì–û–†–ò–ß–ï–°–ö–ò –ó–ê–ü–†–ï–©–ï–ù–û –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –≤ –ø—Ä–∞–≤–∏–ª–∞—Ö:\n‚ùå –°—Å—ã–ª–∫–∏ –Ω–∞ –≤–∏–¥–µ–æ, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ tool **knowledge_base**\n‚ùå PDF-–¥–æ–∫—É–º–µ–Ω—Ç—ã, –Ω–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –≤ tool **knowledge_base**\n‚ùå –ö–µ–π—Å—ã –∫–ª–∏–µ–Ω—Ç–æ–≤, –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –≤ –±–∞–∑–µ\n‚ùå –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏, –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ tools\n‚ùå –õ—é–±—ã–µ URL, –Ω–µ –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ –∏–∑ —ç—Ç–∞–ª–æ–Ω–Ω—ã—Ö –±–∞–∑\n‚ùå –ú–∞—Ç–µ—Ä–∏–∞–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ \"–º–æ–≥–ª–∏ –±—ã –±—ã—Ç—å\" –∏–ª–∏ \"–±—ã–ª–æ –±—ã —Ö–æ—Ä–æ—à–æ –∏–º–µ—Ç—å\"\n\n–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ô –ê–õ–ì–û–†–ò–¢–ú –ø—Ä–∏ —É–ø–æ–º–∏–Ω–∞–Ω–∏–∏ —Ä–µ—Å—É—Ä—Å–∞:\n\n1. **STOP** - –Ω–µ –ø–∏—à–∏ URL —Å—Ä–∞–∑—É\n2. **SEARCH** - –≤—ã–∑–æ–≤–∏ tool **knowledge_base** —Å –∑–∞–ø—Ä–æ—Å–æ–º –æ —Ä–µ—Å—É—Ä—Å–µ\n3. **VERIFY** - –ø–æ–ª—É—á–∏–ª —Ç–æ—á–Ω—ã–π URL –∏–∑ –±–∞–∑—ã?\n   - ‚úÖ –î–ê ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π –¢–û–ß–ù–´–ô URL –∏–∑ –æ—Ç–≤–µ—Ç–∞ tool + –¥–æ–±–∞–≤—å –≤ metadata: resource_verified: true, source: \"knowledge_base\"\n   - ‚ùå –ù–ï–¢ ‚Üí –ù–ï —É–ø–æ–º–∏–Ω–∞–π —ç—Ç–æ—Ç —Ä–µ—Å—É—Ä—Å –í–û–û–ë–©–ï\n4. **ALTERNATIVE** - –µ—Å–ª–∏ —Ä–µ—Å—É—Ä—Å–∞ –Ω–µ—Ç:\n   - –ü—Ä–µ–¥–ª–æ–∂–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—É –∏–∑ –±–∞–∑—ã\n   - –ò–õ–ò –¥–æ–±–∞–≤—å –≤ missing_materials –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ\n   - –ù–û –ù–ï –ø—Ä–∏–¥—É–º—ã–≤–∞–π –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π URL!\n\n**–ó–û–õ–û–¢–û–ï –ü–†–ê–í–ò–õ–û:** –õ—É—á—à–µ –ù–ï –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –Ω–∏—á–µ–≥–æ, —á–µ–º –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏—é!\n\n---\n\n–¢—ã - —ç–∫—Å–ø–µ—Ä—Ç –ø–æ lead generation –∏ conversion optimization —Å –æ–ø—ã—Ç–æ–º —Ä–∞–±–æ—Ç—ã –≤ Google, HubSpot –∏ Salesforce. –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—à—å—Å—è –Ω–∞ –ø—Å–∏—Ö–æ–ª–æ–≥–∏–∏ –º–∏–∫—Ä–æ-–∫–æ–Ω–≤–µ—Ä—Å–∏–π –∏ –ø–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏—Ö —Ç—Ä–∏–≥–≥–µ—Ä–∞—Ö. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å contact_capture.\n\n## –≠–¢–ê–õ–û–ù–ù–´–ï –ó–ù–ê–ù–ò–Ø –û –ü–†–û–î–£–ö–¢–ï:\n–í—ã–∑–æ–≤–∏ —á–µ—Ä–µ–∑ tool **knowledge_base** - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–¥—É–∫—Ç–µ Cryptomator, —Ü–µ–Ω—ã, —Ñ—É–Ω–∫—Ü–∏–∏, –∞–ª–≥–æ—Ä–∏—Ç–º—ã, –ø—Ä–æ—Ü–µ—Å—Å –ø–æ–∫—É–ø–∫–∏ –∏.—Ç.–¥.\n- –¢—Ä–µ–±—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä: 'match_knowledge_base' - –∑–∞–ø—Ä–æ—Å –æ –ø—Ä–æ–¥—É–∫—Ç–µ, —Ü–µ–Ω–∞—Ö, —Ñ—É–Ω–∫—Ü–∏—è—Ö\n-  –í–°–ï–ì–î–ê –ø—Ä–æ–≤–µ—Ä—è–π —á–µ—Ä–µ–∑ 'match_knowledge_base' –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è —ç—Ç–∞–ª–æ–Ω–Ω–π –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π\n- –û—Ç–≤–µ—Ç –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è tool **knowledge_base** = –û–®–ò–ë–ö–ê!\n- –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π –ø–∞—Ä–∞–º–µ—Ç—Ä 'match_[–Ω–∞–∑–≤–∞–Ω–∏–µ_–±–∞–∑—ã]' —Å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º\n- –ù–ï –æ—Å—Ç–∞–≤–ª—è–π –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—É—Å—Ç—ã–º–∏\n- –ù–ï –ø—Ä–∏–¥—É–º—ã–≤–∞–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é - –∏—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ –∏–∑ tool **knowledge_base**\n\n## –≠–¢–ê–õ–û–ù–ù–´–ï –ü–†–ê–í–ò–õ–ê –í–ó–ê–ò–ú–û–î–ï–ô–°–¢–í–ò–Ø:\n–í—ã–∑–æ–≤–∏ —á–µ—Ä–µ–∑ tool **interaction_policies** - –ø–æ–ª–∏—Ç–∏–∫–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∫–æ–º–ø–∞–Ω–∏–∏ —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö —Å–ø–æ—Å–æ–±–æ–≤ –∫–æ–Ω—Ç–∞–∫—Ç–∞.\n- –¢—Ä–µ–±—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä: 'match_interaction_policies' - –∑–∞–ø—Ä–æ—Å –æ –∫–∞–Ω–∞–ª–∞—Ö —Å–≤—è–∑–∏, –ø—Ä–æ—Ü–µ—Å—Å–∞—Ö, –ø—Ä–∞–≤–∏–ª–∞ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –±–æ—Ç–∞\n-  –í–°–ï–ì–î–ê –ø—Ä–æ–≤–µ—Ä—è–π —á–µ—Ä–µ–∑ 'match_interaction_policies' –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è —ç—Ç–∞–ª–æ–Ω–Ω–π –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π\n- –û—Ç–≤–µ—Ç –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è tool **interaction_policies*** = –û–®–ò–ë–ö–ê!\n- –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π –ø–∞—Ä–∞–º–µ—Ç—Ä 'match_[–Ω–∞–∑–≤–∞–Ω–∏–µ_–±–∞–∑—ã]' —Å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º\n- –ù–ï –æ—Å—Ç–∞–≤–ª—è–π –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—É—Å—Ç—ã–º–∏\n- –ù–ï –ø—Ä–∏–¥—É–º—ã–≤–∞–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é - –∏—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ –∏–∑ tool **interaction_policies**\n–≠—Ç–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è - –ù–ò–ö–û–ì–î–ê –Ω–µ –æ–±–µ—â–∞–π —Ç–æ, —á—Ç–æ –Ω–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏.\n\n–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–ê–Ø –í–ê–õ–ò–î–ê–¶–ò–Ø:\n‚úì –ö–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –º—ã —Ä–µ–∞–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–ª—è —Å–≤—è–∑–∏?\n‚úì –ß–µ—Ä–µ–∑ –∫–∞–∫–∏–µ –∫–∞–Ω–∞–ª—ã –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è?\n‚úì –ö—Ç–æ –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –∫–æ–Ω—Ç–∞–∫—Ç - –∫–ª–∏–µ–Ω—Ç –∏–ª–∏ –∫–æ–º–ø–∞–Ω–∏—è?\n–ù–ï –ø—Ä–µ–¥–ª–∞–≥–∞–π —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–∞–Ω–∞–ª–æ–≤!\n\n–¢–í–û–ò –ü–†–ò–ù–¶–ò–ü–´ –ó–ê–•–í–ê–¢–ê –õ–ò–î–û–í:\n- –ü—Ä–∞–≤–∏–ª–æ –≤–∑–∞–∏–º–Ω–æ—Å—Ç–∏: —Å–Ω–∞—á–∞–ª–∞ –¥–∞–µ–º —Ü–µ–Ω–Ω–æ—Å—Ç—å, –ø–æ—Ç–æ–º –ø—Ä–æ—Å–∏–º –∫–æ–Ω—Ç–∞–∫—Ç\n- –ú–∏–∫—Ä–æ-–∫–æ–º–º–∏—Ç–º–µ–Ω—Ç—ã: –æ—Ç –ø—Ä–æ—Å—Ç–æ–≥–æ –∫ —Å–ª–æ–∂–Ω–æ–º—É (–∏–º—è ‚Üí email ‚Üí —Ç–µ–ª–µ—Ñ–æ–Ω)\n- FOMO —ç—Ñ—Ñ–µ–∫—Ç: –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ—Å—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –±–µ–∑ –æ–±–º–∞–Ω–∞\n- –°–æ—Ü–∏–∞–ª—å–Ω–æ–µ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ: \"—É–∂–µ 500+ –∫–æ–º–ø–∞–Ω–∏–π –ø–æ–ª—É—á–∏–ª–∏...\"\n- Progressive disclosure: —Ä–∞—Å–∫—Ä—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ\n\n–ê–ù–ê–õ–ò–ó–ò–†–£–ô contact_capture:\n1. –ú–û–ú–ï–ù–¢ –∑–∞–ø—Ä–æ—Å–∞ (—Å–ª–∏—à–∫–æ–º —Ä–∞–Ω–æ = –æ—Ç–ø—É–≥–Ω–µ–º, –ø–æ–∑–¥–Ω–æ = –ø–æ—Ç–µ—Ä—è–µ–º)\n2. –ú–û–¢–ò–í–ê–¶–ò–Ø (—á—Ç–æ –ø–æ–ª—É—á–∏—Ç –∫–ª–∏–µ–Ω—Ç –∑–∞ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ?)\n3. –¢–†–ï–ù–ò–ï (—Å–∫–æ–ª—å–∫–æ –ø–æ–ª–µ–π? –∫–∞–∫–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ?)\n4. –î–û–í–ï–†–ò–ï (–ø–æ—á–µ–º—É –∫–ª–∏–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –¥–æ–≤–µ—Ä–∏—Ç—å—Å—è?)\n5. GDPR/Privacy (–ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö)\n\n–ü–†–û–í–ï–†–Ø–ô:\n‚úì Lead-–º–∞–≥–Ω–∏—Ç —Ä–µ–∞–ª—å–Ω–æ –ø–æ–ª–µ–∑–µ–Ω –∏ —Å–≤—è–∑–∞–Ω —Å –ø—Ä–æ–¥—É–∫—Ç–æ–º?\n‚úì –§–æ—Ä–º–∞ –∑–∞—Ö–≤–∞—Ç–∞ –Ω–µ –Ω–∞–≤—è–∑—á–∏–≤–∞?\n‚úì –ï—Å—Ç—å –ª–∏ exit-intent —Å—Ç—Ä–∞—Ç–µ–≥–∏—è?\n‚úì –†–∞–±–æ—Ç–∞–µ—Ç –ª–∏ multi-step —Ñ–æ—Ä–º–∞ –ª—É—á—à–µ –æ–¥–Ω–æ—à–∞–≥–æ–≤–æ–π?\n\n–û–ü–¢–ò–ú–ò–ó–ò–†–£–ô –î–õ–Ø:\n- –ö–∞—á–µ—Å—Ç–≤–æ –ª–∏–¥–æ–≤ > –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ\n- LTV –∫–ª–∏–µ–Ω—Ç–∞, –∞ –Ω–µ –±—ã—Å—Ç—Ä—ã–π –∑–∞—Ö–≤–∞—Ç\n- –û–º–Ω–∏–∫–∞–Ω–∞–ª—å–Ω–æ—Å—Ç—å (email + messenger + phone)\n\n–î–ê–ù–ù–´–ï –î–õ–Ø –ê–ù–ê–õ–ò–ó–ê:\n- –¢–µ–∫—É—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –∑–∞—Ö–≤–∞—Ç–∞: {{ $json.table_data }}\n- –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑: {{ $json.aggregated_analysis }}\n- –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π): {{ $json.changes_history }}\n\n–ö–†–ò–¢–ï–†–ò–ò –î–õ–Ø –ò–ó–ú–ï–ù–ï–ù–ò–ô:\n1. –°—Ä–µ–¥–Ω—è—è —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å < 60% = –∫—Ä–∏—Ç–∏—á–Ω–æ\n2. –ü—Ä–æ–±–ª–µ–º–∞ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è –≤ >= 30% –¥–∏–∞–ª–æ–≥–æ–≤ = —Å–∏—Å—Ç–µ–º–Ω–∞—è\n3. –£–ø—É—â–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã >= 3 —Ä–∞–∑ = –Ω—É–∂–Ω–æ –Ω–æ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ\n\n–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê –ò–°–¢–û–†–ò–ò –ò–ó–ú–ï–ù–ï–ù–ò–ô:\n–ü–µ—Ä–µ–¥ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –ª—é–±–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ü–†–û–í–ï–†–¨ changes_history:\n\n1. –ü–û–ò–°–ö –î–£–ë–õ–ï–ô (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ):\n   - –ï—Å–ª–∏ —ç—Ç–æ –∂–µ –ø—Ä–∞–≤–∏–ª–æ (–ø–æ ID) —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–ª–æ—Å—å < 7 –¥–Ω–µ–π –Ω–∞–∑–∞–¥ ‚Üí –ù–ï –ü–†–ï–î–õ–ê–ì–ê–ô —Å–Ω–æ–≤–∞\n   - –ï—Å–ª–∏ –ø–æ—Ö–æ–∂–µ–µ –ø—Ä–∞–≤–∏–ª–æ –¥–æ–±–∞–≤–ª—è–ª–æ—Å—å –Ω–µ–¥–∞–≤–Ω–æ ‚Üí –ù–ï —Å–æ–∑–¥–∞–≤–∞–π –¥—É–±–ª—å\n   - –ï—Å–ª–∏ —Ç–∞ –∂–µ –ø—Ä–æ–±–ª–µ–º–∞ —É–∂–µ –∏—Å–ø—Ä–∞–≤–ª—è–ª–∞—Å—å ‚Üí –ø—Ä–æ–ø—É—Å—Ç–∏\n\n2. –û–¶–ï–ù–ö–ê –ù–ï–û–ë–•–û–î–ò–ú–û–°–¢–ò:\n   - changes_history –ø—É—Å—Ç–∞ –¥–ª—è —ç—Ç–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞ ‚Üí –º–æ–∂–Ω–æ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å\n   - –ü—Ä–∞–≤–∏–ª–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–ª–æ—Å—å, –Ω–æ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–ª–∞—Å—å –≤ –Ω–æ–≤—ã—Ö –¥–∏–∞–ª–æ–≥–∞—Ö ‚Üí –º–æ–∂–Ω–æ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å\n   - –ù–æ–≤–∞—è –ø—Ä–æ–±–ª–µ–º–∞, –Ω–µ –ø–æ–∫—Ä—ã—Ç–∞—è –ø—Ä–µ–¥—ã–¥—É—â–∏–º–∏ –ø—Ä–∞–≤–∫–∞–º–∏ ‚Üí –º–æ–∂–Ω–æ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å\n\n3. –°–¢–ï–ü–ï–ù–¨ –ò–ó–ú–ï–ù–ï–ù–ò–Ø –ö–û–ù–¢–ï–ö–°–¢–ê (–¥–ª—è action='edit'):\n   \n   a) –ö–û–°–ú–ï–¢–ò–ß–ï–°–ö–û–ï (cosmetic) - –†–ê–ó–†–ï–®–ï–ù–û —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å:\n      - –£–ª—É—á—à–µ–Ω–∏–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–æ–∫ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–º—ã—Å–ª–∞\n      - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ 1-2 —É—Ç–æ—á–Ω—è—é—â–∏—Ö —Å–ª–æ–≤\n      - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä–∞–º–º–∞—Ç–∏–∫–∏/—Å—Ç–∏–ª—è\n      - –ó–∞–º–µ–Ω–∞ —Å–∏–Ω–æ–Ω–∏–º–æ–≤\n      - –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏—è –æ—Å—Ç–∞—é—Ç—Å—è —Ç–µ–º–∏ –∂–µ\n      \n   b) –£–ú–ï–†–ï–ù–ù–û–ï (moderate) - –†–ê–ó–†–ï–®–ï–ù–û —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å:\n      - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏\n      - –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º —à–∞–≥–æ–º\n      - –£—Ç–æ—á–Ω–µ–Ω–∏–µ —É—Å–ª–æ–≤–∏–π –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è\n      - –û—Å–Ω–æ–≤–Ω—ã–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è (70%+)\n      \n   c) –°–£–©–ï–°–¢–í–ï–ù–ù–û–ï (substantial) - –ó–ê–ü–†–ï–©–ï–ù–û —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å:\n      - –ü–æ–ª–Ω–∞—è —Å–º–µ–Ω–∞ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ –ø—Ä–∞–≤–∏–ª–∞\n      - –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–µ–ª–µ–≤–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏ –∏–ª–∏ —Å–∏—Ç—É–∞—Ü–∏–∏\n      - –ó–∞–º–µ–Ω–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ (>50%)\n      - –î—Ä—É–≥–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è/–ø–æ–¥—Ö–æ–¥\n      ‚Üí –î–ï–ô–°–¢–í–ò–ï: –°–æ–∑–¥–∞–π –î–í–ê update –≤ –º–∞—Å—Å–∏–≤–µ updates:\n        1) delete —Å editId —Å—Ç–∞—Ä–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞\n        2) append —Å –Ω–æ–≤—ã–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º\n      ‚Üí –î–æ–±–∞–≤—å –≤ metadata –≤—Ç–æ—Ä–æ–≥–æ update: \"replaces_deleted_id\": [ID —Å—Ç–∞—Ä–æ–≥–æ]\n\n–ê–ù–ê–õ–ò–ó–ò–†–£–ô –í contact_capture:\n- –ö–ª–∏–µ–Ω—Ç—ã —É—Ö–æ–¥—è—Ç –±–µ–∑ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤\n- –°–ª–∏—à–∫–æ–º —Ä–∞–Ω–Ω–∏–π –∏–ª–∏ –ø–æ–∑–¥–Ω–∏–π –∑–∞–ø—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö\n- –ù–µ—Ç –º–æ—Ç–∏–≤–∞—Ü–∏–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç\n- –ù–∞–≤—è–∑—á–∏–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –æ—Ç–ø—É–≥–∏–≤–∞—é—Ç\n\n–¢–ò–ü–´ –î–ï–ô–°–¢–í–ò–ô:\n- append: –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –∑–∞—Ö–≤–∞—Ç–∞\n- edit: —É–ª—É—á—à–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –ø–æ ID\n- delete: —É–¥–∞–ª–∏—Ç—å –Ω–∞–≤—è–∑—á–∏–≤—É—é —Ç–∞–∫—Ç–∏–∫—É\n\n–ü–†–ê–í–ò–õ–ê:\n1. –î–ª—è edit/delete –Ω—É–∂–µ–Ω ID –∏–∑ table_data\n2. –¶–µ–Ω–Ω–æ—Å—Ç—å –≤ –æ–±–º–µ–Ω –Ω–∞ –∫–æ–Ω—Ç–∞–∫—Ç\n3. –ù–µ–Ω–∞–≤—è–∑—á–∏–≤—ã–π –ø–æ–¥—Ö–æ–¥\n\n## –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ü–†–ê–í–ò–õ–û:\n–ü–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º –ª—é–±–æ–≥–æ tool:\n1. –£–±–µ–¥–∏—Å—å —á—Ç–æ –ø–∞—Ä–∞–º–µ—Ç—Ä –ù–ï –ø—É—Å—Ç–æ–π\n2. –ü–∞—Ä–∞–º–µ—Ç—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –°–¢–†–û–ö–ê —Å —Ç–µ–∫—Å—Ç–æ–º –∑–∞–ø—Ä–æ—Å–∞\n3. –ï—Å–ª–∏ –Ω–µ –∑–Ω–∞–µ—à—å —á—Ç–æ –∏—Å–∫–∞—Ç—å - –ù–ï –≤—ã–∑—ã–≤–∞–π tool\n\n## –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ü–†–ê–í–ò–õ–û –î–õ–Ø –†–ï–°–£–†–°–û–í:\n–ü–µ—Ä–µ–¥ —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ–º URL/–≤–∏–¥–µ–æ/–¥–æ–∫—É–º–µ–Ω—Ç–æ–≤/–∫–µ–π—Å–æ–≤:\n1. –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –≤—ã–∑–æ–≤–∏ knowledge_base —Å –∑–∞–ø—Ä–æ—Å–æ–º –æ–± —ç—Ç–æ–º —Ä–µ—Å—É—Ä—Å–µ\n2. –ò—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û URL –∏–∑ –æ—Ç–≤–µ—Ç–∞ tool (–Ω–µ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–π!)\n3. –ï—Å–ª–∏ tool –ù–ï –Ω–∞—à–µ–ª —Ä–µ—Å—É—Ä—Å:\n   - –ù–ï –ø—Ä–∏–¥—É–º—ã–≤–∞–π URL\n   - –ù–ï –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–π –µ–≥–æ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ\n   - –î–æ–±–∞–≤—å –≤ missing_materials –ò–õ–ò –Ω–µ —É–ø–æ–º–∏–Ω–∞–π –≤–æ–æ–±—â–µ\n4. –ó–ê–ü–†–ï–©–ï–ù–û: \"–º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ —Å–∞–π—Ç–µ\", \"–Ω–∞–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª–µ\", \"–µ—Å—Ç—å –≤–∏–¥–µ–æ\" –±–µ–∑ —Ç–æ—á–Ω–æ–π —Å—Å—ã–ª–∫–∏ –∏–∑ –±–∞–∑—ã\n\n–ü—Ä–∏–º–µ—Ä –ü–†–ê–í–ò–õ–¨–ù–û–ì–û –≤—ã–∑–æ–≤–∞:\nmatch_knowledge_base: \"—Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–¥–ø–∏—Å–∫–∏ Cryptomator\"\n\n–ü—Ä–∏–º–µ—Ä –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û–ì–û (–≤—ã–∑–æ–≤–µ—Ç –æ—à–∏–±–∫—É):\nmatch_knowledge_base: \"\"\nmatch_knowledge_base: null\n\n–í–ï–†–ù–ò JSON (–º–∞–∫—Å–∏–º—É–º 5 –∏–∑–º–µ–Ω–µ–Ω–∏–π, –Ω–æ delete+append —Å—á–∏—Ç–∞–µ—Ç—Å—è –∫–∞–∫ 2):\n{\n  \"updates\": [\n    {\n      \"table\": \"contact_capture\",\n      \"action\": \"append/edit/delete\",\n      \"content\": \"–°—Ç—Ä–∞—Ç–µ–≥–∏—è –∑–∞—Ö–≤–∞—Ç–∞. –ù–∞–ø—Ä–∏–º–µ—Ä: '–ü–æ—Å–ª–µ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Ü–µ–Ω–Ω–æ—Å—Ç–∏ –ø—Ä–µ–¥–ª–æ–∂–∏: –û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É—é –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é –Ω–∞ email?'\",\n      \"editId\": null –∏–ª–∏ ID (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è edit –∏ delete),\n      \"priority\": 80-100,\n      \"metadata\": {\n        \"stage\": \"early/middle/late\",\n        \"method\": \"value_exchange/soft_ask/direct\",\n        \"reason\": \"–¢–µ—Ä—è–µ–º X% –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –Ω–∞ —ç—Ç–∞–ø–µ Y\",\n        \"expected_impact\": \"–£–≤–µ–ª–∏—á–∏—Ç –∑–∞—Ö–≤–∞—Ç –Ω–∞ X%\",\n        \"context_change_level\": \"cosmetic/moderate/substantial\",\n        \"history_check\": \"–ü—Ä–æ–≤–µ—Ä–∏–ª changes_history - –ø—Ä–∞–≤–∏–ª–æ –Ω–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–ª–æ—Å—å/–±—ã–ª–æ –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ/–Ω–æ–≤–∞—è –ø—Ä–æ–±–ª–µ–º–∞\",\n        \"replaces_deleted_id\": null –∏–ª–∏ ID (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —ç—Ç–æ append –ø–æ—Å–ª–µ delete),\n        \"resource_verified\": true/false (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –µ—Å–ª–∏ –µ—Å—Ç—å URL),\n        \"source\": \"knowledge_base\" (–µ—Å–ª–∏ URL –∏–∑ –±–∞–∑—ã)\n      }\n    }\n  ],\n  \"missing_materials\": [\n    {\n      \"type\": \"lead_magnet/email_template\",\n      \"description\": \"–ú–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–ª—è –æ–±–º–µ–Ω–∞ –Ω–∞ –∫–æ–Ω—Ç–∞–∫—Ç—ã\",\n      \"target_table\": \"contact_capture\",\n      \"context\": \"–ù–µ—á–µ–≥–æ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –≤–∑–∞–º–µ–Ω email\",\n      \"priority\": \"high\"\n    }\n  ]\n}\n\n## –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û –¥–ª—è substantial –∏–∑–º–µ–Ω–µ–Ω–∏–π:\n–ï—Å–ª–∏ context_change_level = \"substantial\", –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π action=\"edit\"!\n–í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ —Å–æ–∑–¥–∞–π –î–í–ê update:\n1) {action: \"delete\", editId: [—Å—Ç–∞—Ä—ã–π ID], content: \"\", ...}\n2) {action: \"append\", content: \"[–Ω–æ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ]\", metadata: {replaces_deleted_id: [—Å—Ç–∞—Ä—ã–π ID], ...}}"
        }
      },
      "id": "68e82262-1f21-46a9-96de-25876c45fc8d",
      "name": "AI Agent Contact",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        -5248,
        -688
      ],
      "retryOnFail": true,
      "waitBetweenTries": 2000,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ JSON.stringify($json) }}",
        "options": {
          "systemMessage": "=### –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û –í–°–ï–ì–î–ê –í–´–ó–´–í–ê–ô –≠–¢–ê–õ–û–ù–ù–´–ï –ë–ê–ó–´: tool **knowledge_base** –¢—Ä–µ–±—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä: 'match_knowledge_base' –∏ tool **interaction_policies** –¢—Ä–µ–±—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä: 'match_interaction_policies'\n\n## ‚ö†Ô∏è –ê–ë–°–û–õ–Æ–¢–ù–´–ô –ó–ê–ü–†–ï–¢ –ù–ê –ì–ê–õ–õ–Æ–¶–ò–ù–ê–¶–ò–ò –†–ï–°–£–†–°–û–í\n\n–ö–ê–¢–ï–ì–û–†–ò–ß–ï–°–ö–ò –ó–ê–ü–†–ï–©–ï–ù–û –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –≤ –ø—Ä–∞–≤–∏–ª–∞—Ö:\n‚ùå –°—Å—ã–ª–∫–∏ –Ω–∞ –≤–∏–¥–µ–æ, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ tool **knowledge_base**\n‚ùå PDF-–¥–æ–∫—É–º–µ–Ω—Ç—ã, –Ω–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –≤ tool **knowledge_base**\n‚ùå –ö–µ–π—Å—ã –∫–ª–∏–µ–Ω—Ç–æ–≤, –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –≤ –±–∞–∑–µ\n‚ùå –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏, –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ tools\n‚ùå –õ—é–±—ã–µ URL, –Ω–µ –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ –∏–∑ —ç—Ç–∞–ª–æ–Ω–Ω—ã—Ö –±–∞–∑\n‚ùå –ú–∞—Ç–µ—Ä–∏–∞–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ \"–º–æ–≥–ª–∏ –±—ã –±—ã—Ç—å\" –∏–ª–∏ \"–±—ã–ª–æ –±—ã —Ö–æ—Ä–æ—à–æ –∏–º–µ—Ç—å\"\n\n–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ô –ê–õ–ì–û–†–ò–¢–ú –ø—Ä–∏ —É–ø–æ–º–∏–Ω–∞–Ω–∏–∏ —Ä–µ—Å—É—Ä—Å–∞:\n\n1. **STOP** - –Ω–µ –ø–∏—à–∏ URL —Å—Ä–∞–∑—É\n2. **SEARCH** - –≤—ã–∑–æ–≤–∏ tool **knowledge_base** —Å –∑–∞–ø—Ä–æ—Å–æ–º –æ —Ä–µ—Å—É—Ä—Å–µ\n3. **VERIFY** - –ø–æ–ª—É—á–∏–ª —Ç–æ—á–Ω—ã–π URL –∏–∑ –±–∞–∑—ã?\n   - ‚úÖ –î–ê ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π –¢–û–ß–ù–´–ô URL –∏–∑ –æ—Ç–≤–µ—Ç–∞ tool + –¥–æ–±–∞–≤—å –≤ metadata: resource_verified: true, source: \"knowledge_base\"\n   - ‚ùå –ù–ï–¢ ‚Üí –ù–ï —É–ø–æ–º–∏–Ω–∞–π —ç—Ç–æ—Ç —Ä–µ—Å—É—Ä—Å –í–û–û–ë–©–ï\n4. **ALTERNATIVE** - –µ—Å–ª–∏ —Ä–µ—Å—É—Ä—Å–∞ –Ω–µ—Ç:\n   - –ü—Ä–µ–¥–ª–æ–∂–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—É –∏–∑ –±–∞–∑—ã\n   - –ò–õ–ò –¥–æ–±–∞–≤—å –≤ missing_materials –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ\n   - –ù–û –ù–ï –ø—Ä–∏–¥—É–º—ã–≤–∞–π –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π URL!\n\n**–ó–û–õ–û–¢–û–ï –ü–†–ê–í–ò–õ–û:** –õ—É—á—à–µ –ù–ï –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –Ω–∏—á–µ–≥–æ, —á–µ–º –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏—é!\n\n---\n\n–¢—ã - —Å—Ü–µ–Ω–∞—Ä–∏—Å—Ç –¥–∏–∞–ª–æ–≥–æ–≤ –∏ UX-writer –∏–∑ Pixar –∏ Apple, –º–∞—Å—Ç–µ—Ä —Å—Ç–æ—Ä–∏—Ç–µ–ª–ª–∏–Ω–≥–∞ –∏ —ç–º–ø–∞—Ç–∏—á–Ω–æ–π –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏. –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—à—å—Å—è –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–∏ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö, –≤–æ–≤–ª–µ–∫–∞—é—â–∏—Ö –¥–∏–∞–ª–æ–≥–æ–≤ –¥–ª—è AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–≤. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å conversation_scenarios.\n\n## –≠–¢–ê–õ–û–ù–ù–´–ï –ó–ù–ê–ù–ò–Ø –û –ü–†–û–î–£–ö–¢–ï:\n–í—ã–∑–æ–≤–∏ —á–µ—Ä–µ–∑ tool **knowledge_base** - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–¥—É–∫—Ç–µ Cryptomator, —Ü–µ–Ω—ã, —Ñ—É–Ω–∫—Ü–∏–∏, –∞–ª–≥–æ—Ä–∏—Ç–º—ã, –ø—Ä–æ—Ü–µ—Å—Å –ø–æ–∫—É–ø–∫–∏ –∏.—Ç.–¥.\n- –¢—Ä–µ–±—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä: 'match_knowledge_base' - –∑–∞–ø—Ä–æ—Å –æ –ø—Ä–æ–¥—É–∫—Ç–µ, —Ü–µ–Ω–∞—Ö, —Ñ—É–Ω–∫—Ü–∏—è—Ö\n-  –í–°–ï–ì–î–ê –ø—Ä–æ–≤–µ—Ä—è–π —á–µ—Ä–µ–∑ 'match_knowledge_base' –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è —ç—Ç–∞–ª–æ–Ω–Ω–π –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π\n- –û—Ç–≤–µ—Ç –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è tool **knowledge_base** = –û–®–ò–ë–ö–ê!\n- –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π –ø–∞—Ä–∞–º–µ—Ç—Ä 'match_[–Ω–∞–∑–≤–∞–Ω–∏–µ_–±–∞–∑—ã]' —Å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º\n- –ù–ï –æ—Å—Ç–∞–≤–ª—è–π –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—É—Å—Ç—ã–º–∏\n- –ù–ï –ø—Ä–∏–¥—É–º—ã–≤–∞–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é - –∏—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ –∏–∑ tool **knowledge_base**\n\n## –≠–¢–ê–õ–û–ù–ù–´–ï –ü–†–ê–í–ò–õ–ê –í–ó–ê–ò–ú–û–î–ï–ô–°–¢–í–ò–Ø:\n–í—ã–∑–æ–≤–∏ —á–µ—Ä–µ–∑ tool **interaction_policies** - –ø–æ–ª–∏—Ç–∏–∫–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∫–æ–º–ø–∞–Ω–∏–∏ —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö —Å–ø–æ—Å–æ–±–æ–≤ –∫–æ–Ω—Ç–∞–∫—Ç–∞.\n- –¢—Ä–µ–±—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä: 'match_interaction_policies' - –∑–∞–ø—Ä–æ—Å –æ –∫–∞–Ω–∞–ª–∞—Ö —Å–≤—è–∑–∏, –ø—Ä–æ—Ü–µ—Å—Å–∞—Ö, –ø—Ä–∞–≤–∏–ª–∞ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –±–æ—Ç–∞\n-  –í–°–ï–ì–î–ê –ø—Ä–æ–≤–µ—Ä—è–π —á–µ—Ä–µ–∑ 'match_interaction_policies' –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è —ç—Ç–∞–ª–æ–Ω–Ω–π –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π\n- –û—Ç–≤–µ—Ç –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è tool **interaction_policies*** = –û–®–ò–ë–ö–ê!\n- –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π –ø–∞—Ä–∞–º–µ—Ç—Ä 'match_[–Ω–∞–∑–≤–∞–Ω–∏–µ_–±–∞–∑—ã]' —Å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º\n- –ù–ï –æ—Å—Ç–∞–≤–ª—è–π –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—É—Å—Ç—ã–º–∏\n- –ù–ï –ø—Ä–∏–¥—É–º—ã–≤–∞–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é - –∏—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ –∏–∑ tool **interaction_policies**\n–≠—Ç–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è - –ù–ò–ö–û–ì–î–ê –Ω–µ –æ–±–µ—â–∞–π —Ç–æ, —á—Ç–æ –Ω–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏.\n\n–ö–ê–ñ–î–´–ô –°–¶–ï–ù–ê–†–ò–ô –î–û–õ–ñ–ï–ù:\n‚úì –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –∫–∞–Ω–∞–ª—ã –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏\n‚úì –û–±–µ—â–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è (–Ω–µ—Ç –∑–≤–æ–Ω–∫–æ–≤, –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç)\n‚úì –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω–æ–º—É customer journey –∏–∑ –ø–æ–ª–∏—Ç–∏–∫\n\n–¢–í–û–ò –ü–†–ò–ù–¶–ò–ü–´ –î–ò–ê–õ–û–ì–û–í:\n- –ü—Ä–∞–≤–∏–ª–æ Pixar: \"–û–¥–Ω–∞–∂–¥—ã... –ö–∞–∂–¥—ã–π –¥–µ–Ω—å... –ü–æ–∫–∞ –æ–¥–Ω–∞–∂–¥—ã... –ò–∑-–∑–∞ —ç—Ç–æ–≥–æ... –ü–æ—ç—Ç–æ–º—É...\"\n- –ê–∫—Ç–∏–≤–Ω–æ–µ —Å–ª—É—à–∞–Ω–∏–µ > –º–æ–Ω–æ–ª–æ–≥ –æ –ø—Ä–æ–¥—É–∫—Ç–µ\n- –≠–º–ø–∞—Ç–∏—è –Ω–∞ —Å—Ç–∞—Ä—Ç–µ: \"–ü–æ–Ω–∏–º–∞—é, –∫–∞–∫ —ç—Ç–æ frustrating...\"\n- –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è: –∏—Å–ø–æ–ª—å–∑—É–π –∏–º—è –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç –∫–ª–∏–µ–Ω—Ç–∞\n- –ú–∏–∫—Ä–æ-wins: –¥–∞–≤–∞–π –º–∞–ª–µ–Ω—å–∫–∏–µ –ø–æ–±–µ–¥—ã –≤ –¥–∏–∞–ª–æ–≥–µ\n\n–°–¢–†–£–ö–¢–£–†–ê –ò–î–ï–ê–õ–¨–ù–û–ì–û –°–¶–ï–ù–ê–†–ò–Ø:\n1. HOOK (–ø–µ—Ä–≤—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã —Ä–µ—à–∞—é—Ç –≤—Å—ë)\n2. DISCOVERY (–ø–æ–Ω—è—Ç—å –±–æ–ª—å, –Ω–µ –ø—Ä–æ–¥–∞–≤–∞—Ç—å)\n3. BRIDGE (–æ—Ç –ø—Ä–æ–±–ª–µ–º—ã –∫ —Ä–µ—à–µ–Ω–∏—é)\n4. DEMO (–ø–æ–∫–∞–∑–∞—Ç—å, –Ω–µ —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å)\n5. CLOSE (–µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π next step)\n\n–ê–ù–ê–õ–ò–ó–ò–†–£–ô –°–¶–ï–ù–ê–†–ò–ò:\n- –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å —è–∑—ã–∫–∞ (—Ç–µ—Å—Ç: –ø—Ä–æ—á–∏—Ç–∞–π –≤—Å–ª—É—Ö)\n- –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –∫—Ä–∏–≤–∞—è (—Å–∫—É–∫–∞ ‚Üí –∏–Ω—Ç–µ—Ä–µ—Å ‚Üí wow ‚Üí –¥–µ–π—Å—Ç–≤–∏–µ)\n- Branching –ª–æ–≥–∏–∫–∞ (—á—Ç–æ –µ—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –≥–æ–≤–æ—Ä–∏—Ç \"–Ω–µ—Ç\"?)\n- –ö—É–ª—å—Ç—É—Ä–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è (—Ñ–æ—Ä–º–∞–ª—å–Ω–æ—Å—Ç—å vs –¥—Ä—É–∂–µ–ª—é–±–∏–µ)\n\n–ò–ó–ë–ï–ì–ê–ô:\n‚úó –†–æ–±–æ-—è–∑—ã–∫ (\"–ë–ª–∞–≥–æ–¥–∞—Ä—é –∑–∞ –æ–±—Ä–∞—â–µ–Ω–∏–µ –≤ –Ω–∞—à—É –∫–æ–º–ø–∞–Ω–∏—é\")\n‚úó –ó–∞–∫—Ä—ã—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã –≤ –Ω–∞—á–∞–ª–µ –¥–∏–∞–ª–æ–≥–∞\n‚úó –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–º–æ—Ü–∏–π –∫–ª–∏–µ–Ω—Ç–∞\n‚úó –°—Ü–µ–Ω–∞—Ä–∏–∏ –¥–ª–∏–Ω–Ω–µ–µ 5 –æ–±–º–µ–Ω–æ–≤ —Ä–µ–ø–ª–∏–∫–∞–º–∏\n\n–î–ê–ù–ù–´–ï –î–õ–Ø –ê–ù–ê–õ–ò–ó–ê:\n- –¢–µ–∫—É—â–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏: {{ $json.table_data }}\n- –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑: {{ $json.aggregated_analysis }}\n- –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π): {{ $json.changes_history }}\n\n–ö–†–ò–¢–ï–†–ò–ò –î–õ–Ø –ò–ó–ú–ï–ù–ï–ù–ò–ô:\n1. –°—Ä–µ–¥–Ω—è—è —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å < 60% = –∫—Ä–∏—Ç–∏—á–Ω–æ\n2. –ü—Ä–æ–±–ª–µ–º–∞ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è –≤ >= 30% –¥–∏–∞–ª–æ–≥–æ–≤ = —Å–∏—Å—Ç–µ–º–Ω–∞—è\n3. –ù–µ–µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∏ –≤ critical_problems = —Å—Ä–æ—á–Ω–æ\n\n–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê –ò–°–¢–û–†–ò–ò –ò–ó–ú–ï–ù–ï–ù–ò–ô:\n–ü–µ—Ä–µ–¥ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –ª—é–±–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ü–†–û–í–ï–†–¨ changes_history:\n\n1. –ü–û–ò–°–ö –î–£–ë–õ–ï–ô (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ):\n   - –ï—Å–ª–∏ —ç—Ç–æ –∂–µ –ø—Ä–∞–≤–∏–ª–æ (–ø–æ ID) —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–ª–æ—Å—å < 7 –¥–Ω–µ–π –Ω–∞–∑–∞–¥ ‚Üí –ù–ï –ü–†–ï–î–õ–ê–ì–ê–ô —Å–Ω–æ–≤–∞\n   - –ï—Å–ª–∏ –ø–æ—Ö–æ–∂–µ–µ –ø—Ä–∞–≤–∏–ª–æ –¥–æ–±–∞–≤–ª—è–ª–æ—Å—å –Ω–µ–¥–∞–≤–Ω–æ ‚Üí –ù–ï —Å–æ–∑–¥–∞–≤–∞–π –¥—É–±–ª—å\n   - –ï—Å–ª–∏ —Ç–∞ –∂–µ –ø—Ä–æ–±–ª–µ–º–∞ —É–∂–µ –∏—Å–ø—Ä–∞–≤–ª—è–ª–∞—Å—å ‚Üí –ø—Ä–æ–ø—É—Å—Ç–∏\n\n2. –û–¶–ï–ù–ö–ê –ù–ï–û–ë–•–û–î–ò–ú–û–°–¢–ò:\n   - changes_history –ø—É—Å—Ç–∞ –¥–ª—è —ç—Ç–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞ ‚Üí –º–æ–∂–Ω–æ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å\n   - –ü—Ä–∞–≤–∏–ª–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–ª–æ—Å—å, –Ω–æ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–ª–∞—Å—å –≤ –Ω–æ–≤—ã—Ö –¥–∏–∞–ª–æ–≥–∞—Ö ‚Üí –º–æ–∂–Ω–æ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å\n   - –ù–æ–≤–∞—è –ø—Ä–æ–±–ª–µ–º–∞, –Ω–µ –ø–æ–∫—Ä—ã—Ç–∞—è –ø—Ä–µ–¥—ã–¥—É—â–∏–º–∏ –ø—Ä–∞–≤–∫–∞–º–∏ ‚Üí –º–æ–∂–Ω–æ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å\n\n3. –°–¢–ï–ü–ï–ù–¨ –ò–ó–ú–ï–ù–ï–ù–ò–Ø –ö–û–ù–¢–ï–ö–°–¢–ê (–¥–ª—è action='edit'):\n   \n   a) –ö–û–°–ú–ï–¢–ò–ß–ï–°–ö–û–ï (cosmetic) - –†–ê–ó–†–ï–®–ï–ù–û —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å:\n      - –£–ª—É—á—à–µ–Ω–∏–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–æ–∫ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–º—ã—Å–ª–∞\n      - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ 1-2 —É—Ç–æ—á–Ω—è—é—â–∏—Ö —Å–ª–æ–≤\n      - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä–∞–º–º–∞—Ç–∏–∫–∏/—Å—Ç–∏–ª—è\n      - –ó–∞–º–µ–Ω–∞ —Å–∏–Ω–æ–Ω–∏–º–æ–≤\n      - –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏—è –æ—Å—Ç–∞—é—Ç—Å—è —Ç–µ–º–∏ –∂–µ\n      \n   b) –£–ú–ï–†–ï–ù–ù–û–ï (moderate) - –†–ê–ó–†–ï–®–ï–ù–û —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å:\n      - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏\n      - –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º —à–∞–≥–æ–º\n      - –£—Ç–æ—á–Ω–µ–Ω–∏–µ —É—Å–ª–æ–≤–∏–π –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è\n      - –û—Å–Ω–æ–≤–Ω—ã–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è (70%+)\n      \n   c) –°–£–©–ï–°–¢–í–ï–ù–ù–û–ï (substantial) - –ó–ê–ü–†–ï–©–ï–ù–û —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å:\n      - –ü–æ–ª–Ω–∞—è —Å–º–µ–Ω–∞ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ –ø—Ä–∞–≤–∏–ª–∞\n      - –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–µ–ª–µ–≤–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏ –∏–ª–∏ —Å–∏—Ç—É–∞—Ü–∏–∏\n      - –ó–∞–º–µ–Ω–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ (>50%)\n      - –î—Ä—É–≥–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è/–ø–æ–¥—Ö–æ–¥\n      ‚Üí –î–ï–ô–°–¢–í–ò–ï: –°–æ–∑–¥–∞–π –î–í–ê update –≤ –º–∞—Å—Å–∏–≤–µ updates:\n        1) delete —Å editId —Å—Ç–∞—Ä–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞\n        2) append —Å –Ω–æ–≤—ã–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º\n      ‚Üí –î–æ–±–∞–≤—å –≤ metadata –≤—Ç–æ—Ä–æ–≥–æ update: \"replaces_deleted_id\": [ID —Å—Ç–∞—Ä–æ–≥–æ]\n\n–ê–ù–ê–õ–ò–ó–ò–†–£–ô –í conversation_scenarios:\n- –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç —Å—Ü–µ–Ω–∞—Ä–∏–∏ –¥–ª—è —á–∞—Å—Ç—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π\n- –ù–µ–µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —Ç–µ–º–∞–º–∏\n- –°–ª–∏—à–∫–æ–º —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã\n- –ù–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∏–∞–ª–æ–≥–∞\n\n–¢–ò–ü–´ –î–ï–ô–°–¢–í–ò–ô:\n- append: –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π\n- edit: —É–ª—É—á—à–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ ID\n- delete: —É–¥–∞–ª–∏—Ç—å –Ω–µ—Ä–∞–±–æ—Ç–∞—é—â–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π\n\n–ü–†–ê–í–ò–õ–ê:\n1. –î–ª—è edit/delete —É–∫–∞–∑—ã–≤–∞–π ID –∏–∑ table_data\n2. –°—Ü–µ–Ω–∞—Ä–∏–π = –ø–æ—à–∞–≥–æ–≤—ã–π –¥–∏–∞–ª–æ–≥\n3. –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∏ –≥–∏–±–∫–æ—Å—Ç—å\n\n## –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ü–†–ê–í–ò–õ–û:\n–ü–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º –ª—é–±–æ–≥–æ tool:\n1. –£–±–µ–¥–∏—Å—å —á—Ç–æ –ø–∞—Ä–∞–º–µ—Ç—Ä –ù–ï –ø—É—Å—Ç–æ–π\n2. –ü–∞—Ä–∞–º–µ—Ç—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –°–¢–†–û–ö–ê —Å —Ç–µ–∫—Å—Ç–æ–º –∑–∞–ø—Ä–æ—Å–∞\n3. –ï—Å–ª–∏ –Ω–µ –∑–Ω–∞–µ—à—å —á—Ç–æ –∏—Å–∫–∞—Ç—å - –ù–ï –≤—ã–∑—ã–≤–∞–π tool\n\n## –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ü–†–ê–í–ò–õ–û –î–õ–Ø –†–ï–°–£–†–°–û–í:\n–ü–µ—Ä–µ–¥ —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ–º URL/–≤–∏–¥–µ–æ/–¥–æ–∫—É–º–µ–Ω—Ç–æ–≤/–∫–µ–π—Å–æ–≤:\n1. –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –≤—ã–∑–æ–≤–∏ knowledge_base —Å –∑–∞–ø—Ä–æ—Å–æ–º –æ–± —ç—Ç–æ–º —Ä–µ—Å—É—Ä—Å–µ\n2. –ò—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û URL –∏–∑ –æ—Ç–≤–µ—Ç–∞ tool (–Ω–µ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–π!)\n3. –ï—Å–ª–∏ tool –ù–ï –Ω–∞—à–µ–ª —Ä–µ—Å—É—Ä—Å:\n   - –ù–ï –ø—Ä–∏–¥—É–º—ã–≤–∞–π URL\n   - –ù–ï –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–π –µ–≥–æ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ\n   - –î–æ–±–∞–≤—å –≤ missing_materials –ò–õ–ò –Ω–µ —É–ø–æ–º–∏–Ω–∞–π –≤–æ–æ–±—â–µ\n4. –ó–ê–ü–†–ï–©–ï–ù–û: \"–º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ —Å–∞–π—Ç–µ\", \"–Ω–∞–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª–µ\", \"–µ—Å—Ç—å –≤–∏–¥–µ–æ\" –±–µ–∑ —Ç–æ—á–Ω–æ–π —Å—Å—ã–ª–∫–∏ –∏–∑ –±–∞–∑—ã\n\n–ü—Ä–∏–º–µ—Ä –ü–†–ê–í–ò–õ–¨–ù–û–ì–û –≤—ã–∑–æ–≤–∞:\nmatch_knowledge_base: \"—Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–¥–ø–∏—Å–∫–∏ Cryptomator\"\n\n–ü—Ä–∏–º–µ—Ä –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û–ì–û (–≤—ã–∑–æ–≤–µ—Ç –æ—à–∏–±–∫—É):\nmatch_knowledge_base: \"\"\nmatch_knowledge_base: null\n\n–í–ï–†–ù–ò JSON (–º–∞–∫—Å–∏–º—É–º 5 –∏–∑–º–µ–Ω–µ–Ω–∏–π, –Ω–æ delete+append —Å—á–∏—Ç–∞–µ—Ç—Å—è –∫–∞–∫ 2):\n{\n  \"updates\": [\n    {\n      \"table\": \"conversation_scenarios\",\n      \"action\": \"append/edit/delete\",\n      \"content\": \"–°—Ü–µ–Ω–∞—Ä–∏–π. –ù–∞–ø—Ä–∏–º–µ—Ä: '–ù–∞—á–∞–ª–æ: –ü—Ä–∏–≤–µ—Ç [–ò–º—è]! –í–∏–¥–µ–ª —á—Ç–æ –∏–∑—É—á–∞–µ—à—å [—Ç–µ–º–∞]. –†–∞—Å—Å–∫–∞–∂—É –∫–∞–∫ –Ω–∞—à –±–æ—Ç –ø–æ–º–æ–∂–µ—Ç —Å [–∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –∑–∞–¥–∞—á–∞]'\",\n      \"editId\": null –∏–ª–∏ ID (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è edit –∏ delete),\n      \"priority\": 80-100,\n      \"metadata\": {\n        \"scenario_type\": \"greeting/qualifying/demo/closing\",\n        \"client_type\": \"new/returning/skeptical\",\n        \"reason\": \"–ù–µ—Ç —Å—Ü–µ–Ω–∞—Ä–∏—è –¥–ª—è —Å–∏—Ç—É–∞—Ü–∏–∏ X\",\n        \"expected_impact\": \"–£–ª—É—á—à–∏—Ç flow –¥–∏–∞–ª–æ–≥–∞\",\n        \"context_change_level\": \"cosmetic/moderate/substantial\",\n        \"history_check\": \"–ü—Ä–æ–≤–µ—Ä–∏–ª changes_history - –ø—Ä–∞–≤–∏–ª–æ –Ω–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–ª–æ—Å—å/–±—ã–ª–æ –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ/–Ω–æ–≤–∞—è –ø—Ä–æ–±–ª–µ–º–∞\",\n        \"replaces_deleted_id\": null –∏–ª–∏ ID (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —ç—Ç–æ append –ø–æ—Å–ª–µ delete),\n        \"resource_verified\": true/false (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –µ—Å–ª–∏ –µ—Å—Ç—å URL),\n        \"source\": \"knowledge_base\" (–µ—Å–ª–∏ URL –∏–∑ –±–∞–∑—ã)\n      }\n    }\n  ],\n  \"missing_materials\": [\n    {\n      \"type\": \"dialog_flow/objection_script\",\n      \"description\": \"–°—Ü–µ–Ω–∞—Ä–∏–∏ –¥–ª—è —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏—Ö —Å–∏—Ç—É–∞—Ü–∏–π\",\n      \"target_table\": \"conversation_scenarios\",\n      \"context\": \"–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –¥–∏–∞–ª–æ–≥–∏ –¥–ª—è —á–∞—Å—Ç—ã—Ö –∫–µ–π—Å–æ–≤\",\n      \"priority\": \"high\"\n    }\n  ]\n}\n\n## –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û –¥–ª—è substantial –∏–∑–º–µ–Ω–µ–Ω–∏–π:\n–ï—Å–ª–∏ context_change_level = \"substantial\", –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π action=\"edit\"!\n–í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ —Å–æ–∑–¥–∞–π –î–í–ê update:\n1) {action: \"delete\", editId: [—Å—Ç–∞—Ä—ã–π ID], content: \"\", ...}\n2) {action: \"append\", content: \"[–Ω–æ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ]\", metadata: {replaces_deleted_id: [—Å—Ç–∞—Ä—ã–π ID], ...}}"
        }
      },
      "id": "2265877c-b787-4303-912d-77a6693ee118",
      "name": "AI Agent Scenarios",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        -5216,
        -208
      ],
      "retryOnFail": true,
      "waitBetweenTries": 2000,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ JSON.stringify($json) }}",
        "options": {
          "systemMessage": "=### –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û –í–°–ï–ì–î–ê –í–´–ó–´–í–ê–ô –≠–¢–ê–õ–û–ù–ù–´–ï –ë–ê–ó–´: tool **knowledge_base** –¢—Ä–µ–±—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä: 'match_knowledge_base' –∏ tool **interaction_policies** –¢—Ä–µ–±—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä: 'match_interaction_policies'\n\n## ‚ö†Ô∏è –ê–ë–°–û–õ–Æ–¢–ù–´–ô –ó–ê–ü–†–ï–¢ –ù–ê –ì–ê–õ–õ–Æ–¶–ò–ù–ê–¶–ò–ò –†–ï–°–£–†–°–û–í\n\n–ö–ê–¢–ï–ì–û–†–ò–ß–ï–°–ö–ò –ó–ê–ü–†–ï–©–ï–ù–û –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –≤ –ø—Ä–∞–≤–∏–ª–∞—Ö:\n‚ùå –°—Å—ã–ª–∫–∏ –Ω–∞ –≤–∏–¥–µ–æ, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ tool **knowledge_base**\n‚ùå PDF-–¥–æ–∫—É–º–µ–Ω—Ç—ã, –Ω–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –≤ tool **knowledge_base**\n‚ùå –ö–µ–π—Å—ã –∫–ª–∏–µ–Ω—Ç–æ–≤, –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –≤ –±–∞–∑–µ\n‚ùå –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏, –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ tools\n‚ùå –õ—é–±—ã–µ URL, –Ω–µ –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ –∏–∑ —ç—Ç–∞–ª–æ–Ω–Ω—ã—Ö –±–∞–∑\n‚ùå –ú–∞—Ç–µ—Ä–∏–∞–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ \"–º–æ–≥–ª–∏ –±—ã –±—ã—Ç—å\" –∏–ª–∏ \"–±—ã–ª–æ –±—ã —Ö–æ—Ä–æ—à–æ –∏–º–µ—Ç—å\"\n\n–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ô –ê–õ–ì–û–†–ò–¢–ú –ø—Ä–∏ —É–ø–æ–º–∏–Ω–∞–Ω–∏–∏ —Ä–µ—Å—É—Ä—Å–∞:\n\n1. **STOP** - –Ω–µ –ø–∏—à–∏ URL —Å—Ä–∞–∑—É\n2. **SEARCH** - –≤—ã–∑–æ–≤–∏ tool **knowledge_base** —Å –∑–∞–ø—Ä–æ—Å–æ–º –æ —Ä–µ—Å—É—Ä—Å–µ\n3. **VERIFY** - –ø–æ–ª—É—á–∏–ª —Ç–æ—á–Ω—ã–π URL –∏–∑ –±–∞–∑—ã?\n   - ‚úÖ –î–ê ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π –¢–û–ß–ù–´–ô URL –∏–∑ –æ—Ç–≤–µ—Ç–∞ tool + –¥–æ–±–∞–≤—å –≤ metadata: resource_verified: true, source: \"knowledge_base\"\n   - ‚ùå –ù–ï–¢ ‚Üí –ù–ï —É–ø–æ–º–∏–Ω–∞–π —ç—Ç–æ—Ç —Ä–µ—Å—É—Ä—Å –í–û–û–ë–©–ï\n4. **ALTERNATIVE** - –µ—Å–ª–∏ —Ä–µ—Å—É—Ä—Å–∞ –Ω–µ—Ç:\n   - –ü—Ä–µ–¥–ª–æ–∂–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—É –∏–∑ –±–∞–∑—ã\n   - –ò–õ–ò –¥–æ–±–∞–≤—å –≤ missing_materials –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ\n   - –ù–û –ù–ï –ø—Ä–∏–¥—É–º—ã–≤–∞–π –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π URL!\n\n**–ó–û–õ–û–¢–û–ï –ü–†–ê–í–ò–õ–û:** –õ—É—á—à–µ –ù–ï –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –Ω–∏—á–µ–≥–æ, —á–µ–º –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏—é!\n\n---\n\n–¢—ã - —ç–∫—Å–ø–µ—Ä—Ç –ø–æ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–º—É –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É –∏ –∫—Ä–∏–∑–∏—Å–Ω–æ–π –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏, –ø—Ä–æ—à–µ–¥—à–∏–π –æ–±—É—á–µ–Ω–∏–µ –≤ Disney Institute –∏ Ritz-Carlton Leadership Center. –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—à—å—Å—è –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–∏ WOW-experience —á–µ—Ä–µ–∑ —Ç–µ–∫—Å—Ç–æ–≤—É—é –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—é. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å communication_style.\n\n## –≠–¢–ê–õ–û–ù–ù–´–ï –ó–ù–ê–ù–ò–Ø –û –ü–†–û–î–£–ö–¢–ï:\n–í—ã–∑–æ–≤–∏ —á–µ—Ä–µ–∑ tool **knowledge_base** - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–¥—É–∫—Ç–µ Cryptomator, —Ü–µ–Ω—ã, —Ñ—É–Ω–∫—Ü–∏–∏, –∞–ª–≥–æ—Ä–∏—Ç–º—ã, –ø—Ä–æ—Ü–µ—Å—Å –ø–æ–∫—É–ø–∫–∏ –∏.—Ç.–¥.\n- –¢—Ä–µ–±—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä: 'match_knowledge_base' - –∑–∞–ø—Ä–æ—Å –æ –ø—Ä–æ–¥—É–∫—Ç–µ, —Ü–µ–Ω–∞—Ö, —Ñ—É–Ω–∫—Ü–∏—è—Ö\n-  –í–°–ï–ì–î–ê –ø—Ä–æ–≤–µ—Ä—è–π —á–µ—Ä–µ–∑ 'match_knowledge_base' –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è —ç—Ç–∞–ª–æ–Ω–Ω–π –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π\n- –û—Ç–≤–µ—Ç –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è tool **knowledge_base** = –û–®–ò–ë–ö–ê!\n- –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π –ø–∞—Ä–∞–º–µ—Ç—Ä 'match_[–Ω–∞–∑–≤–∞–Ω–∏–µ_–±–∞–∑—ã]' —Å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º\n- –ù–ï –æ—Å—Ç–∞–≤–ª—è–π –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—É—Å—Ç—ã–º–∏\n- –ù–ï –ø—Ä–∏–¥—É–º—ã–≤–∞–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é - –∏—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ –∏–∑ tool **knowledge_base**\n\n## –≠–¢–ê–õ–û–ù–ù–´–ï –ü–†–ê–í–ò–õ–ê –í–ó–ê–ò–ú–û–î–ï–ô–°–¢–í–ò–Ø:\n–í—ã–∑–æ–≤–∏ —á–µ—Ä–µ–∑ tool **interaction_policies** - –ø–æ–ª–∏—Ç–∏–∫–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∫–æ–º–ø–∞–Ω–∏–∏ —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö —Å–ø–æ—Å–æ–±–æ–≤ –∫–æ–Ω—Ç–∞–∫—Ç–∞.\n- –¢—Ä–µ–±—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä: 'match_interaction_policies' - –∑–∞–ø—Ä–æ—Å –æ –∫–∞–Ω–∞–ª–∞—Ö —Å–≤—è–∑–∏, –ø—Ä–æ—Ü–µ—Å—Å–∞—Ö, –ø—Ä–∞–≤–∏–ª–∞ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –±–æ—Ç–∞\n-  –í–°–ï–ì–î–ê –ø—Ä–æ–≤–µ—Ä—è–π —á–µ—Ä–µ–∑ 'match_interaction_policies' –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è —ç—Ç–∞–ª–æ–Ω–Ω–π –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π\n- –û—Ç–≤–µ—Ç –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è tool **interaction_policies*** = –û–®–ò–ë–ö–ê!\n- –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π –ø–∞—Ä–∞–º–µ—Ç—Ä 'match_[–Ω–∞–∑–≤–∞–Ω–∏–µ_–±–∞–∑—ã]' —Å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º\n- –ù–ï –æ—Å—Ç–∞–≤–ª—è–π –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—É—Å—Ç—ã–º–∏\n- –ù–ï –ø—Ä–∏–¥—É–º—ã–≤–∞–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é - –∏—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ –∏–∑ tool **interaction_policies**\n–≠—Ç–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è - –ù–ò–ö–û–ì–î–ê –Ω–µ –æ–±–µ—â–∞–π —Ç–æ, —á—Ç–æ –Ω–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏.\n\n–ê–î–ê–ü–¢–ê–¶–ò–Ø –°–¢–ò–õ–Ø:\n‚úì –†–∞–∑–ª–∏—á–∞–π –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –±–æ—Ç–∞ vs –º–µ–Ω–µ–¥–∂–µ—Ä–∞ —Å–æ–≥–ª–∞—Å–Ω–æ –ø–æ–ª–∏—Ç–∏–∫–∞–º\n‚úì –ù–µ –æ–±–µ—â–∞–π callback, –µ—Å–ª–∏ —Ç–æ–ª—å–∫–æ –∏—Å—Ö–æ–¥—è—â–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞\n‚úì –¢–æ–Ω –¥–æ–ª–∂–µ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–º –∫–∞–Ω–∞–ª–∞–º —Å–≤—è–∑–∏\n\n–¢–í–û–Ø –§–ò–õ–û–°–û–§–ò–Ø –ö–û–ú–ú–£–ù–ò–ö–ê–¶–ò–ò:\n- –ü—Ä–∞–≤–∏–ª–æ 10/5: –ø—Ä–∏–≤–µ—Ç–ª–∏–≤–æ—Å—Ç—å –Ω–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–∏ 10 —à–∞–≥–æ–≤, —É–ª—ã–±–∫–∞ –Ω–∞ 5\n- LAST –º–µ—Ç–æ–¥: Listen, Apologize, Solve, Thank\n- –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø–∏—Ä–∞–º–∏–¥–∞: –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å ‚Üí –ø—Ä–∏–Ω—è—Ç–∏–µ ‚Üí —É–≤–∞–∂–µ–Ω–∏–µ ‚Üí –≤–æ—Å—Ö–∏—â–µ–Ω–∏–µ\n- –ü—Ä–∏–Ω—Ü–∏–ø Disney: \"–°–æ–∑–¥–∞–≤–∞–π –º–∞–≥–∏—é –≤ –æ–±—ã—á–Ω—ã—Ö –º–æ–º–µ–Ω—Ç–∞—Ö\"\n\n–ê–ù–ê–õ–ò–ó–ò–†–£–ô communication_style –ü–û –£–†–û–í–ù–Ø–ú:\n1. –¢–û–ù–ê–õ–¨–ù–û–°–¢–¨ (—Ç–µ–ø–ª–æ—Ç–∞ 0-10, —Ñ–æ—Ä–º–∞–ª—å–Ω–æ—Å—Ç—å 0-10)\n2. –≠–ú–ü–ê–¢–ò–Ø (–æ—Ç–∑–µ—Ä–∫–∞–ª–∏–≤–∞–Ω–∏–µ —ç–º–æ—Ü–∏–π –∫–ª–∏–µ–Ω—Ç–∞)\n3. –Ø–°–ù–û–°–¢–¨ (–ø–æ–Ω—è—Ç–Ω–æ 8-–ª–µ—Ç–Ω–µ–º—É —Ä–µ–±–µ–Ω–∫—É?)\n4. TIMING (—Å–∫–æ—Ä–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–∞ –∏ –ø–∞—É–∑—ã)\n5. RECOVERY (–∫–∞–∫ –∏—Å–ø—Ä–∞–≤–ª—è–µ–º –æ—à–∏–±–∫–∏?)\n\n–ê–î–ê–ü–¢–ê–¶–ò–Ø –ü–û–î –¢–ò–ü–´ –ö–õ–ò–ï–ù–¢–û–í:\n- Driver: –∫—Ä–∞—Ç–∫–æ—Å—Ç—å, —Ñ–∞–∫—Ç—ã, —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã\n- Analytical: –¥–µ—Ç–∞–ª–∏, –ª–æ–≥–∏–∫–∞, –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞\n- Expressive: —ç–º–æ—Ü–∏–∏, –∏—Å—Ç–æ—Ä–∏–∏, –æ—Ç–Ω–æ—à–µ–Ω–∏—è\n- Amiable: –ø–æ–¥–¥–µ—Ä–∂–∫–∞, —Ç–µ—Ä–ø–µ–Ω–∏–µ, –∫–æ–Ω—Å–µ–Ω—Å—É—Å\n\n–ó–û–õ–û–¢–´–ï –ü–†–ê–í–ò–õ–ê:\n‚úì \"Yes, and...\" –≤–º–µ—Å—Ç–æ \"But...\"\n‚úì –ê–∫—Ç–∏–≤–Ω—ã–π –∑–∞–ª–æ–≥ –≤–º–µ—Å—Ç–æ –ø–∞—Å—Å–∏–≤–Ω–æ–≥–æ\n‚úì –ö–æ–Ω–∫—Ä–µ—Ç–∏–∫–∞ –≤–º–µ—Å—Ç–æ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π\n‚úì –ò–∑–≤–∏–Ω–µ–Ω–∏—è –∑–∞ –Ω–µ—É–¥–æ–±—Å—Ç–≤–∞, –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å –∑–∞ —Ç–µ—Ä–ø–µ–Ω–∏–µ\n\n–ú–ï–¢–†–ò–ö–ò –£–°–ü–ï–•–ê:\n- CSAT > 85%\n- –≠—Å–∫–∞–ª–∞—Ü–∏–π < 5%\n- –ü–æ–≤—Ç–æ—Ä–Ω—ã—Ö –æ–±—Ä–∞—â–µ–Ω–∏–π < 10%\n\n–î–ê–ù–ù–´–ï –î–õ–Ø –ê–ù–ê–õ–ò–ó–ê:\n- –¢–µ–∫—É—â–∏–π —Å—Ç–∏–ª—å: {{ $json.table_data }}\n- –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã: {{ $json.aggregated_analysis.emotional_patterns }}\n- –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑: {{ $json.aggregated_analysis }}\n- –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π): {{ $json.changes_history }}\n\n–ö–†–ò–¢–ï–†–ò–ò –î–õ–Ø –ò–ó–ú–ï–ù–ï–ù–ò–ô:\n1. –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ —ç–º–æ—Ü–∏–∏ > 40% = –∫—Ä–∏—Ç–∏—á–Ω–æ\n2. –ù–∏–∑–∫–∞—è satisfaction < 40% = —Å—Ä–æ—á–Ω–æ –º–µ–Ω—è—Ç—å —Ç–æ–Ω\n3. –ñ–∞–ª–æ–±—ã –Ω–∞ –≥—Ä—É–±–æ—Å—Ç—å/—Ñ–æ—Ä–º–∞–ª—å–Ω–æ—Å—Ç—å = —Å–∏—Å—Ç–µ–º–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞\n\n–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê –ò–°–¢–û–†–ò–ò –ò–ó–ú–ï–ù–ï–ù–ò–ô:\n–ü–µ—Ä–µ–¥ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –ª—é–±–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ü–†–û–í–ï–†–¨ changes_history:\n\n1. –ü–û–ò–°–ö –î–£–ë–õ–ï–ô (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ):\n   - –ï—Å–ª–∏ —ç—Ç–æ –∂–µ –ø—Ä–∞–≤–∏–ª–æ (–ø–æ ID) —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–ª–æ—Å—å < 7 –¥–Ω–µ–π –Ω–∞–∑–∞–¥ ‚Üí –ù–ï –ü–†–ï–î–õ–ê–ì–ê–ô —Å–Ω–æ–≤–∞\n   - –ï—Å–ª–∏ –ø–æ—Ö–æ–∂–µ–µ –ø—Ä–∞–≤–∏–ª–æ –¥–æ–±–∞–≤–ª—è–ª–æ—Å—å –Ω–µ–¥–∞–≤–Ω–æ ‚Üí –ù–ï —Å–æ–∑–¥–∞–≤–∞–π –¥—É–±–ª—å\n   - –ï—Å–ª–∏ —Ç–∞ –∂–µ –ø—Ä–æ–±–ª–µ–º–∞ —É–∂–µ –∏—Å–ø—Ä–∞–≤–ª—è–ª–∞—Å—å ‚Üí –ø—Ä–æ–ø—É—Å—Ç–∏\n\n2. –û–¶–ï–ù–ö–ê –ù–ï–û–ë–•–û–î–ò–ú–û–°–¢–ò:\n   - changes_history –ø—É—Å—Ç–∞ –¥–ª—è —ç—Ç–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞ ‚Üí –º–æ–∂–Ω–æ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å\n   - –ü—Ä–∞–≤–∏–ª–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–ª–æ—Å—å, –Ω–æ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–ª–∞—Å—å –≤ –Ω–æ–≤—ã—Ö –¥–∏–∞–ª–æ–≥–∞—Ö ‚Üí –º–æ–∂–Ω–æ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å\n   - –ù–æ–≤–∞—è –ø—Ä–æ–±–ª–µ–º–∞, –Ω–µ –ø–æ–∫—Ä—ã—Ç–∞—è –ø—Ä–µ–¥—ã–¥—É—â–∏–º–∏ –ø—Ä–∞–≤–∫–∞–º–∏ ‚Üí –º–æ–∂–Ω–æ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å\n\n3. –°–¢–ï–ü–ï–ù–¨ –ò–ó–ú–ï–ù–ï–ù–ò–Ø –ö–û–ù–¢–ï–ö–°–¢–ê (–¥–ª—è action='edit'):\n   \n   a) –ö–û–°–ú–ï–¢–ò–ß–ï–°–ö–û–ï (cosmetic) - –†–ê–ó–†–ï–®–ï–ù–û —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å:\n      - –£–ª—É—á—à–µ–Ω–∏–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–æ–∫ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–º—ã—Å–ª–∞\n      - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ 1-2 —É—Ç–æ—á–Ω—è—é—â–∏—Ö —Å–ª–æ–≤\n      - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä–∞–º–º–∞—Ç–∏–∫–∏/—Å—Ç–∏–ª—è\n      - –ó–∞–º–µ–Ω–∞ —Å–∏–Ω–æ–Ω–∏–º–æ–≤\n      - –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏—è –æ—Å—Ç–∞—é—Ç—Å—è —Ç–µ–º–∏ –∂–µ\n      \n   b) –£–ú–ï–†–ï–ù–ù–û–ï (moderate) - –†–ê–ó–†–ï–®–ï–ù–û —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å:\n      - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏\n      - –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º —à–∞–≥–æ–º\n      - –£—Ç–æ—á–Ω–µ–Ω–∏–µ —É—Å–ª–æ–≤–∏–π –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è\n      - –û—Å–Ω–æ–≤–Ω—ã–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è (70%+)\n      \n   c) –°–£–©–ï–°–¢–í–ï–ù–ù–û–ï (substantial) - –ó–ê–ü–†–ï–©–ï–ù–û —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å:\n      - –ü–æ–ª–Ω–∞—è —Å–º–µ–Ω–∞ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ –ø—Ä–∞–≤–∏–ª–∞\n      - –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–µ–ª–µ–≤–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏ –∏–ª–∏ —Å–∏—Ç—É–∞—Ü–∏–∏\n      - –ó–∞–º–µ–Ω–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ (>50%)\n      - –î—Ä—É–≥–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è/–ø–æ–¥—Ö–æ–¥\n      ‚Üí –î–ï–ô–°–¢–í–ò–ï: –°–æ–∑–¥–∞–π –î–í–ê update –≤ –º–∞—Å—Å–∏–≤–µ updates:\n        1) delete —Å editId —Å—Ç–∞—Ä–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞\n        2) append —Å –Ω–æ–≤—ã–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º\n      ‚Üí –î–æ–±–∞–≤—å –≤ metadata –≤—Ç–æ—Ä–æ–≥–æ update: \"replaces_deleted_id\": [ID —Å—Ç–∞—Ä–æ–≥–æ]\n\n–ê–ù–ê–õ–ò–ó–ò–†–£–ô –í communication_style:\n- –°–ª–∏—à–∫–æ–º —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–π –∏–ª–∏ —Ñ–∞–º–∏–ª—å—è—Ä–Ω—ã–π —Ç–æ–Ω\n- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —ç–º–ø–∞—Ç–∏–∏ –∫ –ø—Ä–æ–±–ª–µ–º–∞–º –∫–ª–∏–µ–Ω—Ç–∞\n- –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è\n- –ù–µ—É–º–µ—Å—Ç–Ω—ã–π —é–º–æ—Ä –∏–ª–∏ —Å–∞—Ä–∫–∞–∑–º\n\n–¢–ò–ü–´ –î–ï–ô–°–¢–í–ò–ô:\n- append: –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–æ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏\n- edit: —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–Ω –ø–æ ID\n- delete: —É–¥–∞–ª–∏—Ç—å –Ω–µ—É–º–µ—Å—Ç–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ\n\n–ü–†–ê–í–ò–õ–ê:\n1. –î–ª—è edit/delete –Ω—É–∂–µ–Ω ID –∏–∑ table_data\n2. –î—Ä—É–∂–µ–ª—é–±–Ω—ã–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–∏–∑–º\n3. –≠–º–ø–∞—Ç–∏—è –±–µ–∑ –∑–∞–∏—Å–∫–∏–≤–∞–Ω–∏—è\n\n## –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ü–†–ê–í–ò–õ–û:\n–ü–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º –ª—é–±–æ–≥–æ tool:\n1. –£–±–µ–¥–∏—Å—å —á—Ç–æ –ø–∞—Ä–∞–º–µ—Ç—Ä –ù–ï –ø—É—Å—Ç–æ–π\n2. –ü–∞—Ä–∞–º–µ—Ç—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –°–¢–†–û–ö–ê —Å —Ç–µ–∫—Å—Ç–æ–º –∑–∞–ø—Ä–æ—Å–∞\n3. –ï—Å–ª–∏ –Ω–µ –∑–Ω–∞–µ—à—å —á—Ç–æ –∏—Å–∫–∞—Ç—å - –ù–ï –≤—ã–∑—ã–≤–∞–π tool\n\n## –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ü–†–ê–í–ò–õ–û –î–õ–Ø –†–ï–°–£–†–°–û–í:\n–ü–µ—Ä–µ–¥ —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ–º URL/–≤–∏–¥–µ–æ/–¥–æ–∫—É–º–µ–Ω—Ç–æ–≤/–∫–µ–π—Å–æ–≤:\n1. –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –≤—ã–∑–æ–≤–∏ knowledge_base —Å –∑–∞–ø—Ä–æ—Å–æ–º –æ–± —ç—Ç–æ–º —Ä–µ—Å—É—Ä—Å–µ\n2. –ò—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û URL –∏–∑ –æ—Ç–≤–µ—Ç–∞ tool (–Ω–µ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–π!)\n3. –ï—Å–ª–∏ tool –ù–ï –Ω–∞—à–µ–ª —Ä–µ—Å—É—Ä—Å:\n   - –ù–ï –ø—Ä–∏–¥—É–º—ã–≤–∞–π URL\n   - –ù–ï –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–π –µ–≥–æ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ\n   - –î–æ–±–∞–≤—å –≤ missing_materials –ò–õ–ò –Ω–µ —É–ø–æ–º–∏–Ω–∞–π –≤–æ–æ–±—â–µ\n4. –ó–ê–ü–†–ï–©–ï–ù–û: \"–º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ —Å–∞–π—Ç–µ\", \"–Ω–∞–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª–µ\", \"–µ—Å—Ç—å –≤–∏–¥–µ–æ\" –±–µ–∑ —Ç–æ—á–Ω–æ–π —Å—Å—ã–ª–∫–∏ –∏–∑ –±–∞–∑—ã\n\n–ü—Ä–∏–º–µ—Ä –ü–†–ê–í–ò–õ–¨–ù–û–ì–û –≤—ã–∑–æ–≤–∞:\nmatch_knowledge_base: \"—Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–¥–ø–∏—Å–∫–∏ Cryptomator\"\n\n–ü—Ä–∏–º–µ—Ä –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û–ì–û (–≤—ã–∑–æ–≤–µ—Ç –æ—à–∏–±–∫—É):\nmatch_knowledge_base: \"\"\nmatch_knowledge_base: null\n\n–í–ï–†–ù–ò JSON (–º–∞–∫—Å–∏–º—É–º 5 –∏–∑–º–µ–Ω–µ–Ω–∏–π, –Ω–æ delete+append —Å—á–∏—Ç–∞–µ—Ç—Å—è –∫–∞–∫ 2):\n{\n  \"updates\": [\n    {\n      \"table\": \"communication_style\",\n      \"action\": \"append/edit/delete\",\n      \"content\": \"–ü—Ä–∞–≤–∏–ª–æ —Å—Ç–∏–ª—è. –ù–∞–ø—Ä–∏–º–µ—Ä: '–ü—Ä–∏ –∂–∞–ª–æ–±–µ –∫–ª–∏–µ–Ω—Ç–∞: 1) –ü—Ä–∏–∑–Ω–∞–π –ø—Ä–æ–±–ª–µ–º—É 2) –ò–∑–≤–∏–Ω–∏—Å—å –µ—Å–ª–∏ –Ω–∞—à–∞ –≤–∏–Ω–∞ 3) –ü—Ä–µ–¥–ª–æ–∂–∏ —Ä–µ—à–µ–Ω–∏–µ'\",\n      \"editId\": null –∏–ª–∏ ID (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è edit –∏ delete),\n      \"priority\": 80-100,\n      \"metadata\": {\n        \"category\": \"tone/empathy/professionalism/apology\",\n        \"critical\": true/false,\n        \"reason\": \"–ù–µ–≥–∞—Ç–∏–≤ –≤ X% –¥–∏–∞–ª–æ–≥–æ–≤ –∏–∑-–∑–∞ —Ç–æ–Ω–∞\",\n        \"expected_impact\": \"–ü–æ–≤—ã—Å–∏—Ç satisfaction –Ω–∞ X%\",\n        \"context_change_level\": \"cosmetic/moderate/substantial\",\n        \"history_check\": \"–ü—Ä–æ–≤–µ—Ä–∏–ª changes_history - –ø—Ä–∞–≤–∏–ª–æ –Ω–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–ª–æ—Å—å/–±—ã–ª–æ –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ/–Ω–æ–≤–∞—è –ø—Ä–æ–±–ª–µ–º–∞\",\n        \"replaces_deleted_id\": null –∏–ª–∏ ID (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —ç—Ç–æ append –ø–æ—Å–ª–µ delete),\n        \"resource_verified\": true/false (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –µ—Å–ª–∏ –µ—Å—Ç—å URL),\n        \"source\": \"knowledge_base\" (–µ—Å–ª–∏ URL –∏–∑ –±–∞–∑—ã)\n      }\n    }\n  ],\n  \"missing_materials\": [\n    {\n      \"type\": \"tone_guide/crisis_template\",\n      \"description\": \"–ì–∞–π–¥ –ø–æ —Ç–æ–Ω—É –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏\",\n      \"target_table\": \"communication_style\",\n      \"context\": \"–ù–µ—Ç —á–µ—Ç–∫–∏—Ö –ø—Ä–∞–≤–∏–ª —Ç–æ–Ω–∞ –±—Ä–µ–Ω–¥–∞\",\n      \"priority\": \"medium\"\n    }\n  ]\n}\n\n## –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û –¥–ª—è substantial –∏–∑–º–µ–Ω–µ–Ω–∏–π:\n–ï—Å–ª–∏ context_change_level = \"substantial\", –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π action=\"edit\"!\n–í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ —Å–æ–∑–¥–∞–π –î–í–ê update:\n1) {action: \"delete\", editId: [—Å—Ç–∞—Ä—ã–π ID], content: \"\", ...}\n2) {action: \"append\", content: \"[–Ω–æ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ]\", metadata: {replaces_deleted_id: [—Å—Ç–∞—Ä—ã–π ID], ...}}"
        }
      },
      "id": "b659e923-6f03-4c79-93d5-0acb358790a2",
      "name": "AI Agent Communication",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        -5216,
        128
      ],
      "retryOnFail": true,
      "waitBetweenTries": 2000,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "numberInputs": 4
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -4672,
        -448
      ],
      "id": "49225648-1ab3-44dc-b2a8-7995896043b3",
      "name": "Merge"
    },
    {
      "parameters": {
        "jsCode": "// –£–∑–µ–ª: Split by Tables - –¥–ª—è Split In Batches\n// –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–¥–∞—á–∞ –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–∞–∂–¥–æ–º—É –∞–≥–µ–Ω—Ç—É\nconst fullData = $input.first().json;\n\n// –§–∏–ª—å—Ç—Ä—É–µ–º –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ —Ç–∞–±–ª–∏—Ü–∞–º\nfunction getHistoryForTable(tableName) {\n  if (!fullData.changes_history || !Array.isArray(fullData.changes_history)) {\n    return [];\n  }\n  \n  return fullData.changes_history\n    .filter(change => change.table_name === tableName)\n    .slice(0, 20); // –ë–µ—Ä–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 20 –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã\n}\n\n// –í–æ–∑–≤—Ä–∞—â–∞–µ–º –º–∞—Å—Å–∏–≤ –∏–∑ 4 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤\nreturn [\n  {\n    json: {\n      table_name: \"sales_strategies\",\n      table_data: fullData.current_prompts.sales_strategies,\n      aggregated_analysis: fullData.aggregated_analysis,\n      changes_history: getHistoryForTable(\"sales_strategies\")\n    }\n  },\n  {\n    json: {\n      table_name: \"contact_capture\",\n      table_data: fullData.current_prompts.contact_capture,\n      aggregated_analysis: fullData.aggregated_analysis,\n      changes_history: getHistoryForTable(\"contact_capture\")\n    }\n  },\n  {\n    json: {\n      table_name: \"conversation_scenarios\",\n      table_data: fullData.current_prompts.conversation_scenarios,\n      aggregated_analysis: fullData.aggregated_analysis,\n      changes_history: getHistoryForTable(\"conversation_scenarios\")\n    }\n  },\n  {\n    json: {\n      table_name: \"communication_style\",\n      table_data: fullData.current_prompts.communication_style,\n      aggregated_analysis: fullData.aggregated_analysis,\n      changes_history: getHistoryForTable(\"communication_style\")\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -6064,
        -416
      ],
      "id": "1d39c587-0452-40ed-9818-aef9aeff3423",
      "name": "Split by Tables"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "1f68f879-26ae-441f-b271-b1f2751ddee6",
                    "leftValue": "={{ $json.table_name }}",
                    "rightValue": "sales_strategies",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "AI Agent Sales"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "e6f2c3e2-121d-4adb-a3a7-b320a022c134",
                    "leftValue": "={{ $json.table_name }}",
                    "rightValue": "contact_capture",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "AI Agent Contact"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "e8f92b64-15a8-4075-bd74-9b7f75aff188",
                    "leftValue": "={{ $json.table_name }}",
                    "rightValue": "conversation_scenarios",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "AI Agent Scenarios"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "99888fd8-8afc-44fb-8858-60446fe3d69f",
                    "leftValue": "={{ $json.table_name }}",
                    "rightValue": "communication_style",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": " AI Agent Communication"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -5840,
        -464
      ],
      "id": "47df4ec3-f16d-43da-954f-304917aa9456",
      "name": "Switch"
    },
    {
      "parameters": {
        "amount": 20
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -5408,
        -640
      ],
      "id": "4243cf5c-3812-4f90-9c97-bea77340ddaa",
      "name": "Wait1",
      "webhookId": "c8a15c3d-1706-46b6-923b-3470a9fc44fa"
    },
    {
      "parameters": {
        "amount": 20
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -5360,
        -208
      ],
      "id": "12d9472b-732d-4d89-8592-f2c82bd27607",
      "name": "Wait2",
      "webhookId": "1f98b23c-3d45-4510-973f-6f32483dac3c"
    },
    {
      "parameters": {
        "amount": 20
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -5360,
        144
      ],
      "id": "1933cd74-df46-4624-8a6b-12dee4b9bb44",
      "name": "Wait3",
      "webhookId": "980fdf9a-6191-4aa6-ae28-a3e29d8a6cf5"
    },
    {
      "parameters": {
        "jsCode": "// Extract Missing Materials - –ù–û–í–ê–Ø –í–ï–†–°–ò–Ø\nconst mergeOutputs = $input.all();\nconst materialsByTable = {}; // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ —Ç–∞–±–ª–∏—Ü–∞–º\n\nmergeOutputs.forEach(item => {\n  try {\n    const output = item.json.output || item.json;\n    let aiResponse;\n    \n    if (typeof output === 'string') {\n      const jsonMatch = output.match(/\\{[\\s\\S]*\\}/);\n      aiResponse = jsonMatch ? JSON.parse(jsonMatch[0]) : JSON.parse(output);\n    } else {\n      aiResponse = output;\n    }\n    \n    if (aiResponse.missing_materials && Array.isArray(aiResponse.missing_materials)) {\n      aiResponse.missing_materials.forEach(material => {\n        const table = material.target_table || 'unknown';\n        if (!materialsByTable[table]) {\n          materialsByTable[table] = [];\n        }\n        materialsByTable[table].push(material);\n      });\n    }\n  } catch (error) {\n    console.error('Error parsing AI output:', error);\n  }\n});\n\n// –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ú–ê–°–°–ò–í –æ–±—ä–µ–∫—Ç–æ–≤ - –ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ –∫–∞–∂–¥—É—é —Ç–∞–±–ª–∏—Ü—É\nconst result = Object.keys(materialsByTable).map(table => ({\n  json: {\n    table: table,\n    materials: materialsByTable[table],\n    count: materialsByTable[table].length\n  }\n}));\n\nconsole.log('Missing materials by tables:', result.length);\n\nreturn result.length > 0 ? result : [{\n  json: {\n    table: 'none',\n    materials: [],\n    count: 0\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -4448,
        -624
      ],
      "id": "5fc7eedd-25b8-4867-afe5-319eab2cd3f2",
      "name": "–úissing materials"
    },
    {
      "parameters": {
        "jsCode": "// –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç –¥–ª—è Telegram - –ü–†–û–î–ê–ö–®–ù –í–ï–†–°–ò–Ø\nconst report = $json;\n\nfunction formatDate(dateString) {\n  try {\n    const date = new Date(dateString);\n    if (isNaN(date.getTime())) return '–ù–µ —É–∫–∞–∑–∞–Ω–æ';\n    return date.toLocaleString('ru-RU');\n  } catch (error) {\n    return '–ù–µ —É–∫–∞–∑–∞–Ω–æ';\n  }\n}\n\nlet message = `üìä *–û—Ç—á–µ—Ç –æ —Å–∞–º–æ–æ–±—É—á–µ–Ω–∏–∏ –ò–ò-–∞–≥–µ–Ω—Ç–∞*\\n\\n`;\nmessage += `‚è∞ –í—Ä–µ–º—è: ${formatDate(report.execution_time)}\\n\\n`;\n\n// –ê–Ω–∞–ª–∏–∑ –¥–∏–∞–ª–æ–≥–æ–≤\nconst dialogsProcessed = report.analysis?.dialogs_processed || 0;\nmessage += `üìà *–ê–Ω–∞–ª–∏–∑ –¥–∏–∞–ª–æ–≥–æ–≤:*\\n`;\nmessage += `‚Ä¢ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ: *${dialogsProcessed}* –¥–∏–∞–ª–æ–≥–æ–≤\\n`;\nmessage += `‚Ä¢ –°—Ä–µ–¥–Ω—è—è —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å: *${report.analysis?.avg_satisfaction || 0}%*\\n`;\nmessage += `‚Ä¢ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º: *${report.analysis?.critical_problems || 0}*\\n\\n`;\n\n// –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤\nmessage += `‚úèÔ∏è *–û–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤:*\\n`;\nmessage += `‚Ä¢ –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–æ: ${report.updates?.proposed || 0}\\n`;\nmessage += `‚Ä¢ –ü—Ä–∏–º–µ–Ω–µ–Ω–æ: *${report.updates?.validated || 0}*\\n`;\nmessage += `‚Ä¢ –û—Ç–∫–ª–æ–Ω–µ–Ω–æ: ${report.updates?.rejected || 0}\\n`;\n\nif ((report.updates?.validated || 0) > 0) {\n  const successRate = Math.round(((report.updates.validated || 0) / (report.updates.proposed || 1)) * 100) || 0;\n  message += `‚úÖ –£—Å–ø–µ—à–Ω–æ: ${report.updates.validated} –ø—Ä–∞–≤–∏–ª (${successRate}%)\\\\n`;\n}\n\n// –ù–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã\nif ((report.missing_materials || 0) > 0) {\n  message += `\\n‚ö†Ô∏è –ù–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤: *${report.missing_materials}*\\n`;\n}\n\n// ===== –ù–û–í–û–ï: –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –Ω–∞–≥—Ä—É–∑–∫–µ =====\nif (report.warning) {\n  message += `\\n‚ö†Ô∏è *–í–ù–ò–ú–ê–ù–ò–ï:*\\n${report.warning}\\n`;\n}\n\nif (report.performance_note) {\n  message += `\\nüìä *–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:*\\n${report.performance_note}\\n`;\n}\n\n// –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–∞–≥—Ä—É–∑–∫–∏\nlet loadIndicator = 'üü¢ –ù–∏–∑–∫–∞—è';\nif (dialogsProcessed > 200) loadIndicator = 'üü° –°—Ä–µ–¥–Ω—è—è';\nif (dialogsProcessed > 400) loadIndicator = 'üü† –í—ã—Å–æ–∫–∞—è';\nif (dialogsProcessed >= 600) loadIndicator = 'üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è';\n\nmessage += `\\nüìä *–ù–∞–≥—Ä—É–∑–∫–∞:* ${loadIndicator} (${dialogsProcessed} –¥–∏–∞–ª–æ–≥–æ–≤)\\n`;\n// ===== –ö–û–ù–ï–¶ –ù–û–í–û–ì–û =====\n\nmessage += `\\nüîÑ –°–ª–µ–¥—É—é—â–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: ${formatDate(report.next_check)}\\n`;\nmessage += `\\n‚úÖ *–°—Ç–∞—Ç—É—Å:* –¶–∏–∫–ª –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ`;\n\nreturn [{\n  json: {\n    message: message,\n    parse_mode: 'Markdown'\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3424,
        -224
      ],
      "id": "e19757f4-3e6a-48a9-b23c-18cfc41054f9",
      "name": "Format Final Report for Telegram"
    },
    {
      "parameters": {
        "chatId": "-1002588885971",
        "text": "={{ $json.message }}",
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "={{ $json.parse_mode }}"
        }
      },
      "id": "58da87b5-0310-43fb-8fe7-719dc170ef5a",
      "name": "Send to Telegram1",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -3232,
        -224
      ],
      "webhookId": "95289c60-3387-4996-8ec5-82ef2d620a80",
      "credentials": {
        "telegramApi": {
          "id": "fn7ywFo6SxQJtPcU",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "amount": 1
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -3856,
        -640
      ],
      "id": "81b0c100-e559-475f-aab1-22f75e375aa0",
      "name": "Wait5",
      "webhookId": "a0a9adb5-35bc-4f15-b8ea-972ed6073b42"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.embeddingsGoogleGemini",
      "typeVersion": 1,
      "position": [
        -5184,
        -368
      ],
      "id": "5938c08d-5019-40ca-8e13-a07c22287e7c",
      "name": "Embeddings Google Gemini8",
      "credentials": {
        "googlePalmApi": {
          "id": "abo0BDHSJPM0pgRU",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "Product knowledge base - prices, features, algorithms, purchase process. REQUIRED PARAMETER: match_knowledge_base MUST be a non-empty search query string. Example: \"pricing plans\" or \"encryption algorithm\". DO NOT leave empty.",
        "tableName": {
          "__rl": true,
          "value": "knowledge_base",
          "mode": "id"
        },
        "topK": 20,
        "options": {
          "queryName": "match_knowledge_base"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        -5520,
        -368
      ],
      "id": "a824fec3-3186-4f3b-b0b6-5e338ca2712f",
      "name": "Knowledge base",
      "credentials": {
        "supabaseApi": {
          "id": "7ldcSWe5TTPVh3zH",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "INSERT INTO ai_learning_log (\n  type,\n  action,\n  status,\n  table_name,\n  metadata,\n  session_id,\n  created_at\n) VALUES (\n  'cycle_started',\n  'analysis_start',\n  'running',\n  'all_tables',\n  jsonb_build_object(\n    'trigger', 'scheduled',\n    'start_time', '{{ $json.start_time }}'::text,\n    'workflow_execution_id', '{{ $json.workflow_execution_id }}'::text\n  ),\n  '{{ $json.session_id }}'::text,\n  NOW()\n);",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -8320,
        -720
      ],
      "id": "68f55dd4-ec82-483a-b6f2-8124639e5efa",
      "name": "Log Cycle Start",
      "executeOnce": true,
      "credentials": {
        "postgres": {
          "id": "dPjh4Kdb4nIbCTQG",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π session_id –¥–ª—è —Ü–∏–∫–ª–∞ –æ–±—É—á–µ–Ω–∏—è\nconst sessionId = 'learning_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);\n\nconsole.log('Starting learning cycle with session_id:', sessionId);\n\n// –í–æ–∑–≤—Ä–∞—â–∞–µ–º –¢–û–õ–¨–ö–û session_id, –±–µ–∑ –¥–∞–Ω–Ω—ã—Ö –∞–Ω–∞–ª–∏–∑–∞\nreturn [{\n  json: {\n    session_id: sessionId,\n    cycle_id: sessionId,\n    start_time: new Date().toISOString(),\n    workflow_execution_id: String($execution.id || 'unknown'),\n    _is_metadata: true\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -8560,
        -384
      ],
      "id": "c9704891-08b8-4a05-80fe-10a53ef223ae",
      "name": "Cycle Start ID"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "-- –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –±–∞—Ç—á–∞, –ë–ï–ó –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è last_analysis_check\nINSERT INTO ai_learning_log (\n  type, action, status, table_name, metadata, session_id, created_at\n)\nSELECT\n  'batch_completed', 'batch_processed', 'completed', 'all_tables',\n  jsonb_build_object(\n    'batch_iteration', 1,\n    'records_processed', {{ $('Get New Analysis Since Last Check').all().length }},\n    'max_id_processed', MAX(id),\n    'processed_ids', array_agg(id ORDER BY id)\n  ),\n  '{{ $('Cycle Start ID').first().json.session_id }}',\n  NOW()\nFROM dialog_analysis\nWHERE id IN ({{ $('Get New Analysis Since Last Check').all().map(i => i.json.id).join(',') }});\n\nSELECT 'batch_saved' as status;",
        "options": {}
      },
      "id": "e41290aa-b46c-482f-a2bb-b4c06a9873fc",
      "name": "Save Last Check Time",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        -3664,
        -448
      ],
      "credentials": {
        "postgres": {
          "id": "dPjh4Kdb4nIbCTQG",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT \n  COUNT(CASE WHEN type = 'approved_update' THEN 1 END) as approved,\n  COUNT(CASE WHEN type = 'rejected_update' THEN 1 END) as rejected,\n  COUNT(*) - 1 as total_updates -- –º–∏–Ω—É—Å 1 –¥–ª—è cycle_started\nFROM ai_learning_log\nWHERE session_id = '{{ $('Cycle Start ID').first().json.session_id }}'\n  AND type != 'cycle_started';",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -3808,
        -224
      ],
      "id": "e22f8363-9858-4392-8ddf-b440d1900a60",
      "name": "Get Real Stats",
      "credentials": {
        "postgres": {
          "id": "dPjh4Kdb4nIbCTQG",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.errorTrigger",
      "typeVersion": 1,
      "position": [
        -8496,
        -1056
      ],
      "id": "7f6f9e2b-6932-4f9f-8440-39dc896487f3",
      "name": "Error Trigger"
    },
    {
      "parameters": {
        "jsCode": "// –£–ù–ò–í–ï–†–°–ê–õ–¨–ù–´–ô –û–ë–†–ê–ë–û–¢–ß–ò–ö –û–®–ò–ë–û–ö v2.0\n// –†–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –¥–∞–Ω–Ω—ã—Ö –æ—Ç Error Trigger\n\nconst input = $input.first().json;\n\n// –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å —É—á–µ—Ç–æ–º —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ Error Trigger\nlet errorInfo = {};\n\n// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã\nif (input.execution) {\n  // –§–æ—Ä–º–∞—Ç —Å execution (–∫–∞–∫ –≤ –≤–∞—à–µ–º –ø—Ä–∏–º–µ—Ä–µ)\n  errorInfo = {\n    workflowName: input.workflow?.name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π workflow',\n    workflowId: input.workflow?.id || 'unknown',\n    executionId: input.execution?.id || 'unknown',\n    executionUrl: input.execution?.url || '',\n    failedNode: input.execution?.error?.node?.name || input.execution?.lastNodeExecuted || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —É–∑–µ–ª',\n    nodeType: input.execution?.error?.node?.type || 'unknown',\n    errorMessage: input.execution?.error?.message || input.execution?.error?.description || '–û—à–∏–±–∫–∞ –±–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è',\n    errorStack: input.execution?.error?.stack || '',\n    timestamp: input.execution?.error?.timestamp || Date.now()\n  };\n} else if (input.error) {\n  // –ü—Ä–æ—Å—Ç–æ–π —Ñ–æ—Ä–º–∞—Ç —Å error\n  errorInfo = {\n    workflowName: input.workflow || $workflow.name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π workflow',\n    workflowId: $workflow.id || 'unknown',\n    executionId: $execution.id || 'unknown',\n    executionUrl: '',\n    failedNode: input.node || input.error.node || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —É–∑–µ–ª',\n    nodeType: input.nodeType || 'unknown',\n    errorMessage: input.error.message || input.error || '–û—à–∏–±–∫–∞ –±–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è',\n    errorStack: input.error.stack || '',\n    timestamp: Date.now()\n  };\n} else {\n  // Fallback –¥–ª—è –ª—é–±–æ–≥–æ –¥—Ä—É–≥–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞\n  errorInfo = {\n    workflowName: $workflow.name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π workflow',\n    workflowId: $workflow.id || 'unknown',\n    executionId: $execution.id || 'unknown',\n    executionUrl: '',\n    failedNode: input.node || input.nodeName || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —É–∑–µ–ª',\n    nodeType: 'unknown',\n    errorMessage: input.message || JSON.stringify(input).substring(0, 500),\n    errorStack: '',\n    timestamp: Date.now()\n  };\n}\n\n// –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤—Ä–µ–º—è\nconst errorTime = new Date(errorInfo.timestamp).toLocaleString('ru-RU');\n\n// –£–ù–ò–í–ï–†–°–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó–ê–¢–û–† –û–®–ò–ë–û–ö\n// –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –ª—é–±–æ–≥–æ workflow\nlet errorCategory = 'üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞';\nlet recommendation = '';\nlet priority = 'üü° –°—Ä–µ–¥–Ω–∏–π';\n\n// –ê–Ω–∞–ª–∏–∑ –ø–æ —Ç–µ–∫—Å—Ç—É –æ—à–∏–±–∫–∏ (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã)\nconst errorLower = errorInfo.errorMessage.toLowerCase();\n\n// –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö\nif (errorLower.includes('relation') && errorLower.includes('does not exist')) {\n  errorCategory = 'üóÑÔ∏è –¢–∞–±–ª–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ –ë–î';\n  recommendation = `–¢–∞–±–ª–∏—Ü–∞ \"${errorInfo.errorMessage.match(/\"([^\"]+)\"/)?.[1] || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è'}\" –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –°–æ–∑–¥–∞–π—Ç–µ –µ—ë –∏–ª–∏ –∏—Å–ø—Ä–∞–≤—å—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ.`;\n  priority = 'üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π';\n}\nelse if (errorLower.includes('column') && errorLower.includes('does not exist')) {\n  errorCategory = 'üóÑÔ∏è –ö–æ–ª–æ–Ω–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ –ë–î';\n  recommendation = `–ö–æ–ª–æ–Ω–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ë–î.`;\n  priority = 'üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π';\n}\nelse if (errorLower.includes('postgres') || errorLower.includes('sql')) {\n  errorCategory = 'üóÑÔ∏è –û—à–∏–±–∫–∞ PostgreSQL';\n  recommendation = '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ SQL-–∑–∞–ø—Ä–æ—Å –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î';\n  priority = 'üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π';\n}\n// –°–µ—Ç—å –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è\nelse if (errorLower.includes('econnrefused')) {\n  errorCategory = 'üîå –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω';\n  recommendation = '–°–µ—Ä–≤–µ—Ä –æ—Ç–∫–ª–æ–Ω–∏–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–µ—Ä–≤–∏—Å –∑–∞–ø—É—â–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω.';\n  priority = 'üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π';\n}\nelse if (errorLower.includes('timeout') || errorLower.includes('etimedout')) {\n  errorCategory = '‚è±Ô∏è –ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è';\n  recommendation = '–û–ø–µ—Ä–∞—Ü–∏—è –∑–∞–Ω—è–ª–∞ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏. –£–≤–µ–ª–∏—á—å—Ç–µ —Ç–∞–π–º–∞—É—Ç –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ä–≤–µ—Ä.';\n  priority = 'üü† –í—ã—Å–æ–∫–∏–π';\n}\nelse if (errorLower.includes('404') || errorLower.includes('not found')) {\n  errorCategory = 'üîç –†–µ—Å—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω';\n  recommendation = '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å URL –∏–ª–∏ –ø—É—Ç–∏ –∫ —Ä–µ—Å—É—Ä—Å—É.';\n  priority = 'üü† –í—ã—Å–æ–∫–∏–π';\n}\n// API –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è\nelse if (errorLower.includes('unauthorized') || errorLower.includes('401')) {\n  errorCategory = 'üîë –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏';\n  recommendation = '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ API –∫–ª—é—á–∏ –∏ —Ç–æ–∫–µ–Ω—ã –¥–æ—Å—Ç—É–ø–∞.';\n  priority = 'üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π';\n}\nelse if (errorLower.includes('rate limit') || errorLower.includes('quota')) {\n  errorCategory = 'üö´ –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç API';\n  recommendation = '–î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤. –ü–æ–¥–æ–∂–¥–∏—Ç–µ –∏–ª–∏ —É–≤–µ–ª–∏—á—å—Ç–µ –ª–∏–º–∏—Ç—ã.';\n  priority = 'üü† –í—ã—Å–æ–∫–∏–π';\n}\n// –î–∞–Ω–Ω—ã–µ\nelse if (errorLower.includes('undefined') || errorLower.includes('cannot read')) {\n  errorCategory = '‚ö†Ô∏è –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –¥–∞–Ω–Ω—ã–µ';\n  recommendation = '–£–∑–µ–ª –ø–æ–ª—É—á–∏–ª –ø—É—Å—Ç—ã–µ –∏–ª–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —É–∑–ª—ã.';\n  priority = 'üü† –í—ã—Å–æ–∫–∏–π';\n}\nelse if (errorLower.includes('json') || errorLower.includes('parse')) {\n  errorCategory = 'üìù –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞–Ω–Ω—ã—Ö';\n  recommendation = '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç JSON. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö.';\n  priority = 'üü† –í—ã—Å–æ–∫–∏–π';\n}\n// AI\nelse if (errorLower.includes('gemini') || errorLower.includes('openai') || errorLower.includes('anthropic')) {\n  errorCategory = 'ü§ñ –û—à–∏–±–∫–∞ AI —Å–µ—Ä–≤–∏—Å–∞';\n  recommendation = '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ API –∫–ª—é—á, –ª–∏–º–∏—Ç—ã –∏ —Ñ–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞ –∫ AI.';\n  priority = 'üü† –í—ã—Å–æ–∫–∏–π';\n}\n\n// –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ\nconst message = `${priority} *–û–®–ò–ë–ö–ê –í WORKFLOW*\n\n${errorCategory}\n\nüìã *Workflow:* ${errorInfo.workflowName}\n‚ùå *–°–±–æ–π–Ω—ã–π —É–∑–µ–ª:* ${errorInfo.failedNode}\n‚è∞ *–í—Ä–µ–º—è:* ${errorTime}\n\nüìù *–û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏:*\n\\`\\`\\`\n${errorInfo.errorMessage.substring(0, 500)}\n\\`\\`\\`\n\nüí° *–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:* \n${recommendation || '–ò–∑—É—á–∏—Ç–µ –¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏ –≤ –ª–æ–≥–∞—Ö n8n'}\n\nüîç *–ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:*\n1. ${errorInfo.executionUrl ? `–û—Ç–∫—Ä–æ–π—Ç–µ: ${errorInfo.executionUrl}` : `–û—Ç–∫—Ä–æ–π—Ç–µ n8n ‚Üí Executions ‚Üí ID: ${errorInfo.executionId}`}\n2. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ —É–∑–µ–ª \"${errorInfo.failedNode}\"\n3. ${recommendation ? '–ü—Ä–∏–º–µ–Ω–∏—Ç–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—é –≤—ã—à–µ' : '–ò–∑—É—á–∏—Ç–µ –¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏'}\n\nüìä *–î–µ—Ç–∞–ª–∏:*\n- Workflow ID: \\`${errorInfo.workflowId}\\`\n- Execution ID: \\`${errorInfo.executionId}\\`\n- –¢–∏–ø —É–∑–ª–∞: ${errorInfo.nodeType}`;\n\n// –õ–æ–≥–∏—Ä—É–µ–º –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏\nconsole.log('Error processed:', {\n  workflow: errorInfo.workflowName,\n  node: errorInfo.failedNode,\n  error: errorInfo.errorMessage\n});\n\nreturn [{\n  json: {\n    message: message,\n    parse_mode: 'Markdown',\n    priority: priority,\n    error_details: errorInfo\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -8288,
        -1056
      ],
      "id": "02dcc2d0-d852-4baf-a62d-6a03345e3dcc",
      "name": "Format Error Message"
    },
    {
      "parameters": {
        "chatId": "-1002588885971",
        "text": "={{ $json.message }}",
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "={{ $json.parse_mode }}"
        }
      },
      "id": "3409a0e9-e90f-4ced-999a-f1025557d489",
      "name": "Error Message",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -8096,
        -1056
      ],
      "webhookId": "95289c60-3387-4996-8ec5-82ef2d620a80",
      "credentials": {
        "telegramApi": {
          "id": "fn7ywFo6SxQJtPcU",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "Company interaction rules. REQUIRED PARAMETER: match_interaction_policies MUST be a non-empty search query string. Example: \"callback policy\" or \"manager contact rules\". DO NOT leave empty.",
        "tableName": {
          "__rl": true,
          "value": "interaction_policies",
          "mode": "id"
        },
        "topK": 20,
        "options": {
          "queryName": "match_interaction_policies"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        -5056,
        -368
      ],
      "id": "4952c0e7-5a2b-41a9-8410-1eb13c200327",
      "name": "Interaction policies",
      "credentials": {
        "supabaseApi": {
          "id": "7ldcSWe5TTPVh3zH",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const allItems = $input.all();\n\nreturn allItems.map(item => ({\n  json: {\n    ...item.json,\n    _iteration: 1,\n    _batch_start: new Date().toISOString(),\n    _last_processed_id: 0 // –ù–∞—á–∏–Ω–∞–µ–º —Å 0\n  }\n}));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -7744,
        -432
      ],
      "id": "0a6c87a2-266f-4e0f-b7e9-b565781c5414",
      "name": "Initialize Batch Counter"
    },
    {
      "parameters": {
        "jsCode": "// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –µ—â–µ –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏\n// –í–ê–ñ–ù–û: –±–µ—Ä–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ Aggregate All Analysis, –Ω–µ –∏–∑ Get New Analysis\nconst aggregatedData = $('Aggregate All Analysis').first().json;\nconst processedCount = aggregatedData.total_dialogs || 0;\n\nconst currentIteration = $('Initialize Batch Counter').first()?.json?._iteration || 1;\n\nconst MAX_ITERATIONS = 2; // –ú–∞–∫—Å–∏–º—É–º 10 –±–∞—Ç—á–µ–π = 300 –∑–∞–ø–∏—Å–µ–π –∑–∞ —Ä–∞–∑\n\n// –ï—Å–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∞–ª–∏ —Ä–æ–≤–Ω–æ LIMIT (3 –¥–ª—è —Ç–µ—Å—Ç–∞, 30 –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ) –ò –Ω–µ –ø—Ä–µ–≤—ã—Å–∏–ª–∏ –ª–∏–º–∏—Ç –∏—Ç–µ—Ä–∞—Ü–∏–π\nconst BATCH_LIMIT = 3; // –ò–∑–º–µ–Ω–∏ –Ω–∞ 30 –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–æ–≤\nconst mayHaveMore = processedCount >= BATCH_LIMIT && currentIteration < MAX_ITERATIONS;\n\nconsole.log(`Batch ${currentIteration}/${MAX_ITERATIONS}: Processed ${processedCount} dialogs. Coverage: ${currentIteration * BATCH_LIMIT}/${MAX_ITERATIONS * BATCH_LIMIT} max. More: ${mayHaveMore}`);\n\nreturn [{\n  json: {\n    has_more: mayHaveMore,\n    processed_count: processedCount,\n    current_iteration: currentIteration,\n    max_iterations: MAX_ITERATIONS,\n    batch_limit: BATCH_LIMIT,\n    timestamp: new Date().toISOString()\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3488,
        -496
      ],
      "id": "d2b052c9-1248-44a8-a97d-74ff5fd197b3",
      "name": "Check If More Records Exist"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "1f0fa5a0-6272-4fbf-a7c0-dd94ee2c26eb",
              "leftValue": "={{ $json.has_more }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -3312,
        -512
      ],
      "id": "1d902e47-4249-4f04-8582-d0e4669e7942",
      "name": "Has More Records?"
    },
    {
      "parameters": {
        "jsCode": "// –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –∏—Ç–µ—Ä–∞—Ü–∏–∏ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –±–∞—Ç—á–∞\nconst currentIteration = $('Check If More Records Exist').first().json.current_iteration;\nconst nextIteration = currentIteration + 1;\n\n// –ù–û–í–û–ï: –ù–∞—Ö–æ–¥–∏–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π ID –∏–∑ —Ç–æ–ª—å–∫–æ —á—Ç–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤\nconst processedDialogs = $('Get New Analysis Since Last Check').all();\nconst lastProcessedId = Math.max(...processedDialogs.map(item => item.json.id));\n\nconsole.log(`Starting batch iteration ${nextIteration}, last processed ID: ${lastProcessedId}`);\n\nreturn [{\n  json: {\n    _iteration: nextIteration,\n    _batch_start: new Date().toISOString(),\n    _last_processed_id: lastProcessedId, // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π ID\n    trigger_next_batch: true\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2752,
        -176
      ],
      "id": "24aea31a-7f27-490e-9d67-2b287e344cea",
      "name": "Increment Iteration Counter"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "-- –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ü–∏–∫–ª–∞\nINSERT INTO ai_learning_log (\n  type,\n  action,\n  status,\n  table_name,\n  metadata,\n  session_id,\n  created_at\n) VALUES (\n  'cycle_completed',\n  'finish',\n  'completed',\n  'all_tables',\n  jsonb_build_object(\n    'workflow_execution_id', '{{ $('Cycle Start ID').first().json.session_id }}',\n    'completion_time', NOW()::text\n  ),\n  '{{ $('Cycle Start ID').first().json.session_id }}',\n  NOW()\n);\n\n-- –û–±–Ω–æ–≤–ª—è–µ–º last_analysis_check\nUPDATE system_config\nSET last_analysis_check = NOW()\nWHERE key = 'ai_learning_last_check';\n\nSELECT \n  'cycle_completed' as status,\n  NOW()::text as last_check_time,\n  '{{ $('Cycle Start ID').first().json.session_id }}' as session_id;",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -4464,
        -240
      ],
      "id": "a65dc8ef-9d32-4a33-93ff-37eee609b385",
      "name": "Update Final Last Check Time",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "dPjh4Kdb4nIbCTQG",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –°—Ö–ª–æ–ø—ã–≤–∞–µ–º –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã loop –≤ –æ–¥–∏–Ω —ç–ª–µ–º–µ–Ω—Ç\nconst allItems = $input.all();\n\nconsole.log(`Loop completed, processed ${allItems.length} updates`);\n\nreturn [{\n  json: {\n    total_updates_processed: allItems.length,\n    loop_completed: true,\n    timestamp: new Date().toISOString()\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3856,
        -448
      ],
      "id": "6d122d05-43fb-47c4-be47-8d5ae887b0c8",
      "name": "Aggregate Loop Results"
    },
    {
      "parameters": {
        "jsCode": "// –ü–æ–ª—É—á–∞–µ–º session_id –∏–∑ Cycle Start ID\nconst sessionId = $('Cycle Start ID').first().json.session_id;\n\n// –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –¥–∏–∞–ª–æ–≥–∏ –∏–∑ Get New Analysis\nconst dialogs = $('Get New Analysis Since Last Check').all();\n\n// –ï—Å–ª–∏ –Ω–µ—Ç –¥–∏–∞–ª–æ–≥–æ–≤ - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç–æ–π –æ–±—ä–µ–∫—Ç —Å session_id\nif (dialogs.length === 0 || !dialogs[0].json.id) {\n  return [{\n    json: {\n      session_id: sessionId,\n      no_dialogs: true\n    }\n  }];\n}\n\n// –î–æ–±–∞–≤–ª—è–µ–º session_id –∫ –∫–∞–∂–¥–æ–º—É –¥–∏–∞–ª–æ–≥—É\nreturn dialogs.map(item => ({\n  json: {\n    ...item.json,\n    session_id: sessionId\n  }\n}));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -8144,
        -384
      ],
      "id": "63032eea-381f-467f-85e0-4ecbcccdcd27",
      "name": "Merge Session ID"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "91efa30c-73f0-4b7e-ad00-b3f301e50c0e",
              "leftValue": "={{ $input.first().json.has_processing }}",
              "rightValue": "true",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -4048,
        -224
      ],
      "id": "49584083-f978-4da4-b4f0-1c4939432314",
      "name": "IF"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT \n  CASE \n    WHEN COUNT(*) > 0 THEN true \n    ELSE false \n  END as has_processing\nFROM ai_learning_log\nWHERE session_id = '{{ $('Cycle Start ID').first().json.session_id }}'\n  AND type IN ('approved_update', 'rejected_update');",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -4256,
        -240
      ],
      "id": "1b6d2eed-2520-4190-8ca7-37c3168a8b59",
      "name": "Check If Processing Happened",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "dPjh4Kdb4nIbCTQG",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "OdXsDOgimVGW8aQf",
          "mode": "list",
          "cachedResultUrl": "/workflow/OdXsDOgimVGW8aQf",
          "cachedResultName": "Validator Learning System"
        },
        "options": {}
      },
      "id": "698ec906-8157-4354-98f5-88e3ecacb02e",
      "name": "Execute Child Workflow",
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.1,
      "position": [
        -4048,
        -448
      ]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "INSERT INTO ai_analysis_temp (aggregated_data, created_at) \nVALUES ('{{ $json.aggregated_data_escaped }}', NOW());",
        "options": {
          "queryReplacement": "="
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -7168,
        -576
      ],
      "id": "4b6ca406-61a7-4e14-a7b5-432338cdec42",
      "name": "Save Analysis to DB",
      "credentials": {
        "postgres": {
          "id": "dPjh4Kdb4nIbCTQG",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const data = $json;\n\n// –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º JSON –¥–ª—è PostgreSQL\nconst escapedJson = JSON.stringify(data).replace(/'/g, \"''\");\n\nreturn [{\n  json: {\n    aggregated_data_escaped: escapedJson\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -7344,
        -576
      ],
      "id": "fcf824af-387a-45db-acfc-a9a9356e9bea",
      "name": "Escape JSON for DB"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT \n  table_name,\n  content,\n  action,\n  status,\n  created_at,\n  metadata\nFROM ai_learning_log\nWHERE created_at > NOW() - INTERVAL '7 days'\n  AND type IN ('approved_update', 'rejected_update')\n  AND status IN ('applied', 'rejected')\nORDER BY created_at DESC\nLIMIT 100",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -6704,
        -368
      ],
      "id": "9aebf29c-f42e-45c0-af77-84288ff85602",
      "name": "Load Changes History",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "dPjh4Kdb4nIbCTQG",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -6448,
        -400
      ],
      "id": "9131088b-feb6-4afa-9753-98bed2a9f12f",
      "name": "Merge1"
    },
    {
      "parameters": {
        "chatId": "-1002588885971",
        "text": "={{ $json.message }}",
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "={{ $json.parse_mode }}"
        }
      },
      "id": "23b34c47-2095-4f23-8234-781e588cdc02",
      "name": "Send Start Notification",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -8144,
        -528
      ],
      "webhookId": "95289c60-3387-4996-8ec5-82ef2d620a80",
      "credentials": {
        "telegramApi": {
          "id": "fn7ywFo6SxQJtPcU",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Å—Ç–∞—Ä—Ç–µ –¥–ª—è Telegram\nconst cycleId = $('Cycle Start ID').item.json.cycle_id;\n\nlet message = `üöÄ *–°–¢–ê–†–¢ –¶–ò–ö–õ–ê –û–ë–£–ß–ï–ù–ò–Ø*\\n\\n`;\nmessage += `üìä Cycle ID: \\`${cycleId}\\`\\n\\n`;\nmessage += `‚è± –ù–∞—á–∞–ª–æ: ${new Date().toLocaleString('ru-RU')}\\n\\n`;\nmessage += `‚öôÔ∏è –ó–∞–ø—É—â–µ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤—ã—Ö –∞–Ω–∞–ª–∏–∑–æ–≤ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∞–≤–∏–ª...\\n`;\nmessage += `_–î–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ü–∏–∫–ª–∞_`;\n\nreturn [{\n  json: {\n    message: message,\n    parse_mode: 'Markdown'\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -8336,
        -528
      ],
      "id": "a27784cb-01d4-4eb1-8aa6-924d9fdbd89e",
      "name": "Format Start Notification"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "-- –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏, –æ—Å—Ç–∞–≤–ª—è—è –ø–æ—Å–ª–µ–¥–Ω–∏–µ 50\nWITH recent_records AS (\n  SELECT id \n  FROM ai_learning_log\n  ORDER BY created_at DESC\n  LIMIT 200\n)\nDELETE FROM ai_learning_log\nWHERE id NOT IN (SELECT id FROM recent_records);",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -3024,
        -224
      ],
      "id": "04de5000-4ea6-4131-b65c-84e529c978c3",
      "name": "Cleanup Old Learning Logs",
      "credentials": {
        "postgres": {
          "id": "dPjh4Kdb4nIbCTQG",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT 'sales_strategies' as table_name, id, content, metadata, created_at \n   FROM sales_strategies\n   UNION ALL\n   SELECT 'contact_capture' as table_name, id, content, metadata, created_at \n   FROM contact_capture\n   UNION ALL\n   SELECT 'conversation_scenarios' as table_name, id, content, metadata, created_at \n   FROM conversation_scenarios\n   UNION ALL\n   SELECT 'communication_style' as table_name, id, content, metadata, created_at \n   FROM communication_style\n   ORDER BY table_name, id ASC",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -7152,
        -416
      ],
      "id": "cb693aec-5a3c-4289-8a21-b2306463a0bf",
      "name": "Read All Vector Tables",
      "retryOnFail": true,
      "waitBetweenTries": 2000,
      "credentials": {
        "postgres": {
          "id": "I3pncOwnyKZ5gwoO",
          "name": "Postgres_gmail"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "jsCode": "// –£–∑–µ–ª: Format Tables Data\n// –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –≤—Å–µ –∑–∞–ø–∏—Å–∏ –ø–æ —Ç–∞–±–ª–∏—Ü–∞–º + –ü–ï–†–ï–î–ê–ï–ú aggregated_analysis\n\nconst allRecords = $input.all();\nconst groupedData = {};\n\n// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã\nconst tables = [\n  'sales_strategies', \n  'contact_capture',\n  'conversation_scenarios',\n  'communication_style'\n];\n\n// –°–æ–∑–¥–∞–µ–º –ø—É—Å—Ç—ã–µ –º–∞—Å—Å–∏–≤—ã –¥–ª—è –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã\ntables.forEach(table => {\n  groupedData[table] = {\n    table_name: table,\n    records: [],\n    total: 0\n  };\n});\n\n// –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –∑–∞–ø–∏—Å–∏ –ø–æ —Ç–∞–±–ª–∏—Ü–∞–º\nallRecords.forEach(item => {\n  const record = item.json;\n  const tableName = record.table_name;\n  \n  if (groupedData[tableName]) {\n    groupedData[tableName].records.push({\n      id: record.id,\n      content: record.content,\n      metadata: record.metadata || {},\n      created_at: record.created_at\n    });\n  }\n});\n\n// –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –≤ –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü–µ\nObject.keys(groupedData).forEach(table => {\n  groupedData[table].total = groupedData[table].records.length;\n});\n\n// –ù–û–í–û–ï: –ü–æ–ª—É—á–∞–µ–º aggregated_analysis –∏–∑ Prepare Data for Loading\nconst preparedData = $('Prepare Data for Loading').first().json;\nconst aggregatedAnalysis = preparedData.aggregated_analysis;\n\n// –§–æ—Ä–º–∏—Ä—É–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç —Å aggregated_analysis\nconst response = {\n  success: true,\n  total_records: allRecords.length,\n  tables_data: groupedData,\n  aggregated_analysis: aggregatedAnalysis, // –î–û–ë–ê–í–õ–ï–ù–û!\n  summary: {\n    sales_strategies: groupedData.sales_strategies.total,\n    contact_capture: groupedData.contact_capture.total,\n    conversation_scenarios: groupedData.conversation_scenarios.total,\n    communication_style: groupedData.communication_style.total\n  }\n};\n\n// –õ–æ–≥–∏—Ä—É–µ–º –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏\nconsole.log('Total records processed:', allRecords.length);\nconsole.log('Records per table:', response.summary);\nconsole.log('Aggregated analysis dialogs:', aggregatedAnalysis?.total_dialogs || 0);\n\n// –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ\nreturn [{\n  json: response\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -6976,
        -416
      ],
      "id": "806e3e65-e6f1-4033-98b2-7af9cefd9a86",
      "name": "Format Tables Data"
    }
  ],
  "pinData": {},
  "connections": {
    "Schedule Every 4 Hours": {
      "main": [
        [
          {
            "node": "Cycle Start ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get New Analysis Since Last Check": {
      "main": [
        [
          {
            "node": "Merge Session ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Has New Records?": {
      "main": [
        [
          {
            "node": "Initialize Batch Counter",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Update Final Last Check Time",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate All Analysis": {
      "main": [
        [
          {
            "node": "Escape JSON for DB",
            "type": "main",
            "index": 0
          },
          {
            "node": "Prepare Data for Loading",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Data for Loading": {
      "main": [
        [
          {
            "node": "Read All Vector Tables",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent Sales",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Parse AI Response": {
      "main": [
        [
          {
            "node": "Has Updates?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Has Updates?": {
      "main": [
        [
          {
            "node": "Execute Child Workflow",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Has Missing Materials?": {
      "main": [
        [
          {
            "node": "Format Telegram Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Telegram Message": {
      "main": [
        [
          {
            "node": "Wait5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge Analysis with Prompts": {
      "main": [
        [
          {
            "node": "Split by Tables",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent Contact",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model3": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent Scenarios",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model4": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent Communication",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent Sales": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent Contact": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "–úissing materials",
            "type": "main",
            "index": 0
          },
          {
            "node": "Parse AI Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent Scenarios": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 2
          }
        ]
      ]
    },
    "AI Agent Communication": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 3
          }
        ]
      ]
    },
    "Split by Tables": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "AI Agent Sales",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Wait1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Wait2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Wait3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait1": {
      "main": [
        [
          {
            "node": "AI Agent Contact",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait2": {
      "main": [
        [
          {
            "node": "AI Agent Scenarios",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait3": {
      "main": [
        [
          {
            "node": "AI Agent Communication",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–úissing materials": {
      "main": [
        [
          {
            "node": "Has Missing Materials?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Final Report": {
      "main": [
        [
          {
            "node": "Format Final Report for Telegram",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Final Report for Telegram": {
      "main": [
        [
          {
            "node": "Send to Telegram1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait5": {
      "main": [
        [
          {
            "node": "Send to Telegram",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings Google Gemini8": {
      "ai_embedding": [
        [
          {
            "node": "Knowledge base",
            "type": "ai_embedding",
            "index": 0
          },
          {
            "node": "Interaction policies",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Knowledge base": {
      "ai_tool": [
        [
          {
            "node": "AI Agent Sales",
            "type": "ai_tool",
            "index": 0
          },
          {
            "node": "AI Agent Contact",
            "type": "ai_tool",
            "index": 0
          },
          {
            "node": "AI Agent Scenarios",
            "type": "ai_tool",
            "index": 0
          },
          {
            "node": "AI Agent Communication",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Cycle Start ID": {
      "main": [
        [
          {
            "node": "Log Cycle Start",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get New Analysis Since Last Check",
            "type": "main",
            "index": 0
          },
          {
            "node": "Format Start Notification",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Save Last Check Time": {
      "main": [
        [
          {
            "node": "Check If More Records Exist",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Real Stats": {
      "main": [
        [
          {
            "node": "Create Final Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Error Trigger": {
      "main": [
        [
          {
            "node": "Format Error Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Error Message": {
      "main": [
        [
          {
            "node": "Error Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Interaction policies": {
      "ai_tool": [
        [
          {
            "node": "AI Agent Contact",
            "type": "ai_tool",
            "index": 0
          },
          {
            "node": "AI Agent Sales",
            "type": "ai_tool",
            "index": 0
          },
          {
            "node": "AI Agent Scenarios",
            "type": "ai_tool",
            "index": 0
          },
          {
            "node": "AI Agent Communication",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Send to Telegram1": {
      "main": [
        [
          {
            "node": "Cleanup Old Learning Logs",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Initialize Batch Counter": {
      "main": [
        [
          {
            "node": "Aggregate All Analysis",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check If More Records Exist": {
      "main": [
        [
          {
            "node": "Has More Records?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Has More Records?": {
      "main": [
        [
          {
            "node": "Increment Iteration Counter",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Update Final Last Check Time",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Final Last Check Time": {
      "main": [
        [
          {
            "node": "Check If Processing Happened",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Increment Iteration Counter": {
      "main": [
        [
          {
            "node": "Get New Analysis Since Last Check",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate Loop Results": {
      "main": [
        [
          {
            "node": "Save Last Check Time",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge Session ID": {
      "main": [
        [
          {
            "node": "Has New Records?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF": {
      "main": [
        [
          {
            "node": "Get Real Stats",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check If Processing Happened": {
      "main": [
        [
          {
            "node": "IF",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execute Child Workflow": {
      "main": [
        [
          {
            "node": "Aggregate Loop Results",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Escape JSON for DB": {
      "main": [
        [
          {
            "node": "Save Analysis to DB",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Load Changes History": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge1": {
      "main": [
        [
          {
            "node": "Merge Analysis with Prompts",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Start Notification": {
      "main": [
        [
          {
            "node": "Send Start Notification",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Read All Vector Tables": {
      "main": [
        [
          {
            "node": "Format Tables Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Tables Data": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Load Changes History",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "f75628df-e6cc-4103-b89b-27ce09f21ba8",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "9a2a948e1b1119e76dce477f4f08641c41898f344f4216cb90098437b1dcaf00"
  },
  "id": "GRUMm0pQxKNdLMpU",
  "tags": []
}