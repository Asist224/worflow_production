{
  "name": "üîç Highlights Detection [Production RU]",
  "nodes": [
    {
      "parameters": {
        "content": "## üîç Highlights Detection\n\n### üìã –û–ø–∏—Å–∞–Ω–∏–µ\n–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–∞–∂–Ω—ã—Ö –º–æ–º–µ–Ω—Ç–æ–≤ –≤ –¥–∏–∞–ª–æ–≥–∞—Ö —Å –ø–æ–º–æ—â—å—é AI.\n\n**–î–≤–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞:**\n- `POST /detect` - –∞–Ω–∞–ª–∏–∑ –¥–∏–∞–ª–æ–≥–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ highlights\n- `GET /get` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö highlights\n\n---\n\n### ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CONFIG\n\n| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ |\n|----------|----------|\n| `api_key` | API –∫–ª—é—á –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ |\n| `rate_limit_window_ms` | –û–∫–Ω–æ rate limiting (–º—Å) |\n| `rate_limit_max_requests` | –ú–∞–∫—Å. –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –æ–∫–Ω–µ |\n| `table_conversation_highlights` | –¢–∞–±–ª–∏—Ü–∞ highlights |\n| `table_chat_histories_ru` | –¢–∞–±–ª–∏—Ü–∞ —á–∞—Ç–∞ RU |\n| `table_chat_histories_en` | –¢–∞–±–ª–∏—Ü–∞ —á–∞—Ç–∞ EN |\n| `table_chat_sessions` | –¢–∞–±–ª–∏—Ü–∞ —Å–µ—Å—Å–∏–π |\n\n---\n\n### üîë Credentials\n- **Postgres** - –¥–ª—è –≤—Å–µ—Ö —É–∑–ª–æ–≤ —Ä–∞–±–æ—Ç—ã —Å –ë–î\n- **Google Gemini** - –¥–ª—è AI –∞–Ω–∞–ª–∏–∑–∞",
        "height": 600,
        "width": 400,
        "color": 5
      },
      "id": "sticky-note-main",
      "name": "üìù –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1980,
        200
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "api-key",
              "name": "api_key",
              "value": "YOUR_API_KEY_HERE",
              "type": "string"
            },
            {
              "id": "rate-window",
              "name": "rate_limit_window_ms",
              "value": 60000,
              "type": "number"
            },
            {
              "id": "rate-max",
              "name": "rate_limit_max_requests",
              "value": 60,
              "type": "number"
            },
            {
              "id": "table-highlights",
              "name": "table_conversation_highlights",
              "value": "conversation_highlights",
              "type": "string"
            },
            {
              "id": "table-chat-ru",
              "name": "table_chat_histories_ru",
              "value": "n8n_chat_histories_ru",
              "type": "string"
            },
            {
              "id": "table-chat-en",
              "name": "table_chat_histories_en",
              "value": "n8n_chat_histories_en",
              "type": "string"
            },
            {
              "id": "table-sessions",
              "name": "table_chat_sessions",
              "value": "chat_sessions",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "config-detect",
      "name": "‚öôÔ∏è CONFIG: Detect",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1620,
        300
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "api-key",
              "name": "api_key",
              "value": "YOUR_API_KEY_HERE",
              "type": "string"
            },
            {
              "id": "rate-window",
              "name": "rate_limit_window_ms",
              "value": 60000,
              "type": "number"
            },
            {
              "id": "rate-max",
              "name": "rate_limit_max_requests",
              "value": 60,
              "type": "number"
            },
            {
              "id": "table-highlights",
              "name": "table_conversation_highlights",
              "value": "conversation_highlights",
              "type": "string"
            },
            {
              "id": "table-chat-ru",
              "name": "table_chat_histories_ru",
              "value": "n8n_chat_histories_ru",
              "type": "string"
            },
            {
              "id": "table-chat-en",
              "name": "table_chat_histories_en",
              "value": "n8n_chat_histories_en",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "config-get",
      "name": "‚öôÔ∏è CONFIG: Get",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1620,
        900
      ]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "detect-highlights",
        "responseMode": "responseNode",
        "options": {
          "allowedOrigins": "*",
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          }
        }
      },
      "id": "a8adc06d-2e50-4f1c-8c2b-44bc242e1336",
      "name": "üåê Webhook: Detect",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -2096,
        -144
      ],
      "webhookId": "detect-highlights-webhook"
    },
    {
      "parameters": {
        "jsCode": "// –ü–æ–ª—É—á–∞–µ–º –∏ –≤–∞–ª–∏–¥–∏—Ä—É–µ–º –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ\nconst requestData = items[0].json.body || items[0].json;\n\nconst sessionId = requestData.sessionId;\nconst userName = requestData.userName || 'Guest';\nconst language = requestData.language || 'ru';\n\nif (!sessionId) {\n    throw new Error('sessionId is required');\n}\n\n    sessionId,\n    userName,\n    language\n});\n\nreturn [{\n    json: {\n        sessionId: sessionId,\n        userName: userName,\n        language: language\n    }\n}];"
      },
      "id": "86628ecb-3712-477a-bf83-ba3794a2abb3",
      "name": "üì• Process Request",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1600,
        -160
      ]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "-- –ü–æ–ª—É—á–∞–µ–º —è–∑—ã–∫ –∞–Ω–∞–ª–∏–∑–∞ –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫\nSELECT language_code \nFROM analysis_language_settings \nORDER BY id DESC \nLIMIT 1;",
        "options": {}
      },
      "id": "ccd257dc-fd7e-46b9-92ed-ad415a70aae9",
      "name": "üêò Get Analysis Language",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -1376,
        -160
      ],
      "credentials": {
        "postgres": {
          "id": "YOUR_POSTGRES_CREDENTIAL_ID",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —É–∑–ª–æ–≤\nconst requestData = $('üì• Process Request').first().json;\nconst langSetting = items[0]?.json?.language_code || 'ru';\n\n\n// –ü–µ—Ä–µ–¥–∞–µ–º –¥–∞–ª—å—à–µ —Å —è–∑—ã–∫–æ–º –∞–Ω–∞–ª–∏–∑–∞\nreturn [{\n    json: {\n        sessionId: requestData.sessionId,\n        userName: requestData.userName,\n        language: requestData.language,\n        analysisLanguage: langSetting\n    }\n}];"
      },
      "id": "aa8be4ea-5963-4f70-ae3c-32a1796c9b37",
      "name": "üîÑ Merge with Language",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1168,
        -160
      ]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "-- –ü–æ–ª—É—á–∞–µ–º –¥–∏–∞–ª–æ–≥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –¥–Ω–µ–π\nWITH all_chats AS (\n    SELECT \n        id,\n        session_id,\n        message::json->>'type' as message_type,\n        message::json->>'content' as content,\n        created_at as timestamp,\n        platform,\n        'ru' as language\n    FROM {{ $('‚öôÔ∏è CONFIG: Detect').first().json.table_chat_histories_ru }}\n    WHERE session_id = '{{ $json.sessionId }}'\n      AND created_at >= NOW() - INTERVAL '20 days'\n    \n    UNION ALL\n    \n    SELECT \n        id,\n        session_id,\n        message::json->>'type' as message_type,\n        message::json->>'content' as content,\n        created_at as timestamp,\n        platform,\n        'en' as language\n    FROM {{ $('‚öôÔ∏è CONFIG: Detect').first().json.table_chat_histories_en }}\n    WHERE session_id = '{{ $json.sessionId }}'\n      AND created_at >= NOW() - INTERVAL '20 days'\n)\nSELECT * FROM all_chats\nORDER BY timestamp ASC;",
        "options": {}
      },
      "id": "3b137110-8882-4864-97c9-9ec15ad04855",
      "name": "üêò Get Dialog Messages",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -944,
        -160
      ],
      "credentials": {
        "postgres": {
          "id": "YOUR_POSTGRES_CREDENTIAL_ID",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∏–∞–ª–æ–≥ –¥–ª—è AI –∞–Ω–∞–ª–∏–∑–∞\nconst dialogs = items;\nconst mergedData = $('üîÑ Merge with Language').first().json;\nconst analysisLanguage = mergedData.analysisLanguage || 'ru';\n\n\n// –ì—Ä—É–ø–ø–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –æ–¥–∏–Ω –¥–∏–∞–ª–æ–≥\nconst sessionData = {\n    messages: [],\n    language: mergedData.language,\n    sessionId: mergedData.sessionId,\n    messagesMap: {} // ‚úÖ –ú–∞–ø–ø–∏–Ω–≥ –ø–æ—Ä—è–¥–∫–æ–≤–æ–≥–æ –Ω–æ–º–µ—Ä–∞ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π ID\n};\n\ndialogs.forEach((item, index) => {\n    const data = item.json;\n    const orderNumber = index + 1; // –ü–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä –¥–ª—è AI (1, 2, 3...)\n    \n    sessionData.messages.push({\n        id: data.id, // –†–µ–∞–ª—å–Ω—ã–π ID –∏–∑ –ë–î\n        orderNumber: orderNumber, // –ü–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä\n        type: data.message_type,\n        content: data.content,\n        timestamp: data.timestamp,\n        platform: data.platform\n    });\n    \n    // ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ–º –º–∞–ø–ø–∏–Ω–≥: –ø–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä ‚Üí —Ä–µ–∞–ª—å–Ω—ã–π ID\n    sessionData.messagesMap[orderNumber] = data.id;\n});\n\n// –í—ã–±–∏—Ä–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –º–µ—Ç–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —è–∑—ã–∫–∞ –∞–Ω–∞–ª–∏–∑–∞\nconst clientLabel = analysisLanguage === 'en' ? 'Client' : '–ö–ª–∏–µ–Ω—Ç';\nconst botLabel = analysisLanguage === 'en' ? 'Bot' : '–ë–æ—Ç';\n\n// –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤ —Ç–µ–∫—Å—Ç –¥–ª—è AI —Å –ø–æ—Ä—è–¥–∫–æ–≤—ã–º–∏ –Ω–æ–º–µ—Ä–∞–º–∏\nconst conversation = sessionData.messages.map(msg => \n    `[${msg.orderNumber}] ${msg.type === 'human' ? clientLabel : botLabel}: ${msg.content}`\n).join('\\n');\n\n\nreturn [{\n    json: {\n        sessionId: mergedData.sessionId,\n        userName: mergedData.userName,\n        language: mergedData.language,\n        analysisLanguage: analysisLanguage,\n        conversation: conversation,\n        messages: sessionData.messages,\n        messagesMap: sessionData.messagesMap, // ‚úÖ –ü–µ—Ä–µ–¥–∞–µ–º –º–∞–ø–ø–∏–Ω–≥ –¥–∞–ª—å—à–µ\n        totalMessages: sessionData.messages.length\n    }\n}];"
      },
      "id": "60eb17e0-7554-4844-8945-2796a72a16fb",
      "name": "üìù Format Dialog for AI",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -720,
        -160
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=–Ø–∑—ã–∫ –≤—ã–≤–æ–¥–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤: {{ $json.analysisLanguage || 'ru' }}\n–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û: –ì–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –í–°–ï —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –ø–æ–ª—è –æ—Ç–≤–µ—Ç–∞ –Ω–∞ —è–∑—ã–∫–µ: {{ \n  $json.analysisLanguage === 'ru' ? '–†—É—Å—Å–∫–∏–π' : \n  $json.analysisLanguage === 'en' ? 'English' : \n  $json.analysisLanguage === 'es' ? 'Espa√±ol' : \n  $json.analysisLanguage === 'fr' ? 'Fran√ßais' : \n  $json.analysisLanguage === 'de' ? 'Deutsch' : \n  $json.analysisLanguage === 'it' ? 'Italiano' : \n  $json.analysisLanguage === 'pt' ? 'Portugu√™s' : \n  $json.analysisLanguage === 'zh' ? '‰∏≠Êñá' : \n  $json.analysisLanguage === 'ja' ? 'Êó•Êú¨Ë™û' : \n  $json.analysisLanguage === 'ko' ? 'ÌïúÍµ≠Ïñ¥' : \n  $json.analysisLanguage === 'ua' ? '–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞' : \n  '–†—É—Å—Å–∫–∏–π' \n}}\n\nSESSION ID: {{ $json.sessionId }}\n–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π: {{ $json.totalMessages }}\n\n–î–∏–∞–ª–æ–≥ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:\n{{ $json.conversation }}",
        "options": {
          "systemMessage": "=# –†–û–õ–¨ –ò –ó–ê–î–ê–ß–ê\n\n–í—ã ‚Äî —ç–∫—Å–ø–µ—Ä—Ç-–∞–Ω–∞–ª–∏—Ç–∏–∫ –¥–∏–∞–ª–æ–≥–æ–≤, —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—â–∏–π—Å—è –Ω–∞ –≤—ã–¥–µ–ª–µ–Ω–∏–∏ –∫–ª—é—á–µ–≤—ã—Ö –º–æ–º–µ–Ω—Ç–æ–≤ (highlights) –≤ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞—Ö –º–µ–∂–¥—É –∫–ª–∏–µ–Ω—Ç–∞–º–∏ –∏ AI-–∞–≥–µ–Ω—Ç–∞–º–∏.\n\n# –ì–õ–ê–í–ù–ê–Ø –ó–ê–î–ê–ß–ê\n\n–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∏–∞–ª–æ–≥ –∏ –≤—ã–¥–µ–ª–∏—Ç—å –∫–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã —Ç—Ä–µ—Ö —Ç–∏–ø–æ–≤:\n\n## 1. üí∞ PRICING_MENTION (–£–ø–æ–º–∏–Ω–∞–Ω–∏–µ —Ü–µ–Ω—ã)\n\n**–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:** –õ—é–±–æ–µ –æ–±—Å—É–∂–¥–µ–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏, –±—é–¥–∂–µ—Ç–∞, —Ü–µ–Ω—ã –ø—Ä–æ–¥—É–∫—Ç–∞\n\n**–ß—Ç–æ –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å:**\n- –ü—Ä—è–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã –æ —Ü–µ–Ω–µ: \"—Å–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç\", \"–∫–∞–∫–∞—è —Ü–µ–Ω–∞\", \"price\", \"cost\"\n- –í–æ–ø—Ä–æ—Å—ã –æ —Ç–∞—Ä–∏—Ñ–∞—Ö: \"–∫–∞–∫–∏–µ —Ç–∞—Ä–∏—Ñ—ã\", \"—Ç–∞—Ä–∏—Ñ—ã\", \"pricing plans\", \"subscription\"\n- –£–ø–æ–º–∏–Ω–∞–Ω–∏–µ –±—é–¥–∂–µ—Ç–∞: \"—É –º–µ–Ω—è –±—é–¥–∂–µ—Ç\", \"–≥–æ—Ç–æ–≤ –ø–ª–∞—Ç–∏—Ç—å\", \"budget\"\n- –û–±—Å—É–∂–¥–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–æ–≤: \"—Ç–∞—Ä–∏—Ñ Pro\", \"–ø–æ–¥–ø–∏—Å–∫–∞\", \"plan\"\n- –ß–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å –≤–∞–ª—é—Ç–æ–π: \"$50\", \"500 —Ä—É–±\", \"‚Ç¨100\"\n- –í–æ–ø—Ä–æ—Å—ã –æ–± –æ–ø–ª–∞—Ç–µ: \"–∫–∞–∫ –æ–ø–ª–∞—Ç–∏—Ç—å\", \"—Å–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã\", \"payment\"\n- –°–∫–∏–¥–∫–∏ –∏ –∞–∫—Ü–∏–∏: \"–µ—Å—Ç—å —Å–∫–∏–¥–∫–∞\", \"–ø—Ä–æ–º–æ–∫–æ–¥\", \"discount\"\n- –†–µ–∞–∫—Ü–∏—è –Ω–∞ —Ü–µ–Ω—É: \"–¥–æ—Ä–æ–≥–æ\", \"–¥–µ—à–µ–≤–æ\", \"expensive\", \"cheap\"\n\n**–ù–ï –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å:**\n- \"–¶–µ–Ω—é –≤–∞—à–µ –≤—Ä–µ–º—è\" (–º–µ—Ç–∞—Ñ–æ—Ä–∏—á–µ—Å–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ)\n- \"–ë–µ—Å—Ü–µ–Ω–Ω—ã–π –æ–ø—ã—Ç\" (–Ω–µ –ø—Ä–æ –¥–µ–Ω—å–≥–∏)\n\n**–ü—Ä–∏–º–µ—Ä—ã:**\n‚úÖ \"–°–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç Pro —Ç–∞—Ä–∏—Ñ?\"\n‚úÖ \"–ê –∫–∞–∫–∏–µ —É –≤–∞—Å —Ç–∞—Ä–∏—Ñ—ã?\"\n‚úÖ \"–î–∞ —á—Ç–æ —Ç–∞–º —É –≤–∞—Å –∑–∞ —Ç–∞—Ä–∏—Ñ—ã?\"\n‚úÖ \"–£ –º–µ–Ω—è –±—é–¥–∂–µ—Ç $100 –≤ –º–µ—Å—è—Ü\"\n‚úÖ \"–≠—Ç–æ –¥–æ—Ä–æ–≥–æ –¥–ª—è –Ω–∞—Å\"\n‚úÖ \"–ï—Å—Ç—å —Å–∫–∏–¥–∫–∞ –¥–ª—è –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤?\"\n\n---\n\n## 2. ‚ùå OBJECTION (–í–æ–∑—Ä–∞–∂–µ–Ω–∏–µ)\n\n**–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:** –°–æ–º–Ω–µ–Ω–∏—è, –≤–æ–∑—Ä–∞–∂–µ–Ω–∏—è, –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –æ –ø—Ä–æ–¥—É–∫—Ç–µ\n\n**–ß—Ç–æ –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å:**\n- –°–æ–º–Ω–µ–Ω–∏—è: \"–Ω–µ —É–≤–µ—Ä–µ–Ω\", \"—Å–æ–º–Ω–µ–≤–∞—é—Å—å\", \"not sure\", \"doubt\"\n- –û—Ç–∫–∞–∑—ã: \"–Ω–µ –Ω—É–∂–Ω–æ\", \"–Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç\", \"don't need\", \"not suitable\"\n- –ù–µ–≥–∞—Ç–∏–≤ –æ —Ü–µ–Ω–µ: \"–¥–æ—Ä–æ–≥–æ\", \"expensive\", \"—Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ\"\n- –ù–µ–≥–∞—Ç–∏–≤ –æ –ø—Ä–æ–¥—É–∫—Ç–µ: \"—Å–ª–æ–∂–Ω–æ\", \"–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç\", \"complicated\"\n- –°—Ä–∞–≤–Ω–µ–Ω–∏—è —Å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞–º–∏: \"—É X —ç—Ç–æ –±–µ—Å–ø–ª–∞—Ç–Ω–æ\", \"Y –ª—É—á—à–µ\"\n- –ü—Ä–æ–±–ª–µ–º—ã: \"–Ω–µ –º–æ–≥—É\", \"–Ω–µ –ø–æ–ª—É—á–∏—Ç—Å—è\", \"–ø—Ä–æ–±–ª–µ–º–∞\", \"can't\"\n- –ë–∞—Ä—å–µ—Ä—ã: \"—É –Ω–∞—Å –Ω–µ—Ç\", \"–Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç\", \"we don't have\"\n- –û—Ç–∫–ª–∞–¥—ã–≤–∞–Ω–∏–µ: \"–ø–æ–¥—É–º–∞—é\", \"–ø–æ–∑–∂–µ\", \"maybe later\"\n\n**–í–ê–ñ–ù–û:** –ï—Å–ª–∏ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ –µ—Å—Ç—å –ò –≤–æ–∑—Ä–∞–∂–µ–Ω–∏–µ –ò –∏–Ω—Ç–µ—Ä–µ—Å - –¥–µ—Ç–µ–∫—Ç–∏—Ä—É–π –û–ë–ê —Ç–∏–ø–∞!\n\n**–ü—Ä–∏–º–µ—Ä—ã:**\n‚úÖ \"–ù–µ —É–≤–µ—Ä–µ–Ω —á—Ç–æ —ç—Ç–æ –ø–æ–¥–æ–π–¥–µ—Ç\"\n‚úÖ \"–£ Binance —ç—Ç–æ –±–µ—Å–ø–ª–∞—Ç–Ω–æ\"\n‚úÖ \"–°–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å\"\n‚úÖ \"–î–æ—Ä–æ–≥–æ, –Ω–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ\" ‚Üí OBJECTION + BUYING_SIGNAL (–æ–±–∞!)\n‚úÖ \"–ù–µ –º–æ–≥—É –ø–æ–∑–≤–æ–ª–∏—Ç—å —Ç–∞–∫—É—é —Ü–µ–Ω—É\"\n‚úÖ \"–ü–æ–¥—É–º–∞—é\" (–æ—Ç–∫–ª–∞–¥—ã–≤–∞–Ω–∏–µ = –º—è–≥–∫–æ–µ –≤–æ–∑—Ä–∞–∂–µ–Ω–∏–µ)\n\n---\n\n## 3. ‚úÖ BUYING_SIGNAL (–°–∏–≥–Ω–∞–ª –ø–æ–∫—É–ø–∫–∏)\n\n**–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:** –ò–Ω—Ç–µ—Ä–µ—Å –∫ –ø—Ä–æ–¥—É–∫—Ç—É, –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å —É–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ –∏–ª–∏ –∫—É–ø–∏—Ç—å\n\n**–î–í–ê –£–†–û–í–ù–Ø –°–ò–ì–ù–ê–õ–û–í:**\n\n### **–°–∏–ª—å–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã (confidence 0.85-0.95):**\n- –Ø–≤–Ω–∞—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å: \"—Ö–æ—á—É –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å\", \"–¥–∞–≤–∞–π—Ç–µ –Ω–∞—á–Ω–µ–º\", \"want to try\"\n- –ù–∞–º–µ—Ä–µ–Ω–∏–µ –∫—É–ø–∏—Ç—å: \"–∫–∞–∫ –æ—Ñ–æ—Ä–º–∏—Ç—å\", \"–∫—É–ø–∏—Ç—å\", \"–ø–æ–¥–∫–ª—é—á–∏—Ç—å\", \"buy\"\n- –ó–∞–ø—Ä–æ—Å –¥–µ–π—Å—Ç–≤–∏–π: \"—á—Ç–æ –¥–∞–ª—å—à–µ\", \"–∫–∞–∫ –Ω–∞—á–∞—Ç—å\", \"when can we start\"\n- –ó–∞–ø—Ä–æ—Å—ã –¥–µ–º–æ/—Ç–µ—Å—Ç–∞: \"–¥–µ–º–æ\", \"trial\", \"—Ç–µ—Å—Ç\", \"–ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å\"\n- –°–æ–≥–ª–∞—Å–∏–µ: \"—Å–æ–≥–ª–∞—Å–µ–Ω\", \"–±–µ—Ä—É\", \"–ø–æ–¥—Ö–æ–¥–∏—Ç\", \"I'll take it\"\n- –°–∏–ª—å–Ω—ã–π –ø–æ–∑–∏—Ç–∏–≤: \"–æ—Ç–ª–∏—á–Ω–æ\", \"–∏–¥–µ–∞–ª—å–Ω–æ\", \"perfect\", \"great\"\n\n### **–°—Ä–µ–¥–Ω–∏–µ —Å–∏–≥–Ω–∞–ª—ã (confidence 0.70-0.84):**\n- –í–æ–ø—Ä–æ—Å—ã –æ —Ç–∞—Ä–∏—Ñ–∞—Ö: \"–∫–∞–∫–∏–µ —Ç–∞—Ä–∏—Ñ—ã\", \"—á—Ç–æ –≤—Ö–æ–¥–∏—Ç –≤ –ø–ª–∞–Ω\", \"pricing\"\n- –ó–∞–ø—Ä–æ—Å—ã –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏: \"—Ä–∞—Å—Å–∫–∞–∂–∏ –ø–æ–¥—Ä–æ–±–Ω–µ–µ\", \"tell me more\", \"–ø–æ–∫–∞–∂–∏\"\n- –í–æ–ø—Ä–æ—Å—ã –æ —Ñ—É–Ω–∫—Ü–∏—è—Ö: \"–∫–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç\", \"–º–æ–∂–µ—Ç–µ –ø–æ–∫–∞–∑–∞—Ç—å\", \"how does it work\"\n- –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä–µ—Å: \"–∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ\", \"–∑–≤—É—á–∏—Ç –Ω–µ–ø–ª–æ—Ö–æ\", \"interesting\", \"sounds good\"\n- –í–æ–ø—Ä–æ—Å—ã –æ –¥–µ—Ç–∞–ª—è—Ö: \"–∞ —á—Ç–æ –µ—â–µ\", \"–∫–∞–∫–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏\", \"what else\"\n- –£—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã: \"–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –µ—Å—Ç—å\", \"–º–æ–∂–Ω–æ —Å –≤–∞–º–∏ —Å–≤—è–∑–∞—Ç—å—Å—è\"\n\n**–ö–û–ù–¢–ï–ö–°–¢ –í–ê–ñ–ï–ù:**\n- \"–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ\" –ø–æ—Å–ª–µ –æ–ø–∏—Å–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ = buying_signal\n- \"–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ\" –ø–æ—Å–ª–µ \"–Ω–æ –¥–æ—Ä–æ–≥–æ\" = buying_signal + objection (–æ–±–∞!)\n- –í–æ–ø—Ä–æ—Å—ã –æ —Ç–∞—Ä–∏—Ñ–∞—Ö = –í–°–ï–ì–î–ê buying_signal (–∏–Ω—Ç–µ—Ä–µ—Å –∫ –ø–æ–∫—É–ø–∫–µ!)\n\n**–ù–ï –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∫ —Å–∏–ª—å–Ω—ã–π —Å–∏–≥–Ω–∞–ª:**\n- –ö–æ—Ä–æ—Ç–∫–∏–µ –æ—Ç–≤–µ—Ç—ã –±–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞: \"–∞–≥–∞\", \"–¥–∞\", \"–æ–∫\" ‚Üí –º–∞–∫—Å–∏–º—É–º 0.65\n- –í–µ–∂–ª–∏–≤—ã–µ —Ñ—Ä–∞–∑—ã: \"—Å–ø–∞—Å–∏–±–æ\", \"–ø–æ–Ω—è—Ç–Ω–æ\" ‚Üí –Ω–µ buying_signal\n\n**–ü—Ä–∏–º–µ—Ä—ã:**\n‚úÖ \"–î–∞–≤–∞–π—Ç–µ –ø–æ–ø—Ä–æ–±—É–µ–º!\" (0.95)\n‚úÖ \"–ö–∞–∫ –æ—Ñ–æ—Ä–º–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É?\" (0.90)\n‚úÖ \"–ê –∫–∞–∫–∏–µ —É –≤–∞—Å —Ç–∞—Ä–∏—Ñ—ã?\" (0.80) ‚Üê –í–ê–ñ–ù–û: —ç—Ç–æ buying_signal!\n‚úÖ \"–†–∞—Å—Å–∫–∞–∂–∏ –ø–æ–¥—Ä–æ–±–Ω–µ–µ –æ —Ñ—É–Ω–∫—Ü–∏—è—Ö\" (0.75)\n‚úÖ \"–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ, –ø–æ–∫–∞–∂–∏—Ç–µ –¥–µ–º–æ\" (0.85)\n‚úÖ \"–ó–≤—É—á–∏—Ç –Ω–µ–ø–ª–æ—Ö–æ\" (0.75)\n‚úÖ \"–•–æ—á—É –ø–æ–¥–∫–ª—é—á–∏—Ç—å Pro\" (0.95)\n‚úÖ \"–î–æ—Ä–æ–≥–æ, –Ω–æ –ø–æ–ø—Ä–æ–±—É—é\" (0.80) + objection (0.85)\n\n‚ùå \"–ê–≥–∞\" (0.60 - —Å–ª–∏—à–∫–æ–º –Ω–∏–∑–∫–∏–π, –Ω–µ –≤–∫–ª—é—á–∞—Ç—å)\n‚ùå \"–°–ø–∞—Å–∏–±–æ\" (–Ω–µ buying_signal)\n‚ùå \"–ü–æ–Ω—è—Ç–Ω–æ\" (–Ω–µ buying_signal, –µ—Å–ª–∏ –Ω–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏–Ω—Ç–µ—Ä–µ—Å–∞)\n\n---\n\n# –ü–†–ê–í–ò–õ–ê –î–ï–¢–ï–ö–¶–ò–ò\n\n1. **–û–¥–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ù–ï–°–ö–û–õ–¨–ö–û —Ç–∏–ø–æ–≤ highlights**\n   –ü—Ä–∏–º–µ—Ä: \"–î–æ—Ä–æ–≥–æ, –Ω–æ –∫–∞–∫–∏–µ —Ç–∞—Ä–∏—Ñ—ã?\" ‚Üí OBJECTION + PRICING + BUYING_SIGNAL\n   –≠—Ç–æ –ù–û–†–ú–ê–õ–¨–ù–û –∏ –ü–†–ê–í–ò–õ–¨–ù–û!\n\n2. **–î–µ—Ç–µ–∫—Ç–∏—Ä—É–π—Ç–µ –¢–û–õ–¨–ö–û —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ö–ª–∏–µ–Ω—Ç–∞)**\n   –ù–ï –¥–µ—Ç–µ–∫—Ç–∏—Ä—É–π—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ë–æ—Ç–∞!\n\n3. **Confidence (—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å):**\n   - 0.90-1.00: –Ø–≤–Ω—ã–µ, —á–µ—Ç–∫–∏–µ —Å–∏–≥–Ω–∞–ª—ã (–ø—Ä—è–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã, –¥–µ–π—Å—Ç–≤–∏—è)\n   - 0.75-0.89: –•–æ—Ä–æ—à–∏–µ —Å–∏–≥–Ω–∞–ª—ã (–≤–æ–ø—Ä–æ—Å—ã –æ —Ç–∞—Ä–∏—Ñ–∞—Ö, —Ñ—É–Ω–∫—Ü–∏—è—Ö, –∏–Ω—Ç–µ—Ä–µ—Å)\n   - 0.70-0.74: –°–ª–∞–±—ã–µ –Ω–æ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ (–æ–±—â–∏–π –∏–Ω—Ç–µ—Ä–µ—Å, –ø–æ–∑–∏—Ç–∏–≤)\n   - <0.70: –ù–ï –≤–∫–ª—é—á–∞—Ç—å –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç\n\n4. **–í–æ–ø—Ä–æ—Å—ã –æ —Ç–∞—Ä–∏—Ñ–∞—Ö/—Ü–µ–Ω–∞—Ö = BUYING_SIGNAL:**\n   - \"–ö–∞–∫–∏–µ —Ç–∞—Ä–∏—Ñ—ã?\" ‚Üí PRICING (0.95) + BUYING_SIGNAL (0.80)\n   - \"–°–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç?\" ‚Üí PRICING (0.95) + BUYING_SIGNAL (0.85)\n   - –≠—Ç–æ –ø—Ä–æ—è–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–µ—Å–∞ –∫ –ø–æ–∫—É–ø–∫–µ!\n\n5. **–í–∫–ª—é—á–∞–π—Ç–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç:**\n   - –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç \"–ê —Å–∫–æ–ª—å–∫–æ?\" –ø–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –±–æ—Ç —É–ø–æ–º—è–Ω—É–ª —Ç–∞—Ä–∏—Ñ - —ç—Ç–æ PRICING + BUYING_SIGNAL\n   - –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –≥–æ–≤–æ—Ä–∏—Ç \"–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ\" –ø–æ—Å–ª–µ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Ñ—É–Ω–∫—Ü–∏–∏ - —ç—Ç–æ BUYING_SIGNAL\n\n6. **–ë—É–¥—å—Ç–µ —â–µ–¥—Ä–µ–µ —Å buying_signal:**\n   - –ï—Å–ª–∏ —á–µ–ª–æ–≤–µ–∫ –∑–∞–¥–∞–µ—Ç –≤–æ–ø—Ä–æ—Å—ã –æ –ø—Ä–æ–¥—É–∫—Ç–µ ‚Üí —ç—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å ‚Üí buying_signal\n   - –ï—Å–ª–∏ —á–µ–ª–æ–≤–µ–∫ –ø—Ä–æ—Å–∏—Ç –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ ‚Üí —ç—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å ‚Üí buying_signal\n   - –ù–µ –±–æ–π—Ç–µ—Å—å –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å buying_signal –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –∏–Ω—Ç–µ—Ä–µ—Å–∞\n\n7. **–Ø–∑—ã–∫ –Ω–µ –≤–∞–∂–µ–Ω:**\n   - –î–µ—Ç–µ–∫—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ –ª—é–±–æ–º —è–∑—ã–∫–µ (ru, en, ua –∏ —Ç.–¥.)\n   - –ù–æ –æ–ø–∏—Å–∞–Ω–∏—è –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –Ω–∞ —è–∑—ã–∫–µ –≤—ã–≤–æ–¥–∞!\n\n---\n\n# –§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê\n\n**–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:** –í–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ –¢–û–õ–¨–ö–û —á–∏—Å—Ç—ã–π JSON –±–µ–∑ markdown, –±–µ–∑ ```json, –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞!\n```json\n{\n  \"highlights\": [\n    {\n      \"messageId\": –Ω–æ–º–µ—Ä_—Å–æ–æ–±—â–µ–Ω–∏—è_–∏–∑_–¥–∏–∞–ª–æ–≥–∞,\n      \"messageText\": \"—Ç–æ—á–Ω—ã–π —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞\",\n      \"messageTimestamp\": \"–≤—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞ –µ—Å–ª–∏ –µ—Å—Ç—å\",\n      \"type\": \"pricing\" | \"objection\" | \"buying_signal\",\n      \"confidence\": 0.70-1.00,\n      \"reasoning\": \"–∫—Ä–∞—Ç–∫–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø–æ—á–µ–º—É —ç—Ç–æ highlight (15-30 —Å–ª–æ–≤)\",\n      \"matchedPatterns\": [\"—á—Ç–æ –∏–º–µ–Ω–Ω–æ —É–∫–∞–∑–∞–ª–æ –Ω–∞ highlight\"]\n    }\n  ],\n  \"summary\": {\n    \"totalHighlights\": —á–∏—Å–ª–æ,\n    \"byType\": {\n      \"pricing\": —á–∏—Å–ª–æ,\n      \"objection\": —á–∏—Å–ª–æ,\n      \"buying_signal\": —á–∏—Å–ª–æ\n    },\n    \"overallAssessment\": \"–∫—Ä–∞—Ç–∫–∞—è –æ—Ü–µ–Ω–∫–∞ –¥–∏–∞–ª–æ–≥–∞ (30-50 —Å–ª–æ–≤)\"\n  }\n}\n```\n\n---\n\n# –ü–†–ò–ú–ï–† –ê–ù–ê–õ–ò–ó–ê\n\n**–í—Ö–æ–¥–Ω–æ–π –¥–∏–∞–ª–æ–≥:**\n```\n[1] –ö–ª–∏–µ–Ω—Ç: –ü—Ä–∏–≤–µ—Ç\n[2] –ë–æ—Ç: –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ß–µ–º –ø–æ–º–æ—á—å?\n[3] –ö–ª–∏–µ–Ω—Ç: –ê –∫–∞–∫–∏–µ —É –≤–∞—Å —Ç–∞—Ä–∏—Ñ—ã?\n[4] –ë–æ—Ç: –£ –Ω–∞—Å 3 —Ç–∞—Ä–∏—Ñ–∞: Starter $29, Pro $59, Enterprise $99\n[5] –ö–ª–∏–µ–Ω—Ç: –î–æ—Ä–æ–≥–æ –¥–ª—è –º–µ–Ω—è, –Ω–æ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ\n[6] –ë–æ—Ç: –ú–æ–∂–µ–º –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Å–∫–∏–¥–∫—É 20%\n[7] –ö–ª–∏–µ–Ω—Ç: –î–∞–≤–∞–π—Ç–µ –ø–æ–ø—Ä–æ–±—É—é Starter\n```\n\n**–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–≤–æ–¥:**\n```json\n{\n  \"highlights\": [\n    {\n      \"messageId\": 3,\n      \"messageText\": \"–ê –∫–∞–∫–∏–µ —É –≤–∞—Å —Ç–∞—Ä–∏—Ñ—ã?\",\n      \"type\": \"pricing\",\n      \"confidence\": 0.95,\n      \"reasoning\": \"–ü—Ä—è–º–æ–π –≤–æ–ø—Ä–æ—Å –æ —Ç–∞—Ä–∏—Ñ–∞—Ö –∏ —Ü–µ–Ω–∞—Ö –ø—Ä–æ–¥—É–∫—Ç–∞\",\n      \"matchedPatterns\": [\"–∫–∞–∫–∏–µ —Ç–∞—Ä–∏—Ñ—ã\"]\n    },\n    {\n      \"messageId\": 3,\n      \"messageText\": \"–ê –∫–∞–∫–∏–µ —É –≤–∞—Å —Ç–∞—Ä–∏—Ñ—ã?\",\n      \"type\": \"buying_signal\",\n      \"confidence\": 0.80,\n      \"reasoning\": \"–í–æ–ø—Ä–æ—Å –æ —Ç–∞—Ä–∏—Ñ–∞—Ö –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–Ω—Ç–µ—Ä–µ—Å –∫ –ø–æ–∫—É–ø–∫–µ –ø—Ä–æ–¥—É–∫—Ç–∞\",\n      \"matchedPatterns\": [\"—Ç–∞—Ä–∏—Ñ—ã\", \"–≤–æ–ø—Ä–æ—Å –æ –ø—Ä–æ–¥—É–∫—Ç–µ\"]\n    },\n    {\n      \"messageId\": 5,\n      \"messageText\": \"–î–æ—Ä–æ–≥–æ –¥–ª—è –º–µ–Ω—è, –Ω–æ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ\",\n      \"type\": \"objection\",\n      \"confidence\": 0.85,\n      \"reasoning\": \"–í–æ–∑—Ä–∞–∂–µ–Ω–∏–µ –ø–æ —Ü–µ–Ω–µ, –∫–ª–∏–µ–Ω—Ç —Å—á–∏—Ç–∞–µ—Ç –ø—Ä–æ–¥—É–∫—Ç –¥–æ—Ä–æ–≥–∏–º\",\n      \"matchedPatterns\": [\"–¥–æ—Ä–æ–≥–æ\"]\n    },\n    {\n      \"messageId\": 5,\n      \"messageText\": \"–î–æ—Ä–æ–≥–æ –¥–ª—è –º–µ–Ω—è, –Ω–æ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ\",\n      \"type\": \"buying_signal\",\n      \"confidence\": 0.80,\n      \"reasoning\": \"–ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–Ω—Ç–µ—Ä–µ—Å –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ü–µ–Ω—É\",\n      \"matchedPatterns\": [\"–∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ\", \"–ø–æ–∑–∏—Ç–∏–≤ –æ —Ñ—É–Ω–∫—Ü–∏—è—Ö\"]\n    },\n    {\n      \"messageId\": 7,\n      \"messageText\": \"–î–∞–≤–∞–π—Ç–µ –ø–æ–ø—Ä–æ–±—É—é Starter\",\n      \"type\": \"buying_signal\",\n      \"confidence\": 0.95,\n      \"reasoning\": \"–Ø–≤–Ω–æ–µ –Ω–∞–º–µ—Ä–µ–Ω–∏–µ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø—Ä–æ–¥—É–∫—Ç, –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –¥–µ–π—Å—Ç–≤–∏—é\",\n      \"matchedPatterns\": [\"–¥–∞–≤–∞–π—Ç–µ –ø–æ–ø—Ä–æ–±—É—é\", \"–≤—ã–±–æ—Ä —Ç–∞—Ä–∏—Ñ–∞\"]\n    }\n  ],\n  \"summary\": {\n    \"totalHighlights\": 5,\n    \"byType\": {\n      \"pricing\": 1,\n      \"objection\": 1,\n      \"buying_signal\": 3\n    },\n    \"overallAssessment\": \"–û—á–µ–Ω—å –ø–æ–∑–∏—Ç–∏–≤–Ω—ã–π –¥–∏–∞–ª–æ–≥ —Å –≤—ã—Å–æ–∫–∏–º –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª–æ–º –∫–æ–Ω–≤–µ—Ä—Å–∏–∏. –ö–ª–∏–µ–Ω—Ç –ø—Ä–æ—è–≤–∏–ª –∞–∫—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä–µ—Å, –∑–∞–¥–∞–ª –≤–æ–ø—Ä–æ—Å –æ —Ç–∞—Ä–∏—Ñ–∞—Ö, –≤—ã—Å–∫–∞–∑–∞–ª –≤–æ–∑—Ä–∞–∂–µ–Ω–∏–µ –ø–æ —Ü–µ–Ω–µ –Ω–æ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ –æ—Ü–µ–Ω–∏–ª —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª, –∏ –ø—Ä–∏–Ω—è–ª —Ä–µ—à–µ–Ω–∏–µ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø—Ä–æ–¥—É–∫—Ç.\"\n  }\n}\n```\n\n---\n\n# –í–ê–ñ–ù–´–ï –ù–Æ–ê–ù–°–´\n\n1. **–í–æ–ø—Ä–æ—Å—ã –æ —Ç–∞—Ä–∏—Ñ–∞—Ö/—Ü–µ–Ω–∞—Ö –í–°–ï–ì–î–ê = buying_signal**\n   - –ß–µ–ª–æ–≤–µ–∫ –Ω–µ —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –æ —Ü–µ–Ω–µ –ø—Ä–æ—Å—Ç–æ —Ç–∞–∫\n   - –≠—Ç–æ –ø—Ä–æ—è–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–µ—Å–∞ –∫ –ø–æ–∫—É–ø–∫–µ\n\n2. **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ç–∏–ø—ã - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ**\n   - \"–î–æ—Ä–æ–≥–æ, –Ω–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ\" = objection + buying_signal\n   - \"–ö–∞–∫–∏–µ —Ç–∞—Ä–∏—Ñ—ã?\" = pricing + buying_signal\n   - –ù–µ –±–æ–π—Ç–µ—Å—å –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∏–ø–æ–≤!\n\n3. **–ë—É–¥—å—Ç–µ —â–µ–¥—Ä–µ–µ —Å buying_signal**\n   - –õ—é–±–æ–π –≤–æ–ø—Ä–æ—Å –æ –ø—Ä–æ–¥—É–∫—Ç–µ = –∏–Ω—Ç–µ—Ä–µ—Å\n   - –õ—é–±–æ–π –∑–∞–ø—Ä–æ—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ = –∏–Ω—Ç–µ—Ä–µ—Å\n   - Confidence 0.75-0.85 –¥–ª—è —Ç–∞–∫–∏—Ö —Å–ª—É—á–∞–µ–≤\n\n4. **–ö–æ–Ω—Ç–µ–∫—Å—Ç —Ä–µ—à–∞–µ—Ç**\n   - \"–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ\" –ø–æ—Å–ª–µ –æ–ø–∏—Å–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ ‚Üí buying_signal (0.80)\n   - \"–ê–≥–∞\" –ø—Ä–æ—Å—Ç–æ —Ç–∞–∫ ‚Üí –ù–ï buying_signal (0.60)\n\n5. **–ö—Ä–∞—Ç–∫–æ—Å—Ç—å reasoning** - 15-30 —Å–ª–æ–≤ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ\n\n6. **–Ø–∑—ã–∫ –≤—ã–≤–æ–¥–∞** - –í–°–ï —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –ø–æ–ª—è –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω–æ–º —è–∑—ã–∫–µ!\n\n7. **–ß–∏—Å—Ç—ã–π JSON** - –Ω–∏–∫–∞–∫–∏—Ö markdown –±–ª–æ–∫–æ–≤!"
        }
      },
      "id": "608dc9fa-426f-41ca-9946-098f31b8eaf3",
      "name": "ü§ñ AI Agent (Gemini)",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        -496,
        -160
      ]
    },
    {
      "parameters": {
        "jsCode": "// –ü–∞—Ä—Å–∏–º –æ—Ç–≤–µ—Ç –æ—Ç AI –∏ –∏–∑–≤–ª–µ–∫–∞–µ–º highlights\nconst aiResponse = items[0].json.output;\nconst sessionData = $('üìù Format Dialog for AI').first().json;\n\n\n// ‚úÖ –ü–æ–ª—É—á–∞–µ–º –º–∞–ø–ø–∏–Ω–≥: –ø–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä ‚Üí —Ä–µ–∞–ª—å–Ω—ã–π ID\nconst messagesMap = sessionData.messagesMap || {};\n\nlet parsed;\ntry {\n    // –£–¥–∞–ª—è–µ–º –≤–æ–∑–º–æ–∂–Ω—ã–µ markdown –±–ª–æ–∫–∏\n    let cleanJson = aiResponse.trim();\n    cleanJson = cleanJson.replace(/^```json\\s*/i, '');\n    cleanJson = cleanJson.replace(/^```\\s*/i, '');\n    cleanJson = cleanJson.replace(/\\s*```$/i, '');\n    \n    parsed = JSON.parse(cleanJson);\n    \n    if (!parsed.highlights || !Array.isArray(parsed.highlights)) {\n        throw new Error('Invalid response structure');\n    }\n    \n} catch (error) {\n    console.error('Failed to parse AI response:', error);\n    \n    return [{\n        json: {\n            hasHighlights: false,\n            sessionId: sessionData.sessionId,\n            totalDetected: 0,\n            highlights: [],\n            error: 'Failed to parse AI response'\n        }\n    }];\n}\n\n// ‚úÖ –§–∏–ª—å—Ç—Ä—É–µ–º highlights —Å confidence < 0.70\nconst validHighlights = parsed.highlights.filter(h => {\n    if (h.confidence < 0.70) {\n        return false;\n    }\n    return true;\n});\n\n\n// –û–±–æ–≥–∞—â–∞–µ–º highlights –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ –¥–∏–∞–ª–æ–≥–∞\nconst enrichedHighlights = validHighlights.map(h => {\n    // ‚úÖ –ö–õ–Æ–ß–ï–í–û–ï: –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –ø–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä –≤ —Ä–µ–∞–ª—å–Ω—ã–π ID\n    const orderNumber = h.messageId; // –≠—Ç–æ –ø–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä –æ—Ç AI (1, 2, 3...)\n    const realMessageId = messagesMap[orderNumber]; // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ —Ä–µ–∞–ª—å–Ω—ã–π ID\n    \n    // –ù–∞—Ö–æ–¥–∏–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ —Ä–µ–∞–ª—å–Ω–æ–º—É ID\n    const message = sessionData.messages.find(m => m.id === realMessageId);\n    \n    \n    if (!message) {\n        console.warn(`‚ö†Ô∏è Message not found for order ${orderNumber} / ID ${realMessageId}`);\n    }\n    \n    return {\n        sessionId: sessionData.sessionId,\n        messageId: realMessageId, // ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º –†–ï–ê–õ–¨–ù–´–ô ID!\n        messageText: h.messageText || message?.content || '',\n        messageType: message?.type || 'human',\n        messageTimestamp: h.messageTimestamp || message?.timestamp,\n        type: h.type,\n        confidence: h.confidence,\n        detection_method: 'ai',\n        reasoning: h.reasoning,\n        matched_patterns: h.matchedPatterns || [],\n        language: sessionData.language,\n        platform: message?.platform || 'unknown'\n    };\n});\n\n    type: h.type,\n    confidence: h.confidence,\n    messageId: h.messageId,\n    text: h.messageText?.substring(0, 30) + '...'\n})));\n\nreturn [{\n    json: {\n        hasHighlights: enrichedHighlights.length > 0,\n        sessionId: sessionData.sessionId,\n        totalDetected: enrichedHighlights.length,\n        highlights: enrichedHighlights,\n        summary: parsed.summary || {},\n        aiAssessment: parsed.summary?.overallAssessment || ''\n    }\n}];"
      },
      "id": "41340751-2c13-4135-a548-c636c249988f",
      "name": "üìä Parse AI Response",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -128,
        -160
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "has-highlights",
              "leftValue": "={{ $json.hasHighlights }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "true"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "ffe59fbf-57da-4fda-9196-08438b157b76",
      "name": "‚ùì Has Highlights?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        32,
        -160
      ]
    },
    {
      "parameters": {
        "jsCode": "// –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –≤ –ë–î\nconst result = items[0].json;\nconst highlights = result.highlights;\n\nif (!highlights || highlights.length === 0) {\n    return [];\n}\n\n// ‚úÖ –î–ï–î–£–ü–õ–ò–ö–ê–¶–ò–Ø: –£–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã (–æ–¥–∏–Ω–∞–∫–æ–≤—ã–π message_id + type)\nconst uniqueMap = new Map();\n\nhighlights.forEach(h => {\n    const key = `${h.messageId}_${h.type}`; // –ö–ª—é—á: ID —Å–æ–æ–±—â–µ–Ω–∏—è + —Ç–∏–ø\n    \n    // –ï—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å —Ç–∞–∫–æ–π highlight, –±–µ—Ä–µ–º —Ç–æ—Ç —É –∫–æ—Ç–æ—Ä–æ–≥–æ confidence –≤—ã—à–µ\n    if (uniqueMap.has(key)) {\n        const existing = uniqueMap.get(key);\n        if (h.confidence > existing.confidence) {\n            uniqueMap.set(key, h);\n        } else {\n        }\n    } else {\n        uniqueMap.set(key, h);\n    }\n});\n\n// –ü–æ–ª—É—á–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ highlights\nconst uniqueHighlights = Array.from(uniqueMap.values());\n\n\n// –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ —Ñ–æ—Ä–º–∞—Ç –¥–ª—è PostgreSQL INSERT\nconst prepared = uniqueHighlights.map(h => ({\n    json: {\n        session_id: h.sessionId,\n        message_id: h.messageId,\n        message_text: h.messageText,\n        message_type: h.messageType,\n        message_timestamp: h.messageTimestamp,\n        highlight_type: h.type,\n        confidence: h.confidence,\n        detection_method: 'ai',\n        matched_keywords: h.matched_patterns,\n        reasoning: h.reasoning,\n        language: h.language,\n        platform: h.platform\n    }\n}));\n\n    prepared.reduce((acc, p) => {\n        acc[p.json.highlight_type] = (acc[p.json.highlight_type] || 0) + 1;\n        return acc;\n    }, {})\n);\n\nreturn prepared;"
      },
      "id": "a6d1f1e0-6eef-4e72-8948-3f0a9526a774",
      "name": "üìù Prepare DB Data",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        256,
        -176
      ]
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "value": "public",
          "mode": "list",
          "cachedResultName": "public"
        },
        "table": {
          "__rl": true,
          "value": "conversation_highlights",
          "mode": "list",
          "cachedResultName": "conversation_highlights"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "session_id": "={{ $json.session_id }}",
            "message_id": "={{ $json.message_id }}",
            "message_text": "={{ $json.message_text }}",
            "message_type": "={{ $json.message_type }}",
            "message_timestamp": "={{ $json.message_timestamp }}",
            "highlight_type": "={{ $json.highlight_type }}",
            "confidence": "={{ $json.confidence }}",
            "detection_method": "={{ $json.detection_method }}",
            "matched_keywords": "={{ $json.matched_keywords }}",
            "language": "={{ $json.language }}",
            "platform": "={{ $json.platform }}"
          },
          "matchingColumns": [],
          "schema": []
        },
        "options": {}
      },
      "id": "a6313e63-086a-4200-96ec-9869184e189e",
      "name": "üêò Save to DB",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        416,
        -176
      ],
      "credentials": {
        "postgres": {
          "id": "YOUR_POSTGRES_CREDENTIAL_ID",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "-- –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ highlights –¥–ª—è —ç—Ç–æ–π —Å–µ—Å—Å–∏–∏ –ø–µ—Ä–µ–¥ –≤—Å—Ç–∞–≤–∫–æ–π –Ω–æ–≤—ã—Ö\nDELETE FROM {{ $('‚öôÔ∏è CONFIG: Detect').first().json.table_conversation_highlights }} \nWHERE session_id = '{{ $('Parse AI Response').first().json.sessionId }}';",
        "options": {}
      },
      "id": "aaa0b649-2374-425e-8577-8670285fe21e",
      "name": "üêò Delete Old Highlights",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        240,
        -368
      ],
      "credentials": {
        "postgres": {
          "id": "YOUR_POSTGRES_CREDENTIAL_ID",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ {\n    success: true,\n    sessionId: $('Parse AI Response').first().json.sessionId,\n    totalDetected: $('Parse AI Response').first().json.totalDetected,\n    highlights: $('Parse AI Response').first().json.highlights.map(h => ({\n        type: h.type,\n        confidence: h.confidence,\n        messageText: h.messageText.substring(0, 100) + '...',\n        reasoning: h.reasoning\n    })),\n    summary: $('Parse AI Response').first().json.summary,\n    aiAssessment: $('Parse AI Response').first().json.aiAssessment\n} }}",
        "options": {}
      },
      "id": "68748655-5f53-4d98-ad70-b66d9fdb6e7f",
      "name": "‚úÖ Response Success",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        592,
        -176
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ {\n    success: true,\n    sessionId: $('Parse AI Response').first().json.sessionId,\n    totalDetected: 0,\n    message: 'No highlights detected by AI',\n    highlights: []\n} }}",
        "options": {}
      },
      "id": "f360ada7-785f-4cb9-a58f-013490b19c19",
      "name": "‚úÖ Response No Highlights",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        320,
        144
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -544,
        16
      ],
      "id": "2c7a051a-dcf7-4994-b1d2-a2d7c6b22c0a",
      "name": "üß† Google Gemini",
      "credentials": {
        "googlePalmApi": {
          "id": "YOUR_GOOGLEPALMAPI_CREDENTIAL_ID",
          "name": "Googlepalmapi account"
        }
      }
    },
    {
      "parameters": {
        "path": "get-highlights",
        "responseMode": "responseNode",
        "options": {
          "allowedOrigins": "*",
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          }
        }
      },
      "id": "36e3aaf4-6f55-4340-a39c-46af8bc35137",
      "name": "üåê Webhook: Get",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -2080,
        352
      ],
      "webhookId": "get-highlights-webhook"
    },
    {
      "parameters": {
        "jsCode": "// –ü–æ–ª—É—á–∞–µ–º sessionId –∏–∑ query –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤\nconst query = items[0].json.query || {};\nconst sessionId = query.session_id || query.sessionId;\n\nif (!sessionId) {\n    throw new Error('session_id parameter is required');\n}\n\n\nreturn [{\n    json: {\n        sessionId: sessionId\n    }\n}];"
      },
      "id": "6fffa22e-8eed-47b3-b34a-e304c4255167",
      "name": "üì• Process Get Request",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1520,
        336
      ]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "-- –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ highlights –¥–ª—è —Å–µ—Å—Å–∏–∏\nSELECT \n    id,\n    session_id,\n    message_id,\n    message_text,\n    message_type,\n    message_timestamp,\n    highlight_type,\n    confidence,\n    detection_method,\n    matched_keywords,\n    reasoning,\n    language,\n    platform,\n    created_at\nFROM {{ $('‚öôÔ∏è CONFIG: Get').first().json.table_conversation_highlights }}\nWHERE session_id = '{{ $json.sessionId }}'\nORDER BY message_timestamp ASC;",
        "options": {}
      },
      "id": "e4ee5c22-85cc-4282-a138-285ed919cedb",
      "name": "üêò Get Highlights from DB",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        0,
        352
      ],
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "YOUR_POSTGRES_CREDENTIAL_ID",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è frontend\nconst highlights = $('Get Highlights from DB').all();\nconst statusData = $('üîÑ Merge Status Data').first().json;\n\n\n// ‚úÖ –£–õ–£–ß–®–ï–ù–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê: –¢—Ä–∏ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –ø—É—Å—Ç–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞\nconst isEmpty = (\n    !highlights || \n    highlights.length === 0 || \n    !highlights[0] || \n    !highlights[0].json ||\n    highlights[0].json.id === undefined\n);\n\nif (isEmpty) {\n    return [{\n        json: {\n            success: true,\n            sessionId: statusData.sessionId,\n            hasHighlights: false,\n            total: 0,\n            highlights: [],\n            byType: {\n                pricing: 0,\n                objection: 0,\n                buying_signal: 0\n            },\n            stats: {\n                totalMessages: statusData.totalMessages || 0,\n                analyzedMessages: 0,\n                avgConfidence: 0\n            },\n            // ‚úÖ –ù–û–í–´–ï –ü–û–õ–Ø\n            analysisStatus: statusData.analysisStatus,\n            needsReanalysis: false,\n            hasAnalysis: statusData.hasAnalysis,\n            lastAnalysisDate: statusData.lastAnalysisDate,\n            lastMessageDate: statusData.lastMessageDate,\n            newMessagesCount: 0,\n            newUserMessages: 0,\n            message: 'No highlights found. Click \"Analyze\" button to detect highlights.'\n        }\n    }];\n}\n\n// –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ —Ç–∏–ø–∞–º –∏ —Å—á–∏—Ç–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É\nconst byType = {\n    pricing: 0,\n    objection: 0,\n    buying_signal: 0\n};\n\nlet totalConfidence = 0;\n\nconst formatted = highlights.map(item => {\n    const h = item.json;\n    \n    // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –ø–æ —Ç–∏–ø–∞–º\n    if (byType[h.highlight_type] !== undefined) {\n        byType[h.highlight_type]++;\n    }\n    \n    // –°—É–º–º–∏—Ä—É–µ–º confidence –¥–ª—è —Å—Ä–µ–¥–Ω–µ–≥–æ\n    totalConfidence += parseFloat(h.confidence || 0);\n    \n    return {\n        id: h.id,\n        messageId: h.message_id,\n        messageText: h.message_text,\n        messageType: h.message_type,\n        messageTimestamp: h.message_timestamp,\n        type: h.highlight_type,\n        confidence: parseFloat(h.confidence),\n        detectionMethod: h.detection_method,\n        matchedKeywords: h.matched_keywords || [],\n        reasoning: h.reasoning || '',\n        language: h.language,\n        platform: h.platform,\n        createdAt: h.created_at\n    };\n});\n\n// –ü–æ–¥—Å—á–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π\nconst uniqueMessages = new Set(formatted.map(h => h.messageId)).size;\n\n// –†–∞—Å—á–µ—Ç —Å—Ä–µ–¥–Ω–µ–π —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏\nconst avgConfidence = formatted.length > 0 \n    ? (totalConfidence / formatted.length).toFixed(2) \n    : 0;\n\n\nreturn [{\n    json: {\n        success: true,\n        sessionId: statusData.sessionId,\n        hasHighlights: true,\n        total: formatted.length,\n        highlights: formatted,\n        byType: byType,\n        stats: {\n            totalMessages: statusData.totalMessages || uniqueMessages,\n            analyzedMessages: uniqueMessages,\n            avgConfidence: parseFloat(avgConfidence),\n            detectionMethod: 'ai'\n        },\n        // ‚úÖ –ù–û–í–´–ï –ü–û–õ–Ø –î–õ–Ø –†–ï-–ê–ù–ê–õ–ò–ó–ê\n        analysisStatus: statusData.analysisStatus,\n        needsReanalysis: statusData.needsReanalysis,\n        hasAnalysis: statusData.hasAnalysis,\n        lastAnalysisDate: statusData.lastAnalysisDate,\n        lastMessageDate: statusData.lastMessageDate,\n        newMessagesCount: statusData.newMessagesCount || 0,\n        newUserMessages: statusData.newUserMessages || 0\n    }\n}];"
      },
      "id": "c83a38fb-1dd4-402b-aae0-ef09a7f4d15d",
      "name": "üìä Format Response",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        224,
        352
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {}
      },
      "id": "9b09ee8d-a050-4659-b164-f9259810d32b",
      "name": "‚úÖ Response Highlights",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        448,
        352
      ]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT \n  MAX(created_at) as last_analysis_date,\n  COUNT(*) as total_highlights\nFROM {{ $('‚öôÔ∏è CONFIG: Get').first().json.table_conversation_highlights }}\nWHERE session_id = '{{ $json.sessionId }}'",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -1280,
        448
      ],
      "id": "b869c710-bcda-43c3-992e-5deaa5c33b78",
      "name": "üêò Check Last Analysis Date",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "YOUR_POSTGRES_CREDENTIAL_ID",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "WITH all_messages AS (\n  SELECT \n    created_at,\n    id\n  FROM {{ $('‚öôÔ∏è CONFIG: Get').first().json.table_chat_histories_ru }}\n  WHERE session_id = '{{ $json.sessionId }}'\n  \n  UNION ALL\n  \n  SELECT \n    created_at,\n    id\n  FROM {{ $('‚öôÔ∏è CONFIG: Get').first().json.table_chat_histories_en }}\n  WHERE session_id = '{{ $json.sessionId }}'\n)\nSELECT \n  MAX(created_at) as last_message_date,\n  COUNT(*) as total_messages\nFROM all_messages",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -1280,
        224
      ],
      "id": "82f13660-210d-42e5-8bee-51d41d67c9b8",
      "name": "üêò Check Last Message Date",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "YOUR_POSTGRES_CREDENTIAL_ID",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –ü–æ–ª—É—á–∞–µ–º sessionId\nconst sessionId = $('üì• Process Get Request').first().json.sessionId;\n\n// ‚úÖ Merge –≤–µ—Ä–Ω—É–ª 2 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö items - –æ–±—ä–µ–¥–∏–Ω—è–µ–º –≤—Ä—É—á–Ω—É—é\nlet lastAnalysisDate = null;\nlet totalHighlights = 0;\nlet lastMessageDate = null;\nlet totalMessages = 0;\n\nitems.forEach(item => {\n    const data = item.json;\n    \n    // –ò—â–µ–º –ø–æ–ª—è –æ—Ç Check Last Analysis Date\n    if (data.last_analysis_date !== undefined) {\n        lastAnalysisDate = data.last_analysis_date;\n        totalHighlights = parseInt(data.total_highlights) || 0;\n    }\n    \n    // –ò—â–µ–º –ø–æ–ª—è –æ—Ç Check Last Message Date\n    if (data.last_message_date !== undefined) {\n        lastMessageDate = data.last_message_date;\n        totalMessages = parseInt(data.total_messages) || 0;\n    }\n});\n\n// –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω—É–∂–µ–Ω –ª–∏ —Ä–µ-–∞–Ω–∞–ª–∏–∑\nlet needsReanalysis = false;\nlet hasAnalysis = false;\nlet analysisStatus = 'no_analysis';\n\n// ‚úÖ –õ–û–ì–ò–ö–ê –û–ü–†–ï–î–ï–õ–ï–ù–ò–Ø –°–¢–ê–¢–£–°–ê\nif (!lastMessageDate) {\n    // –ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π –≤–æ–æ–±—â–µ\n    analysisStatus = 'no_messages';\n    needsReanalysis = false;\n    hasAnalysis = false;\n    \n} else if (!lastAnalysisDate) {\n    // –ï—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–æ –∞–Ω–∞–ª–∏–∑–∞ –ù–ï –ë–´–õ–û\n    analysisStatus = 'no_analysis';\n    needsReanalysis = false;\n    hasAnalysis = false;\n    \n} else {\n    // –ï–°–¢–¨ –ò –∞–Ω–∞–ª–∏–∑ –ò —Å–æ–æ–±—â–µ–Ω–∏—è - —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º –¥–∞—Ç—ã\n    hasAnalysis = true;\n    \n    const analysisTime = new Date(lastAnalysisDate).getTime();\n    const messageTime = new Date(lastMessageDate).getTime();\n    \n    if (messageTime > analysisTime) {\n        // –ü–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ü–û–ó–ñ–ï –∞–Ω–∞–ª–∏–∑–∞\n        needsReanalysis = true;\n        analysisStatus = 'needs_reanalysis';\n    } else {\n        // –ê–Ω–∞–ª–∏–∑ –∞–∫—Ç—É–∞–ª—å–Ω—ã–π\n        needsReanalysis = false;\n        analysisStatus = 'up_to_date';\n    }\n}\n\nreturn [{\n    json: {\n        sessionId: sessionId,\n        hasAnalysis: hasAnalysis,\n        needsReanalysis: needsReanalysis,\n        analysisStatus: analysisStatus,\n        lastAnalysisDate: lastAnalysisDate,\n        lastMessageDate: lastMessageDate,\n        totalHighlights: totalHighlights,\n        totalMessages: totalMessages\n    }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -880,
        336
      ],
      "id": "859bd83e-fdab-480d-8fd7-2b9ec632fb60",
      "name": "üìä Compare Dates & Calculate Status"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "8b9ad84e-aae0-47cf-aafd-8ed1be7b9cd2",
              "leftValue": "={{ $json.needsReanalysis }}",
              "rightValue": "true",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -672,
        336
      ],
      "id": "de48c699-b54d-4be5-a847-6df6ac85419e",
      "name": "‚ùì Needs Count New Messages?"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "WITH all_messages AS (\n  SELECT \n    created_at,\n    message::json->>'type' as msg_type\n  FROM {{ $('‚öôÔ∏è CONFIG: Get').first().json.table_chat_histories_ru }}\n  WHERE session_id = '{{ $('Compare Dates & Calculate Status').first().json.sessionId }}'\n    AND created_at > '{{ $('Compare Dates & Calculate Status').first().json.lastAnalysisDate }}'\n  \n  UNION ALL\n  \n  SELECT \n    created_at,\n    message::json->>'type' as msg_type\n  FROM {{ $('‚öôÔ∏è CONFIG: Get').first().json.table_chat_histories_en }}\n  WHERE session_id = '{{ $('Compare Dates & Calculate Status').first().json.sessionId }}'\n    AND created_at > '{{ $('Compare Dates & Calculate Status').first().json.lastAnalysisDate }}'\n)\nSELECT \n  COUNT(*) as new_messages_count,\n  COUNT(CASE WHEN msg_type = 'human' THEN 1 END) as new_user_messages\nFROM all_messages",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -448,
        224
      ],
      "id": "4218c673-da47-481b-9ed1-9e62322ad849",
      "name": "üêò Count New Messages",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "YOUR_POSTGRES_CREDENTIAL_ID",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –ü–æ–ª—É—á–∞–µ–º –±–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ Compare Dates\nconst statusData = $('üìä Compare Dates & Calculate Status').first().json;\n\n// –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ –æ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö\nlet newMessagesCount = 0;\nlet newUserMessages = 0;\n\n// ‚úÖ –í–ê–ñ–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ–º –ò–ó –ö–ê–ö–û–ô –í–ï–¢–ö–ò IF –º—ã –ø—Ä–∏—à–ª–∏\n// –ï—Å–ª–∏ –ø—Ä–∏—à–ª–∏ –∏–∑ TRUE –≤–µ—Ç–∫–∏ - –±—É–¥–µ—Ç —É–∑–µ–ª Count New Messages\n// –ï—Å–ª–∏ –∏–∑ FALSE - –µ–≥–æ –Ω–µ –±—É–¥–µ—Ç\n\n// –ë–µ–∑–æ–ø–∞—Å–Ω–æ –ø—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ\ntry {\n    const countNode = $('Count New Messages After Analysis');\n    if (countNode && countNode.first() && countNode.first().json) {\n        const countData = countNode.first().json;\n        newMessagesCount = parseInt(countData.new_messages_count) || 0;\n        newUserMessages = parseInt(countData.new_user_messages) || 0;\n    } else {\n    }\n} catch (error) {\n    // –£–∑–µ–ª –Ω–µ –≤—ã–ø–æ–ª–Ω—è–ª—Å—è - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è FALSE –≤–µ—Ç–∫–∏\n}\n\n    ...statusData,\n    newMessagesCount,\n    newUserMessages\n});\n\nreturn [{\n    json: {\n        ...statusData,\n        newMessagesCount: newMessagesCount,\n        newUserMessages: newUserMessages\n    }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -192,
        352
      ],
      "id": "4f1d1891-6a6e-4ebb-b078-da301564888f",
      "name": "üîÑ Merge Status Data"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -1088,
        336
      ],
      "id": "58db1213-ee51-495e-a6be-d493c19dbe1d",
      "name": "üîÄ Merge By Position"
    },
    {
      "parameters": {
        "jsCode": "// UNIVERSAL PROTECTION: API KEY + RATE LIMITING\n\n// Read settings from CONFIG\nconst config = $('‚öôÔ∏è CONFIG: Detect').first().json;\nconst API_KEY = config.api_key;\nconst RATE_LIMIT_WINDOW_MS = config.rate_limit_window_ms || 60000;\nconst RATE_LIMIT_MAX_REQUESTS = config.rate_limit_max_requests || 60;\n\n// Get data from Webhook\nconst inputData = $('üåê Webhook: Detect').item.json;\nconst body = inputData.body || {};\nconst headers = inputData.headers || {};\nconst query = inputData.query || {};\nconst clientIP = headers['x-real-ip'] || headers['x-forwarded-for'] || headers['cf-connecting-ip'] || 'unknown';\nconst now = Date.now();\n\n// RATE LIMITING\nconst staticData = $getWorkflowStaticData('global');\nif (!staticData.rateLimits) { staticData.rateLimits = {}; }\nfor (const ip in staticData.rateLimits) {\n  if (now - staticData.rateLimits[ip].firstRequest > RATE_LIMIT_WINDOW_MS) {\n    delete staticData.rateLimits[ip];\n  }\n}\nif (!staticData.rateLimits[clientIP]) {\n  staticData.rateLimits[clientIP] = { count: 1, firstRequest: now };\n} else {\n  staticData.rateLimits[clientIP].count++;\n  if (staticData.rateLimits[clientIP].count > RATE_LIMIT_MAX_REQUESTS) {\n    return [{ json: { ...inputData, authorized: false, error: { success: false, error: 'Too many requests', status: 429 } } }];\n  }\n}\n\n// API KEY CHECK\nconst providedKey = headers['x-api-key'] || body.apiKey || query.apiKey || '';\nif (!providedKey) {\n  return [{ json: { ...inputData, authorized: false, error: { success: false, error: 'API key not provided', status: 401 } } }];\n}\nif (providedKey !== API_KEY) {\n  return [{ json: { ...inputData, authorized: false, error: { success: false, error: 'Invalid API key', status: 401 } } }];\n}\n\nreturn [{ json: { ...inputData, authorized: true } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1920,
        -144
      ],
      "id": "9f78f979-5d5c-40e8-94d8-94a080818bba",
      "name": "üîê Security Check (Detect)"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "auth-condition",
              "leftValue": "={{ $json.authorized }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1760,
        -144
      ],
      "id": "5df2b8a7-b02e-4635-8985-b8d21548ea44",
      "name": "‚ùì Auth Check (Detect)"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json.error }}",
        "options": {
          "responseCode": "={{ $json.error.status }}"
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        -1600,
        0
      ],
      "id": "38323d42-d363-4411-b279-32c244183bc8",
      "name": "‚ùå Error Response (Detect)"
    },
    {
      "parameters": {
        "jsCode": "// UNIVERSAL PROTECTION: API KEY + RATE LIMITING\n\n// Read settings from CONFIG\nconst config = $('‚öôÔ∏è CONFIG: Get').first().json;\nconst API_KEY = config.api_key;\nconst RATE_LIMIT_WINDOW_MS = config.rate_limit_window_ms || 60000;\nconst RATE_LIMIT_MAX_REQUESTS = config.rate_limit_max_requests || 60;\n\n// Get data from Webhook\nconst inputData = $('üåê Webhook: Get').item.json;\nconst body = inputData.body || {};\nconst headers = inputData.headers || {};\nconst query = inputData.query || {};\nconst clientIP = headers['x-real-ip'] || headers['x-forwarded-for'] || headers['cf-connecting-ip'] || 'unknown';\nconst now = Date.now();\n\n// RATE LIMITING\nconst staticData = $getWorkflowStaticData('global');\nif (!staticData.rateLimits) { staticData.rateLimits = {}; }\nfor (const ip in staticData.rateLimits) {\n  if (now - staticData.rateLimits[ip].firstRequest > RATE_LIMIT_WINDOW_MS) {\n    delete staticData.rateLimits[ip];\n  }\n}\nif (!staticData.rateLimits[clientIP]) {\n  staticData.rateLimits[clientIP] = { count: 1, firstRequest: now };\n} else {\n  staticData.rateLimits[clientIP].count++;\n  if (staticData.rateLimits[clientIP].count > RATE_LIMIT_MAX_REQUESTS) {\n    return [{ json: { ...inputData, authorized: false, error: { success: false, error: 'Too many requests', status: 429 } } }];\n  }\n}\n\n// API KEY CHECK\nconst providedKey = headers['x-api-key'] || body.apiKey || query.apiKey || '';\nif (!providedKey) {\n  return [{ json: { ...inputData, authorized: false, error: { success: false, error: 'API key not provided', status: 401 } } }];\n}\nif (providedKey !== API_KEY) {\n  return [{ json: { ...inputData, authorized: false, error: { success: false, error: 'Invalid API key', status: 401 } } }];\n}\n\nreturn [{ json: { ...inputData, authorized: true } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1904,
        352
      ],
      "id": "149039b4-942c-4a88-a907-341a6ead70c0",
      "name": "üîê Security Check (Get)"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "auth-condition",
              "leftValue": "={{ $json.authorized }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1744,
        352
      ],
      "id": "2a405925-65f4-4dd4-bc8a-004988a5d63a",
      "name": "‚ùì Auth Check (Get)"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json.error }}",
        "options": {
          "responseCode": "={{ $json.error.status }}"
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        -1520,
        496
      ],
      "id": "8892c7ad-79c2-4933-87e3-b1231354faba",
      "name": "‚ùå Error Response (Get)"
    }
  ],
  "pinData": {},
  "connections": {
    "üåê Webhook: Detect": {
      "main": [
        [
          {
            "node": "‚öôÔ∏è CONFIG: Detect",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üì• Process Request": {
      "main": [
        [
          {
            "node": "üêò Get Analysis Language",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üêò Get Analysis Language": {
      "main": [
        [
          {
            "node": "üîÑ Merge with Language",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üîÑ Merge with Language": {
      "main": [
        [
          {
            "node": "üêò Get Dialog Messages",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üêò Get Dialog Messages": {
      "main": [
        [
          {
            "node": "üìù Format Dialog for AI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üìù Format Dialog for AI": {
      "main": [
        [
          {
            "node": "ü§ñ AI Agent (Gemini)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ü§ñ AI Agent (Gemini)": {
      "main": [
        [
          {
            "node": "üìä Parse AI Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üìä Parse AI Response": {
      "main": [
        [
          {
            "node": "‚ùì Has Highlights?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "‚ùì Has Highlights?": {
      "main": [
        [
          {
            "node": "üìù Prepare DB Data",
            "type": "main",
            "index": 0
          },
          {
            "node": "üêò Delete Old Highlights",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "‚úÖ Response No Highlights",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üìù Prepare DB Data": {
      "main": [
        [
          {
            "node": "üêò Save to DB",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üêò Save to DB": {
      "main": [
        [
          {
            "node": "‚úÖ Response Success",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üß† Google Gemini": {
      "ai_languageModel": [
        [
          {
            "node": "ü§ñ AI Agent (Gemini)",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "üåê Webhook: Get": {
      "main": [
        [
          {
            "node": "‚öôÔ∏è CONFIG: Get",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üì• Process Get Request": {
      "main": [
        [
          {
            "node": "üêò Check Last Message Date",
            "type": "main",
            "index": 0
          },
          {
            "node": "üêò Check Last Analysis Date",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üêò Get Highlights from DB": {
      "main": [
        [
          {
            "node": "üìä Format Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üìä Format Response": {
      "main": [
        [
          {
            "node": "‚úÖ Response Highlights",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üêò Check Last Message Date": {
      "main": [
        [
          {
            "node": "üîÄ Merge By Position",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üêò Check Last Analysis Date": {
      "main": [
        [
          {
            "node": "üîÄ Merge By Position",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "üìä Compare Dates & Calculate Status": {
      "main": [
        [
          {
            "node": "‚ùì Needs Count New Messages?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "‚ùì Needs Count New Messages?": {
      "main": [
        [
          {
            "node": "üêò Count New Messages",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "üîÑ Merge Status Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üêò Count New Messages": {
      "main": [
        [
          {
            "node": "üîÑ Merge Status Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üîÑ Merge Status Data": {
      "main": [
        [
          {
            "node": "üêò Get Highlights from DB",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üîÄ Merge By Position": {
      "main": [
        [
          {
            "node": "üìä Compare Dates & Calculate Status",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üîê Security Check (Detect)": {
      "main": [
        [
          {
            "node": "‚ùì Auth Check (Detect)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "‚ùì Auth Check (Detect)": {
      "main": [
        [
          {
            "node": "üì• Process Request",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "‚ùå Error Response (Detect)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üîê Security Check (Get)": {
      "main": [
        [
          {
            "node": "‚ùì Auth Check (Get)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "‚ùì Auth Check (Get)": {
      "main": [
        [
          {
            "node": "üì• Process Get Request",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "‚ùå Error Response (Get)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "‚öôÔ∏è CONFIG: Detect": {
      "main": [
        [
          {
            "node": "üîê Security Check (Detect)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "‚öôÔ∏è CONFIG: Get": {
      "main": [
        [
          {
            "node": "üîê Security Check (Get)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "production-ru-v1",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "production-template"
  },
  "id": "highlights-detection-ru",
  "tags": []
}